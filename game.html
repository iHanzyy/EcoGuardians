<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="./assets/img/logoEcoG.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game - ECOGUARDIANS</title>
    <style>
      /* -------------------------- */
      /* Global & Game Styles       */
      /* -------------------------- */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      canvas {
        display: block;
      }

      #loadingScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        z-index: 10;
      }
/* Status Bars UI */
.status-container {
    position: fixed;
    top: 10px;
    left: 10px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-gap: 20px;
    z-index: 50;
  }
  
  /* Styling Bar */
  .status-bar {
    position: relative;
    width: 222px;
    height: 36px;
    background-color: #ddd;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  }
  
  /* Efek Glowing ketika Bar Bertambah */
  @keyframes glow {
    0% {
      box-shadow: 0 0 10px rgba(0, 255, 0, 0.7);
    }
    100% {
      box-shadow: 0 0 20px rgba(0, 255, 0, 1);
    }
  }
  @keyframes shake {
    0%, 100% {
      transform: translateX(0);
    }
    25% {
      transform: translateX(-3px);
    }
    50% {
      transform: translateX(3px);
    }
    75% {
      transform: translateX(-3px);
    }
  }
  
  /* Efek Pulse */
  @keyframes pulse {
    0% {
      background: rgba(0, 255, 0, 0.4);
    }
    100% {
      background: rgba(0, 255, 0, 0);
    }
  }
  
  /* Efek Blinking */
  @keyframes blink {
    0% {
      background: rgba(255, 0, 0, 0.7);
    }
    100% {
      background: rgba(255, 0, 0, 0);
    }
  }
  
  /* Animasi Bar */
  .status-bar-fill {
    height: 100%;
    background: linear-gradient(to right, #2a8e2a, #50d850);
    width: 0;
    transition: width 0.8s ease-in-out;
  }
  
  /* Status Icon */
  .status-icon {
    position: absolute;
    left: 5px;
    top: 50%;
    transform: translateY(-50%);
    width: 30px;
    height: 30px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    z-index: 1;
  }
  
  /* Nature */
  .nature .status-bar-fill {
    background: linear-gradient(to right, #2a8e2a, #50d850);
  }
  .nature .status-icon {
    border-color: #1cbf21;
  }
  
  /* Energy */
  .energy .status-bar-fill {
    background: linear-gradient(to right, #cc9a00, #ffe600);
  }
  .energy .status-icon {
    border-color: #ffb41e;
  }
  
  /* Water */
  .water .status-bar-fill {
    background: linear-gradient(to right, #1e8ac0, #26aaf0);
  }
  .water .status-icon {
    border-color: #b8deff;
  }
  
  /* Toxic */
  .toxic .status-bar-fill {
    background: linear-gradient(to right, #3a3a3a, #484740);
  }
  .toxic .status-icon {
    border-color: #000000;
  }
  
  /* Jika bar penuh */
  .status-bar-fill.full {
    border-radius: 15px;
  }
  

      /* Container ikon game */
      #icons {
        position: fixed;
        top: 10px;
        right: 10px;
        display: flex;
        gap: 10px;
        z-index: 20;
      }

      .icon {
        width: 50px;
        height: 48px;
        cursor: pointer;
        transition: transform 0.3s ease, filter 0.3s ease;
      }

      .icon:hover {
        transform: scale(1.1);
        filter: drop-shadow(0px 4px 8px rgba(0, 0, 0, 0.3));
      }

      /* -------------------------- */
      /* Popup Guide Modal Styles   */
      /* -------------------------- */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease;
        z-index: 999;
      }
      .modal-overlay.active {
        opacity: 1;
        visibility: visible;
      }
      .modal-container {
        background: #222;
        border-radius: 10px;
        padding: 20px 30px;
        max-width: 600px;
        width: 90%;
        position: relative;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
      }
      .modal-close {
        position: absolute;
        top: 10px;
        right: 10px;
        background: transparent;
        border: none;
        font-size: 28px;
        color: #fff;
        cursor: pointer;
        outline: none;
      }
      .slides {
        overflow: hidden;
        position: relative;
        margin-top: 20px;
      }
      .slide-track {
        display: flex;
        transition: transform 0.5s ease-in-out;
      }
      .slide {
        min-width: 100%;
        box-sizing: border-box;
        padding: 10px;
        text-align: center;
      }
      .slide img {
        max-width: 100%;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      }
      .slide p {
        margin-top: 15px;
        font-size: 16px;
        line-height: 1.5;
        color: #ddd;
      }
      .nav-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.5);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        cursor: pointer;
        outline: none;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        color: #fff;
        transition: background 0.3s ease;
      }
      .nav-arrow:hover {
        background: rgba(0, 0, 0, 0.7);
      }
      .nav-prev {
        left: 10px;
      }
      .nav-next {
        right: 10px;
      }

      /* Popup Quest Modal Styles */
      .mission-content {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-top: 20px;
      }

      .mission-item {
        display: flex;
        align-items: flex-start;
        gap: 15px;
      }

      .mission-details {
        flex-grow: 1;
      }

      .mission-icon {
        width: 40px;
        height: 40px;
      }

      .mission-progress {
        flex-grow: 1;
        height: 20px;
        background-color: #ddd;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      }

      .mission-progress-bar {
        height: 100%;
        width: 0;
        background: linear-gradient(to right, #4caf50, #8bc34a);
        transition: width 0.5s ease-in-out;
      }

      .mission-title {
        font-size: 18px;
        color: #fff;
        margin-bottom: 5px;
      }
    </style>
  </head>
  <body>
    <!-- Loading Screen -->
    <div id="loadingScreen">Loading...</div>
    <!-- Game Canvas -->
    <canvas id="gameCanvas"></canvas>
    <!-- Status Bars UI -->
<div class="status-container">
    <!-- Nature -->
    <div class="status-bar nature">
      <div class="status-icon">
        <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24.5" cy="24.5" r="22.5" fill="#B5FF78" stroke="black" stroke-width="4"/>
            <path d="M36.677 13.3218C36.6618 13.0619 36.5517 12.8166 36.3676 12.6324C36.1835 12.4483 35.9382 12.3382 35.6782 12.323C25.5672 11.7294 17.4683 14.7734 14.0152 20.4844C12.8183 22.438 12.2285 24.703 12.3205 26.9922C12.3806 28.4561 12.6784 29.9005 13.2024 31.2688C13.2332 31.353 13.2847 31.428 13.3524 31.4869C13.42 31.5458 13.5014 31.5866 13.589 31.6056C13.6766 31.6245 13.7676 31.621 13.8535 31.5953C13.9394 31.5696 14.0174 31.5226 14.0803 31.4587L25.3693 19.997C25.468 19.8982 25.5852 19.8199 25.7142 19.7665C25.8432 19.7131 25.9814 19.6856 26.121 19.6856C26.2606 19.6856 26.3989 19.7131 26.5279 19.7665C26.6568 19.8199 26.774 19.8982 26.8728 19.997C26.9715 20.0957 27.0498 20.2129 27.1032 20.3418C27.1566 20.4708 27.1841 20.6091 27.1841 20.7487C27.1841 20.8883 27.1566 21.0265 27.1032 21.1555C27.0498 21.2845 26.9715 21.4017 26.8728 21.5004L14.5358 34.0233L12.6512 35.9079C12.4552 36.0987 12.3382 36.3563 12.3234 36.6294C12.3087 36.9026 12.3972 37.1713 12.5715 37.3821C12.667 37.4926 12.7842 37.5823 12.9158 37.6455C13.0475 37.7087 13.1907 37.7441 13.3367 37.7495C13.4826 37.7548 13.6281 37.73 13.764 37.6767C13.9 37.6233 14.0234 37.5425 14.1267 37.4392L16.3567 35.2093C18.2346 36.1177 20.1299 36.6131 22.0092 36.6795C22.157 36.6848 22.3045 36.6875 22.4514 36.6875C24.5916 36.693 26.6911 36.1035 28.5156 34.9848C34.2266 31.5317 37.272 23.4341 36.677 13.3218Z" fill="#1CBF21"/>
            </svg>
      </div>
      <div class="status-bar-fill"></div>
    </div>
  
    <!-- Water -->
    <div class="status-bar water">
      <div class="status-icon">
        <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24.5" cy="24.5" r="22.5" fill="#B8DEFF" stroke="black" stroke-width="4"/>
            <path d="M24.935 11.655C24.3966 11.1875 23.5891 11.1875 23.0508 11.655C16.1375 17.7467 12.6666 23.045 12.6666 27.55C12.6666 34.605 18.05 39.1667 24 39.1667C29.95 39.1667 35.3333 34.605 35.3333 27.55C35.3333 23.045 31.8625 17.7467 24.935 11.655ZM18.0925 27.8333C18.6166 27.8333 19.0416 28.2017 19.1408 28.7117C19.7216 31.8567 22.3708 32.9333 24.2975 32.7775C24.9066 32.7492 25.4166 33.2308 25.4166 33.84C25.4166 34.4067 24.9633 34.8742 24.3966 34.9025C21.3791 35.0867 17.8516 33.3583 17.0441 29.0658C17.0195 28.914 17.0282 28.7585 17.0695 28.6103C17.1109 28.4621 17.1839 28.3247 17.2836 28.2074C17.3833 28.0902 17.5073 27.9961 17.6469 27.9315C17.7866 27.8669 17.9386 27.8334 18.0925 27.8333Z" fill="#26AAF0"/>
            </svg>
      </div>
      <div class="status-bar-fill"></div>
    </div>
  
    <!-- Energy -->
    <div class="status-bar energy">
      <div class="status-icon">
        <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24.5" cy="24.5" r="22.5" fill="#FFEB00" stroke="black" stroke-width="4"/>
            <path d="M23.5833 29.25H16.5L26.4167 9.41666V20.75H33.5L23.5833 40.5833V29.25Z" fill="#FFB41E"/>
            </svg>
      </div>
      <div class="status-bar-fill"></div>
    </div>
  
    <!-- Toxic -->
    <div class="status-bar toxic">
      <div class="status-icon">
        <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24.5" cy="24.5" r="22.5" fill="#D3D1D1" stroke="black" stroke-width="4"/>
            <path d="M39.8524 29.1942C39.7114 27.3182 38.9122 25.5523 37.5958 24.2083C36.2795 22.8642 34.5306 22.0284 32.658 21.8484C32.5379 21.5942 32.4049 21.3464 32.2595 21.1059C33.1019 19.2524 33.2021 17.1467 32.5396 15.2216C31.877 13.2965 30.5021 11.6984 28.6975 10.7559L28.6789 10.7452C28.6302 10.7201 28.5796 10.6988 28.5275 10.6815C28.274 10.5975 27.9981 10.6121 27.7549 10.7223C27.5116 10.8326 27.3188 11.0304 27.2148 11.2764C27.1108 11.5224 27.1033 11.7985 27.1937 12.0498C27.2841 12.3011 27.4659 12.5091 27.7027 12.6325H27.712C27.8688 12.7241 30.3125 14.0735 30.3125 17.0312C30.3131 17.5966 30.2234 18.1583 30.0469 18.6954C28.5867 17.6134 26.8174 17.0294 25 17.0294C23.1826 17.0294 21.4134 17.6134 19.9531 18.6954C19.7766 18.1583 19.6869 17.5966 19.6875 17.0312C19.6875 14.0629 22.1485 12.7135 22.2973 12.6351C22.5432 12.5035 22.7274 12.2804 22.8103 12.0141C22.8931 11.7478 22.8679 11.4596 22.7402 11.2117C22.6124 10.9637 22.3922 10.776 22.1272 10.689C21.8622 10.602 21.5736 10.6227 21.3238 10.7466L21.3038 10.7572C19.4976 11.7006 18.1214 13.3 17.4582 15.2268C16.7949 17.1536 16.895 19.2613 17.7378 21.1166C17.5917 21.3556 17.4563 21.6026 17.3394 21.8563C15.4672 22.0375 13.7191 22.8739 12.4033 24.2181C11.0876 25.5623 10.2887 27.3279 10.1476 29.2035C10.1268 29.4184 10.1206 29.6345 10.129 29.8503C10.152 30.1216 10.2782 30.3737 10.4816 30.5546C10.6851 30.7356 10.9502 30.8315 11.2223 30.8226C11.4944 30.8138 11.7527 30.7008 11.944 30.507C12.1352 30.3132 12.2447 30.0534 12.25 29.7812C12.25 29.6006 12.2593 29.4213 12.2752 29.25C12.3722 28.4199 12.8145 26.7159 14.7509 25.599C15.2976 25.282 15.8968 25.0656 16.5199 24.9601C16.5067 25.1501 16.4987 25.3426 16.4987 25.5366C16.5004 27.2048 16.9922 28.8357 17.9131 30.2267C18.834 31.6177 20.1433 32.7075 21.6784 33.3605C21.2454 33.9465 20.6961 34.4367 20.0647 34.8002C17.532 36.2612 15.1666 34.848 14.966 34.7232L14.9501 34.7126C14.7138 34.5633 14.4281 34.5132 14.1551 34.5731C13.8821 34.633 13.6437 34.798 13.4915 35.0325C13.3394 35.2669 13.2857 35.5519 13.3422 35.8256C13.3987 36.0994 13.5607 36.3398 13.7933 36.4949L13.8252 36.5148C14.7103 37.0768 15.6978 37.4583 16.7308 37.6376C17.7638 37.8169 18.8221 37.7904 19.8448 37.5597C20.8676 37.3289 21.8347 36.8984 22.6907 36.2929C23.5466 35.6874 24.2745 34.9188 24.8327 34.0312H25.1674C25.7262 34.9182 26.4546 35.6862 27.3107 36.2912C28.1669 36.8962 29.134 37.3263 30.1567 37.5569C31.1793 37.7875 32.2374 37.814 33.2704 37.635C34.3033 37.4559 35.2908 37.0748 36.1762 36.5135L36.2067 36.4936C36.4393 36.3385 36.6014 36.0981 36.6578 35.8243C36.7143 35.5506 36.6607 35.2656 36.5085 35.0312C36.3563 34.7967 36.1179 34.6317 35.8449 34.5718C35.5719 34.5119 35.2863 34.562 35.0499 34.7112L35.034 34.7219C34.8335 34.8467 32.4681 36.2612 29.9353 34.7989C29.303 34.4339 28.7531 33.9419 28.3203 33.3539C29.8552 32.7009 31.1644 31.6114 32.0852 30.2206C33.0061 28.8299 33.4981 27.1992 33.5 25.5312C33.5 25.3373 33.4907 25.1461 33.4788 24.9562C34.1023 25.0611 34.7019 25.277 35.2492 25.5937C37.1709 26.7026 37.6212 28.3907 37.7235 29.2221C37.7407 29.4067 37.75 29.5926 37.75 29.7812C37.746 29.9208 37.7695 30.0597 37.8192 30.1902C37.8689 30.3206 37.9438 30.44 38.0396 30.5415C38.1354 30.643 38.2503 30.7246 38.3777 30.7817C38.5051 30.8388 38.6424 30.8703 38.782 30.8743C38.9215 30.8783 39.0604 30.8548 39.1909 30.8051C39.3213 30.7554 39.4407 30.6805 39.5422 30.5847C39.6437 30.4889 39.7253 30.374 39.7824 30.2466C39.8395 30.1192 39.871 29.9819 39.875 29.8423C39.8822 29.626 39.8746 29.4095 39.8524 29.1942ZM22.5735 31.4255C21.4063 30.9435 20.4082 30.1263 19.7054 29.0772C19.0026 28.028 18.6266 26.794 18.625 25.5312C18.625 25.3626 18.6343 25.1952 18.6476 25.0292L18.7804 25.0624C20.1162 25.4209 21.2595 26.2863 21.9673 27.4745C22.6751 28.6627 22.8917 30.0801 22.5709 31.4255H22.5735ZM25 25.8115L24.9854 25.7862H25.0146L25 25.8115ZM25 22.3437C24.2483 22.3441 23.505 22.1846 22.8197 21.8757C22.1343 21.5668 21.5225 21.1156 21.0249 20.5521C22.1523 19.6485 23.5539 19.1561 24.9987 19.1561C26.4435 19.1561 27.8451 19.6485 28.9724 20.5521C28.4753 21.1154 27.8639 21.5665 27.179 21.8754C26.4941 22.1843 25.7513 22.3439 25 22.3437ZM27.4292 31.4241C27.2665 30.7467 27.239 30.0438 27.3482 29.3557C27.4575 28.6677 27.7014 28.0079 28.0659 27.4142C28.4304 26.8204 28.9085 26.3044 29.4726 25.8956C30.0368 25.4869 30.676 25.1933 31.3538 25.0319C31.367 25.1966 31.375 25.3626 31.375 25.5312C31.3734 26.7937 30.9976 28.0274 30.295 29.0763C29.5925 30.1252 28.5947 30.9422 27.4278 31.4241H27.4292Z" fill="black"/>
            </svg>
            
      </div>
      <div class="status-bar-fill"></div>
    </div>
  </div>
  
    <!-- Game Icons -->
    <div id="icons">
      <!-- Ikon Guide; klik ikon ini untuk memunculkan popup panduan -->
      <img
        src="./assets/img/guideButton.svg"
        alt="Guide Button"
        class="icon"
        id="guideButton"
      />
      <img src="./assets/img/questButton.svg" alt="Quest Button" class="icon" />
    </div>

    <!-- -------------------------- -->
    <!-- Popup Modal (Guide)        -->
    <!-- -------------------------- -->
    <div class="modal-overlay" id="modalOverlay">
      <div class="modal-container">
        <button class="modal-close" id="modalClose">&times;</button>
        <h2 style="text-align: center; color: #fff">Cara Bermain</h2>
        <div class="slides">
          <div class="slide-track" id="slideTrack">
            <!-- Slide 1 -->
            <div class="slide">
              <img src="./assets/gif/testing.gif" alt="Slide 1" />
              <p>
                Selamat datang di game kami! Gunakan tombol panah untuk bergerak
                dan hindari rintangan.
              </p>
            </div>
            <!-- Slide 2 -->
            <div class="slide">
              <img src="./assets/gif/testing.gif" alt="Slide 2" />
              <p>
                Kumpulkan koin untuk meningkatkan skor dan buka kemampuan
                khusus.
              </p>
            </div>
            <!-- Slide 3 -->
            <div class="slide">
              <img src="./assets/gif/testing.gif" alt="Slide 3" />
              <p>
                Hindari musuh dan rintangan. Jadilah yang terbaik dan raih
                kemenangan!
              </p>
            </div>
          </div>
        </div>
        <button class="nav-arrow nav-prev" id="prevBtn">&#10094;</button>
        <button class="nav-arrow nav-next" id="nextBtn">&#10095;</button>
      </div>
    </div>

    <!-- Popup Modal (Quest) -->
    <div class="modal-overlay" id="questModalOverlay">
      <div class="modal-container">
        <button class="modal-close" id="questModalClose">&times;</button>
        <h2 style="text-align: center; color: #fff">Misi</h2>
        <div class="mission-content">
          <div class="mission-item">
            <img src="./assets/img/itemIcon.svg" alt="Item Icon" class="mission-icon" />
            <div class="mission-details">
              <h3 class="mission-title">Kumpulkan 10 batang pohon</h3>
              <div class="mission-progress">
                <div class="mission-progress-bar"></div>
              </div>
            </div>
          </div>
          <!-- Tambahkan lebih banyak item misi di sini -->
          <div class="mission-item">
            <img src="./assets/img/itemIcon.svg" alt="Item Icon" class="mission-icon" />
            <div class="mission-details">
              <h3 class="mission-title">Kumpulkan 10 batang pohon</h3>
              <div class="mission-progress">
                <div class="mission-progress-bar"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      /***********************
       * Game Code
       ***********************/
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      const loadingScreen = document.getElementById("loadingScreen");

      // Mengatur ukuran canvas sesuai ukuran window
      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      // Status input keyboard
      const keys = {
        w: false,
        s: false,
        a: false,
        d: false,
      };

      // Objek game
      const game = {
        player: {
          x: canvas.width / 2,
          y: canvas.height / 2,
          speed: 3,
          maxSpeed: 4,
          acceleration: 0.2,
          friction: 0.15,
          width: 40,
          height: 70,
          currentFrame: 0,
          frameInterval: 200,
          lastFrameTime: 0,
          direction: 'down',
          velocityX: 0,
          velocityY: 0,
          upFrames: [new Image(), new Image()]
        },
        assets: {
          jiraStay: new Image(),
          leftFrames: [new Image(), new Image(), new Image()],
          rightFrames: [new Image(), new Image(), new Image()],
          downLeftFrame: new Image(),
          downRightFrame: new Image(),
          upLeftFrame: new Image(),
          upRightFrame: new Image(),
          upFrames: [new Image(), new Image()],
          background: new Image()
        },
        loaded: 0,
        required: 13
      };

      // Fungsi memuat asset
      function loadAssets() {
        // Load frame jalan bawah kiri (single image)
        game.assets.downLeftFrame.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.downLeftFrame.src = "./assets/img/jalanBawahKiri.png";

        // Load frame jalan bawah kanan (single image)
        game.assets.downRightFrame.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.downRightFrame.src = "./assets/img/jalanBawahKanan.png";

        // Load frame jalan atas kiri
        game.assets.upLeftFrame.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.upLeftFrame.src = "./assets/img/jalanAtasKiri.png";

        // Load frame jalan atas kanan
        game.assets.upRightFrame.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.upRightFrame.src = "./assets/img/jalanAtasKanan.png";

        // Load frame jalan ke kiri
        game.assets.leftFrames.forEach((frame, index) => {
          frame.onload = () => {
            game.loaded++;
            checkLoading();
          };
          frame.src = `./assets/img/jalanKiri${index + 1}.png`;
        });

        // Load frame jalan ke kanan
        game.assets.rightFrames.forEach((frame, index) => {
          frame.onload = () => {
            game.loaded++;
            checkLoading();
          };
          frame.src = `./assets/img/jalanKanan${index + 1}.png`;
        });

        // Load frame jalan atas (2 frame animasi)
        game.assets.upFrames.forEach((frame, index) => {
          frame.onload = () => {
            game.loaded++;
            checkLoading();
          };
          frame.src = `./assets/img/jalanAtas${index + 1}.png`;
        });

        // Load asset lainnya
        game.assets.jiraStay.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.jiraStay.src = "./assets/img/jiraStay.png";
        
        game.assets.background.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.background.src = "./assets/img/gameBg.png";

        function checkLoading() {
          if (game.loaded === game.required) {
            loadingScreen.style.display = "none";
            requestAnimationFrame(gameLoop);
          }
        }
      }

      // Event listener keyboard
      window.addEventListener("keydown", (e) => {
        if (e.key.toLowerCase() in keys) {
          keys[e.key.toLowerCase()] = true;
        }
      });
      window.addEventListener("keyup", (e) => {
        if (e.key.toLowerCase() in keys) {
          keys[e.key.toLowerCase()] = false;
        }
      });

      // Update posisi player
      function updatePlayer() {
        const now = Date.now();
        game.player.isMoving = false;
        
        // Update velocity dengan acceleration
        if (keys.w) game.player.velocityY = Math.max(game.player.velocityY - game.player.acceleration, -game.player.maxSpeed);
        if (keys.s) game.player.velocityY = Math.min(game.player.velocityY + game.player.acceleration, game.player.maxSpeed);
        if (keys.a) game.player.velocityX = Math.max(game.player.velocityX - game.player.acceleration, -game.player.maxSpeed);
        if (keys.d) game.player.velocityX = Math.min(game.player.velocityX + game.player.acceleration, game.player.maxSpeed);

        // Terapkan gesekan ketika tidak ada input
        if (!keys.w && !keys.s) {
          game.player.velocityY *= (1 - game.player.friction);
          if (Math.abs(game.player.velocityY) < 0.1) game.player.velocityY = 0;
        }
        
        if (!keys.a && !keys.d) {
          game.player.velocityX *= (1 - game.player.friction);
          if (Math.abs(game.player.velocityX) < 0.1) game.player.velocityX = 0;
        }

        // Update posisi dengan velocity
        game.player.x += game.player.velocityX;
        game.player.y += game.player.velocityY;

        // Batasi posisi dalam canvas
        game.player.x = Math.max(0, Math.min(game.player.x, canvas.width - game.player.width));
        game.player.y = Math.max(0, Math.min(game.player.y, canvas.height - game.player.height));

        // Bagian penentuan arah
        if (game.player.velocityX !== 0 || game.player.velocityY !== 0) {
          game.player.isMoving = true;
          
          if (game.player.velocityY < 0) {
            if (game.player.velocityX > 0) game.player.direction = 'up-right';
            else if (game.player.velocityX < 0) game.player.direction = 'up-left';
            else game.player.direction = 'up';
          }
          else if (game.player.velocityY > 0) {
            if (game.player.velocityX > 0) game.player.direction = 'down-right';
            else if (game.player.velocityX < 0) game.player.direction = 'down-left';
            else game.player.direction = 'down';
          }
          else {
            game.player.direction = game.player.velocityX > 0 ? 'right' : 'left';
          }
        } else {
          game.player.isMoving = false;
          game.player.currentFrame = 0;
        }

        // Update animasi frame
        if (game.player.isMoving) {
          const isDiagonalMove = (game.player.velocityX !== 0 && game.player.velocityY !== 0);
          const isHorizontalOnly = game.player.velocityX !== 0 && game.player.velocityY === 0;
          
          if (isHorizontalOnly && (now - game.player.lastFrameTime > game.player.frameInterval)) {
            game.player.currentFrame = (game.player.currentFrame + 1) % 3;
            game.player.lastFrameTime = now;
          } else if (isDiagonalMove) {
            game.player.currentFrame = 0;
          }
        }

        // Update animasi frame untuk gerakan atas
        if (game.player.direction === 'up') {
          if (Date.now() - game.player.lastFrameTime > game.player.frameInterval) {
            game.player.currentFrame = (game.player.currentFrame + 1) % 2;
            game.player.lastFrameTime = Date.now();
          }
        }
      }
      
      // Menggambar background agar menyesuaikan layar penuh tanpa ada warna putih di sisi kanan/kiri
      function drawBackground() {
        const img = game.assets.background;
        const canvasRatio = canvas.width / canvas.height;
        const imgRatio = img.width / img.height;

        let drawWidth, drawHeight, xOffset, yOffset;

        if (canvasRatio > imgRatio) {
          // Jika canvas lebih lebar dari gambar, maka sesuaikan tinggi gambar
          drawWidth = canvas.width;
          drawHeight = (canvas.width / img.width) * img.height;
          xOffset = 0;
          yOffset = (canvas.height - drawHeight) / 2;
        } else {
          // Jika canvas lebih tinggi dari gambar, maka sesuaikan lebar gambar
          drawHeight = canvas.height;
          drawWidth = (canvas.height / img.height) * img.width;
          xOffset = (canvas.width - drawWidth) / 2;
          yOffset = 0;
        }

        // Menggambar gambar sebagai background dengan ukuran yang telah disesuaikan
        ctx.drawImage(img, xOffset, yOffset, drawWidth, drawHeight);
      }

      // Gambar player
      function drawPlayer() {
        let currentFrame;
        switch(game.player.direction) {
          case 'left':
            currentFrame = game.assets.leftFrames[game.player.currentFrame];
            break;
          case 'right':
            currentFrame = game.assets.rightFrames[game.player.currentFrame];
            break;
          case 'down-left':
            currentFrame = game.assets.downLeftFrame;
            break;
          case 'down-right':
            currentFrame = game.assets.downRightFrame;
            break;
          case 'up-left':
            currentFrame = game.assets.upLeftFrame;
            break;
          case 'up-right':
            currentFrame = game.assets.upRightFrame;
            break;
          case 'up':
            currentFrame = game.assets.upFrames[game.player.currentFrame];
            break;
          default: // 'down'
            currentFrame = game.assets.jiraStay;
        }

        // Tambahkan pengecekan gambar
        if (!currentFrame || currentFrame.complete === false || currentFrame.naturalHeight === 0) {
          console.error('Gambar tidak ditemukan untuk arah:', game.player.direction);
          return;
        }

        ctx.drawImage(
          currentFrame,
          game.player.x,
          game.player.y,
          game.player.width,
          game.player.height
        );
      }

      // Game loop utama
      function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBackground();
        updatePlayer();
        drawPlayer();
        requestAnimationFrame(gameLoop);
      }

      loadAssets();

      /***********************
       * Guide Popup & Slider Code
       ***********************/
      const guideButton = document.getElementById("guideButton");
      const modalOverlay = document.getElementById("modalOverlay");
      const modalClose = document.getElementById("modalClose");
      const slideTrack = document.getElementById("slideTrack");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      let currentSlide = 0;

      // Tampilkan popup ketika ikon guide ditekan
      guideButton.addEventListener("click", () => {
        modalOverlay.classList.add("active");
        currentSlide = 0;
        updateSlide();
      });

      // Tutup popup ketika tombol close ditekan
      modalClose.addEventListener("click", () => {
        modalOverlay.classList.remove("active");
      });

      // Update posisi slide
      function updateSlide() {
        slideTrack.style.transform = `translateX(-${currentSlide * 100}%)`;
      }

      nextBtn.addEventListener("click", () => {
        if (currentSlide < slideTrack.children.length - 1) {
          currentSlide++;
          updateSlide();
        }
      });

      prevBtn.addEventListener("click", () => {
        if (currentSlide > 0) {
          currentSlide--;
          updateSlide();
        }
      });

      // Tutup popup jika klik di luar modal container
      window.addEventListener("click", (e) => {
        if (e.target === modalOverlay) {
          modalOverlay.classList.remove("active");
        }
      });

      // Fungsi untuk mengupdate status bar
      function updateStatusBar(barClass, percentage) {
        const barFill = document.querySelector(`.${barClass} .status-bar-fill`);
        if (barFill) {
          // Validasi persentase agar tetap dalam rentang 0-100
          percentage = Math.max(0, Math.min(percentage, 100));
          // Mengubah lebar bar berdasarkan persentase
          barFill.style.width = `${percentage}%`;
        }
      }

      // Contoh penggunaan: mengubah status bar nature menjadi 75%
      updateStatusBar('nature', 75);

      // Contoh penggunaan: mengubah status bar water menjadi 50%
      updateStatusBar('water', 50);

      // Contoh penggunaan: mengurangi status bar energy menjadi 30%
      updateStatusBar('energy', 30);

      // Contoh penggunaan: mengurangi status bar toxic menjadi 10%
      updateStatusBar('toxic', 10);

      // Quest Popup Code
      const questButton = document.querySelector('.icon[alt="Quest Button"]');
      const questModalOverlay = document.getElementById("questModalOverlay");
      const questModalClose = document.getElementById("questModalClose");

      // Tampilkan popup ketika ikon quest ditekan
      questButton.addEventListener("click", () => {
        questModalOverlay.classList.add("active");
      });

      // Tutup popup ketika tombol close ditekan
      questModalClose.addEventListener("click", () => {
        questModalOverlay.classList.remove("active");
      });

      // Tutup popup jika klik di luar modal container
      window.addEventListener("click", (e) => {
        if (e.target === questModalOverlay) {
          questModalOverlay.classList.remove("active");
        }
      });

      // Fungsi untuk mengupdate progress bar misi
      function updateMissionProgress(percentage) {
        const progressBar = document.querySelector(".mission-progress-bar");
        if (progressBar) {
          // Validasi persentase agar tetap dalam rentang 0-100
          percentage = Math.max(0, Math.min(percentage, 100));
          // Mengubah lebar bar berdasarkan persentase
          progressBar.style.width = `${percentage}%`;
        }
      }

      // Contoh penggunaan: mengubah progress bar misi menjadi 50%
      updateMissionProgress(50);
    </script>
  </body>
</html>
