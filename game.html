<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="./assets/img/logoEcoG.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game - ECOGUARDIANS</title>
    <style>
      /* -------------------------- */
      /* Global & Game Styles       */
      /* -------------------------- */

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: sans-serif;
      }

      canvas {
        display: block;
      }

      #loadingScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        z-index: 10;
      }

      /* -------------------------- */
      /* Status Bars UI             */
      /* -------------------------- */
      .status-container {
        position: fixed;
        top: 20px;
        left: 20px;
        display: flex;
        gap: 15px;
        z-index: 50;
      }
      .status-column {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .status-bar {
        width: 280px; /* Ukuran tetap sesuai semula */
        height: 42px;
        background: rgba(0, 0, 0, 0.7);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 21px;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(5px);
        transition: transform 0.3s ease;
      }

      .status-bar-fill {
        position: absolute;
        height: 100%;
        width: 0;
        left: 0;
        top: 0;
        transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .status-icon {
        position: absolute;
        left: 4px;
        top: 50%;
        transform: translateY(-50%);
        width: 34px;
        height: 34px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        z-index: 2;
      }

      /* Status Bar Warna & Styling */
      /* Nature */
      .nature .status-bar-fill {
        background: linear-gradient(
          90deg,
          rgba(42, 142, 42, 0.8) 0%,
          rgba(80, 216, 80, 0.9) 50%,
          rgba(100, 255, 100, 1) 100%
        );
        box-shadow: 0 0 15px rgba(80, 216, 80, 0.4);
      }
      .nature .status-icon {
        border: 2px solid #2a8e2a;
      }
      /* Energy */
      .energy .status-bar-fill {
        background: linear-gradient(
          90deg,
          rgba(204, 154, 0, 0.8) 0%,
          rgba(255, 230, 0, 0.9) 50%,
          rgba(255, 255, 100, 1) 100%
        );
        box-shadow: 0 0 15px rgba(255, 230, 0, 0.4);
      }

      .energy .status-icon {
        border: 2px solid #cc9a00;
      }
      /* Water */
      .water .status-bar-fill {
        background: linear-gradient(
          90deg,
          rgba(30, 138, 192, 0.8) 0%,
          rgba(38, 170, 240, 0.9) 50%,
          rgba(100, 200, 255, 1) 100%
        );
        box-shadow: 0 0 15px rgba(38, 170, 240, 0.4);
      }

      .water .status-icon {
        border: 2px solid #1e8ac0;
      }

      /* Toxic */
      .toxic .status-bar-fill {
        background: linear-gradient(
          90deg,
          rgba(58, 58, 58, 0.8) 0%,
          rgba(72, 71, 64, 0.9) 50%,
          rgba(100, 100, 100, 1) 100%
        );
        box-shadow: 0 0 15px rgba(72, 71, 64, 0.4);
      }

      .toxic .status-icon {
        border: 2px solid #3a3a3a;
      }

      /* Pulse Animation for Low Status */
      @keyframes pulse {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.05);
          opacity: 0.8;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .status-bar[data-low="true"] {
        animation: pulse 1.5s ease-in-out infinite;
      }

      /* Status Value Display */
      .status-value {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: white;
        font-family: "Arial", sans-serif;
        font-weight: bold;
        font-size: 16px;
        text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        z-index: 2;
      }
      /* -------------------------- */
      /* Container Ikon Game        */
      /* -------------------------- */
      #icons {
        position: fixed;
        top: 10px;
        right: 10px;
        display: flex;
        gap: 10px;
        z-index: 20;
      }

      .icon {
        width: 50px;
        height: 48px;
        cursor: pointer;
        transition: transform 0.3s ease, filter 0.3s ease;
      }

      .icon:hover {
        transform: scale(1.1);
        filter: drop-shadow(0px 4px 8px rgba(0, 0, 0, 0.3));
      }

      /* -------------------------- */
      /* Popup Guide Modal Styles   */
      /* -------------------------- */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease;
        z-index: 999;
      }
      .modal-overlay.active {
        opacity: 1;
        visibility: visible;
      }
      .modal-container {
        background: #f8f9fa; /* Warna background lebih terang */
        border: 2px solid #00fff9;
        box-shadow: 0 0 30px rgba(0, 255, 249, 0.2);
        border-radius: 10px;
        padding: 20px 30px;
        max-width: 600px;
        width: 90%;
        position: relative;
      }
      .modal-close {
        position: absolute;
        top: 10px;
        right: 10px;
        background: transparent;
        border: none;
        font-size: 28px;
        color: #fff;
        cursor: pointer;
        outline: none;
      }
      .slides {
        overflow: hidden;
        position: relative;
        margin-top: 20px;
      }
      .slide-track {
        display: flex;
        transition: transform 0.5s ease-in-out;
      }
      .slide {
        min-width: 100%;
        box-sizing: border-box;
        padding: 15px 30px;
        text-align: center;
      }
      .slide img {
        max-width: 100%;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      }
      .slide p {
        color: #2d3436; /* Warna teks lebih gelap */
        font-size: 17px;
        line-height: 1.7;
        padding: 20px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 10px;
        margin: 20px 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .slide p strong {
        color: #00a8ff; /* Warna aksen untuk tombol */
        font-weight: 600;
      }
      .nav-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(76, 175, 80, 0.8);
        color: white;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.5);
        font-size: 24px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        opacity: 1;
        z-index: 10;
      }

      .nav-arrow:hover {
        background: rgba(76, 175, 80, 1);
        border-color: white;
        transform: translateY(-50%) scale(1.1);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3),
                    0 0 20px rgba(76, 175, 80, 0.5);
      }

      .nav-arrow:active {
        transform: translateY(-50%) scale(0.95);
      }

      .nav-prev {
        left: 20px;
        padding-right: 3px;
        transform-origin: left center;
      }

      .nav-next {
        right: 20px;
        padding-left: 3px;
        transform-origin: right center;
      }

      /* Animasi untuk visibility */
      .nav-arrow {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .nav-prev[style*="hidden"] {
        transform: translateY(-50%) translateX(-20px);
        opacity: 0;
        visibility: hidden !important;
      }

      .nav-next[style*="hidden"] {
        transform: translateY(-50%) translateX(20px);
        opacity: 0;
        visibility: hidden !important;
      }

      /* Hover effect dengan glow */
      .nav-arrow:hover {
        background: rgba(76, 175, 80, 0.9);
        border-color: white;
        transform: translateY(-50%) scale(1.1);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3),
                    0 0 20px rgba(76, 175, 80, 0.5);
      }

      /* Pulse animation untuk tombol yang aktif */
      @keyframes pulse {
        0% {
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2),
                      0 0 0 0 rgba(76, 175, 80, 0.4);
        }
        70% {
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2),
                      0 0 0 15px rgba(76, 175, 80, 0);
        }
        100% {
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2),
                      0 0 0 0 rgba(76, 175, 80, 0);
        }
      }

      .nav-arrow:not([style*="hidden"]) {
        animation: pulse 2s infinite;
      }

      /* Tambahkan efek ripple saat diklik */
      .nav-arrow::after {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.4);
        transform: scale(0);
        transition: transform 0.3s ease;
      }

      .nav-arrow:active::after {
        transform: scale(1.5);
        opacity: 0;
        transition: transform 0.4s ease, opacity 0.4s ease;
      }

      /* -------------------------- */
      /* Popup Quest Modal Styles   */
      /* -------------------------- */
      .mission-content {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-top: 20px;
      }

      .mission-item {
        display: flex;
        align-items: flex-start;
        gap: 15px;
      }

      .mission-details {
        flex-grow: 1;
      }

      .mission-icon {
        width: 40px;
        height: 40px;
      }

      .mission-progress {
        flex-grow: 1;
        height: 20px;
        background-color: #ddd;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      }

      .mission-progress-bar {
        height: 100%;
        width: 0;
        background: linear-gradient(to right, #4caf50, #8bc34a);
        transition: width 0.5s ease-in-out;
      }

      .mission-title {
        font-size: 18px;
        color: #fff;
        margin-bottom: 5px;
      }

      /* -------------------------- */
      /* Blok Rintangan (Road Blocks) */
      /* -------------------------- */
      /* Gunakan class "roadBlock" untuk setiap blok rintangan.
         Kamu dapat mengubah posisi dan ukuran masing-masing blok melalui ID-nya. */
      .roadBlock {
        position: absolute;
        z-index: 3;
        pointer-events: none;
      }
      /* Blok di bagian atas */
      #blockTop {
        top: 0;
        width: 100%;
        height: 16rem;
      }
      /* Blok di bagian bawah */
      #blockBottom {
        bottom: 0;
        width: 100%;
        height: 10rem;
      }
      /* Blok di bagian kiri */
      #blockLeft {
        top: 30%;
        left: 0;
        width: 14rem;
        height: 38%;
      }
      /* Blok di bagian kanan */
      #blockRight {
        top: 30%;
        right: 0;
        width: 20rem;
        height: 51%;
      }
      /* Blok di bagian home */
      #blockHome {
        top: 30%;
        left: 21%;
        width: 14rem;
        height: 21%;
      }
      /* Blok di bagian laboratorium */
      #blockLaboratorium {
        top: 30%;
        right: 21%;
        width: 20rem;
        height: 15%;
      }
      /* Blok di bagian pohon */
      #blockTree {
        top: 30%;
        right: 42%;
        width: 6rem;
        height: 11%;
      }
      /* Blok di bagian pohon 2 */
      #blockTree2 {
        top: 50%;
        right: 21%;
        width: 4rem;
        height: 7%;
      }
      /* Blok di bagian grass */
      #blockGrass {
        top: 60%;
        right: 32%;
        width: 7rem;
        height: 21%;
      }
      /* Blok di bagian grass 2 */
      #blockGrass2 {
        top: 67%;
        right: 21%;
        width: 11rem;
        height: 14%;
      }
      #blokirKetikaAlatPenghisapMuncul {
        top: 54%;
        right: 51%;
        width: 6rem;
        height: 8%;
      }

      #tempatAlatKonversi {
        position: fixed;
        bottom: 12%;
        left: 18%;
        width: 7rem;
        height: 14%;
        pointer-events: none;
        border: 3px dashed #00ff00;
        background: rgba(0, 255, 0, 0.1);
        animation: pulseBorder 1.5s infinite;
        display: none; /* Awalnya disembunyikan */
      }

      #tempatAlatPenghisap {
        position: fixed;
        left: 580px; /* Sesuai dengan posisi x yang didefinisikan */
        top: 300px; /* Sesuai dengan posisi y yang didefinisikan */
        width: 250px; /* Lebar 250px sesuai dengan game.tools.alatPolusi.width */
        height: 250px; /* Tinggi 250px sesuai dengan game.tools.alatPolusi.height */
        pointer-events: none;
        border: 3px dashed #00ff00;
        background: rgba(0, 255, 0, 0.1);
        animation: pulseBorder 1.5s infinite;
        display: none; /* Awalnya disembunyikan */
      }

      /* Tambahkan class untuk menampilkan area target */
      .show-placement {
        display: block !important;
      }

      /* Interactive Buttons Styles */
      .interactive-button {
        position: fixed;
        padding: 12px 24px;
        border: none;
        border-radius: 25px;
        font-family: "Arial", sans-serif;
        font-weight: bold;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        text-transform: uppercase;
        letter-spacing: 1px;
        z-index: 100;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.3s ease, transform 0.3s ease;
      }

      .interactive-button.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .interactive-button.home {
        background: linear-gradient(45deg, #00c853, #64dd17);
        color: white;
      }

      .interactive-button.lab {
        background: linear-gradient(45deg, #00bcd4, #00e5ff);
        color: white;
      }

      /* -- Tombol interaksi untuk pohon -- */
      .interactive-button.cut {
        background: linear-gradient(45deg, #d32f2f, #f44336);
        color: white;
      }
      .interactive-button.plant {
        background: linear-gradient(45deg, #388e3c, #4caf50);
        color: white;
      }

      /* Tombol interaksi untuk alat penghilang polusi */
      .interactive-button.polusi {
        background: linear-gradient(45deg, #34495e, #2c3e50);
        color: white;
      }

      .interactive-button:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .interactive-button:active {
        transform: scale(0.95);
      }

      /* Transisi halaman */
      .page-transition {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        opacity: 0;
        pointer-events: none;
        z-index: 1000;
        transition: opacity 0.5s ease;
      }

      .page-transition.active {
        opacity: 1;
      }

      .alat-dom-element {
        position: fixed;
        width: 250px;
        height: 250px;
        pointer-events: none;
        background-image: url("./assets/img/alatPenghilangPolusi.png");
        background-size: contain;
        background-repeat: no-repeat;
        display: none; /* Default hidden */
      }

      #alatPolusi {
        /* Sesuaikan dengan posisi yang diinginkan */
        left: 580px;
        top: 300px;
      }

      /* CSS untuk alat konversi */
      #alatKonversi {
        left: 300px;
        top: 600px;
        width: 130px;
        height: 130px;
        background-image: url("./assets/img/alatKonversi.png");
        transform: translate(0, 0); /* Pastikan posisi default */
      }

      /* Pastikan animasi hanya berlaku untuk alat */
      #alatKonversi {
        animation: none; /* Reset default */
      }

      @keyframes shake {
        0% {
          transform: translate(0, 0);
        }
        20% {
          transform: translate(-3px, 2px);
        }
        40% {
          transform: translate(3px, -2px);
        }
        60% {
          transform: translate(-3px, 1px);
        }
        80% {
          transform: translate(2px, -1px);
        }
        100% {
          transform: translate(0, 0);
        }
      }
      #actionPopup {
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translate(-50%, -20%) scale(0);
        background: linear-gradient(145deg, #1a1a2e, #16213e);
        color: #fff;
        padding: 20px 30px;
        border: 2px solid #00fff9; /* Neon border */
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 255, 249, 0.7),
          0 0 30px rgba(0, 255, 249, 0.3);
        font-size: 16px;
        text-align: center;
        opacity: 0;
        visibility: hidden;
        z-index: 999;
        transition: opacity 0.5s ease, transform 0.5s ease;
      }

      #actionPopup.active {
        opacity: 1;
        visibility: visible;
        transform: translate(-50%, -20%) scale(1);
        animation: glowPulse 2s infinite;
      }

      /* Animasi Glow Pulse untuk nuansa Anime */
      @keyframes glowPulse {
        0% {
          box-shadow: 0 0 10px rgba(0, 255, 249, 0.7),
            0 0 20px rgba(0, 255, 249, 0.3);
        }
        50% {
          box-shadow: 0 0 20px rgba(0, 255, 249, 1),
            0 0 40px rgba(0, 255, 249, 0.6);
        }
        100% {
          box-shadow: 0 0 10px rgba(0, 255, 249, 0.7),
            0 0 20px rgba(0, 255, 249, 0.3);
        }
      }

      /* -------------------------- */
      /* Anime-style Modal Updates  */
      /* -------------------------- */
      .modal-container {
        background: linear-gradient(145deg, #1a1a2e 0%, #16213e 100%);
        border: 2px solid #00fff9;
        border-radius: 15px;
        box-shadow: 0 0 30px rgba(0, 255, 249, 0.3);
        transform-style: preserve-3d;
        perspective: 1000px;
        overflow: visible;
      }

      .modal-container::before {
        content: "";
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(155deg, #209902 0%, #0e671a 100%);
        z-index: -1;
        animation: borderGlow 3s linear infinite;
      }

      .modal-close {
        font-family: "Arial Rounded MT Bold", sans-serif;
        text-shadow: 0 0 10px rgba(0, 255, 249, 0.5);
        transition: all 0.3s ease;
      }

      .modal-close:hover {
        transform: rotate(90deg) scale(1.2);
        color: #ff2079;
        text-shadow: 0 0 20px rgba(255, 32, 121, 0.8);
      }

      .nav-arrow {
        background: rgba(0, 255, 249, 0.3);
        border: 2px solid #00fff9;
        box-shadow: 0 0 15px rgba(0, 255, 249, 0.3);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .nav-arrow:hover {
        background: rgba(0, 255, 249, 0.6);
        transform: scale(1.1) rotate(15deg);
      }

      .slide {
        transform: translateZ(0);
        transition: transform 0.5s ease, opacity 0.5s ease;
      }

      .slide img {
        border: 2px solid #00fff9;
        border-radius: 10px;
        box-shadow: 0 0 30px rgba(0, 255, 249, 0.3);
        transform: perspective(500px) rotateX(5deg);
      }

      .mission-item {
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid #00fff9;
        border-radius: 10px;
        padding: 15px;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .mission-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 255, 249, 0.3);
      }

      .mission-progress {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid #00fff9;
      }

      .mission-progress-bar {
        background: linear-gradient(90deg, #00fff9 0%, #ff2079 100%);
        box-shadow: 0 0 10px rgba(0, 255, 249, 0.5);
        position: relative;
      }

      .mission-progress-bar::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          90deg,
          transparent 0%,
          rgba(255, 255, 255, 0.2) 50%,
          transparent 100%
        );
        animation: progressGlow 2s infinite;
      }

      /* Animations */
      @keyframes borderGlow {
        0% {
          background-position: -100% 0;
        }
        100% {
          background-position: 200% 0;
        }
      }

      @keyframes progressGlow {
        0% {
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .mission-icon {
        animation: float 3s ease-in-out infinite;
        transform-origin: center bottom;
        border: 2px solid #00fff9;
        border-radius: 10px;
        padding: 5px;
        background: rgba(0, 0, 0, 0.3);
      }

      .modal-container {
        animation: modalEntrance 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes modalEntrance {
        0% {
          transform: scale(0.8) rotateX(-30deg);
          opacity: 0;
        }
        100% {
          transform: scale(1) rotateX(0);
          opacity: 1;
        }
      }

      /* Inventory Styles */
      .inventory-modal .modal-container {
        max-width: 500px;
        background: linear-gradient(145deg, #1a1a2e, #16213e);
      }

      .inventory-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        padding: 20px;
      }

      .inventory-slot {
        position: relative;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid #00fff9;
        border-radius: 10px;
        padding: 15px;
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        overflow: hidden; /* Tambahkan ini untuk mencegah overflow */
      }

      .inventory-slot img {
        width: 60%;
        height: auto;
      }

      .item-count {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        padding: 3px 8px;
        border-radius: 10px;
        font-size: 12px;
      }

      .use-button {
        position: absolute;
        bottom: 35px; /* Pindahkan 10px lebih bawah */
        left: 50%;
        transform: translateX(-50%);
        padding: 8px 20px;
        background: #4a7023;
        color: #f5e7d6;
        border: none;
        border-radius: 15px;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.3s ease, transform 0.2s ease;
        white-space: nowrap;
        font-size: 13px;
        width: auto;
        max-width: 90%;
        box-sizing: border-box;
      }

      .tool-slot:hover .use-button {
        opacity: 1;
        transform: translateX(-50%) scale(1.05);
      }

      .placement-guide {
        position: fixed;
        border: 3px dashed #00ff00;
        background: rgba(0, 255, 0, 0.1);
        display: none;
        pointer-events: none;
        animation: pulseBorder 1.5s infinite;
      }

      @keyframes pulseBorder {
        0% {
          opacity: 0.5;
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0.5;
        }
      }

      /* Placement Hint Styles */
      .placement-hint {
        position: fixed;
        display: none;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        z-index: 1000;
      }

      .placement-area {
        width: 100%;
        height: 100%;
        border: 3px dashed #00ff00;
        background: rgba(0, 255, 0, 0.1);
        animation: pulseBorder 1.5s infinite;
      }

      .pasang-button {
        padding: 8px 20px;
        background: #00ff88;
        color: #1a1a2e;
        border: none;
        border-radius: 20px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .pasang-button:hover {
        transform: scale(1.1);
        box-shadow: 0 0 15px #00ff88;
      }

      .alat-installed {
        user-select: none;
        pointer-events: none;
        image-rendering: crisp-edges;
      }

      /* Update modal container */
      .modal-container {
        background: #f8f9fa; /* Warna background lebih terang */
        border: 2px solid #00fff9;
        box-shadow: 0 0 30px rgba(0, 255, 249, 0.2);
      }

      /* Update text container */
      .slide p {
        color: #2d3436; /* Warna teks lebih gelap */
        font-size: 17px;
        line-height: 1.7;
        padding: 20px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 10px;
        margin: 20px 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      /* Tambahkan numbering untuk langkah-langkah */
      .slide p strong {
        color: #00a8ff; /* Warna aksen untuk tombol */
        font-weight: 600;
      }

      /* Perbaikan spacing */
      .slide {
        padding: 15px 30px;
      }

      /* Update judul */
      .modal-container h2 {
        color: #2d3436;
        font-size: 24px;
        margin-bottom: 15px;
        text-shadow: 0 2px 4px rgba(0, 255, 249, 0.2);
      }

      /* -------------------------- */
      /* Guide Modal Specific Styles */
      /* -------------------------- */
      .guide-modal .modal-container {
        background: #046d04;
        border: 2px solid #00ff22;
        box-shadow: 0 0 30px rgba(0, 255, 249, 0.2);
      }

      .guide-modal .modal-container h2 {
        color: #2d3436;
        font-size: 24px;
        margin-bottom: 15px;
        text-shadow: 0 2px 4px rgba(0, 255, 249, 0.2);
      }

      .guide-modal .slide {
        padding: 15px 30px;
      }

      .guide-modal .slide p {
        color: #2d3436;
        font-size: 17px;
        line-height: 1.7;
        padding: 20px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 10px;
        margin: 20px 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .guide-modal .slide p strong {
        color: #00a8ff;
        font-weight: 600;
      }

      /* -------------------------- */
      /* Quest Modal Specific Styles */
      /* -------------------------- */
      .quest-modal .modal-container {
        background: #fdf3e3; /* Warna kertas atau parchment */
        border: 4px solid #9e735f; /* Border dengan nuansa kayu */
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        padding: 20px 30px;
        max-width: 500px;
        width: 90%;
        position: relative;
        animation: questPopupEntrance 0.5s ease-out;
      }

      .quest-modal .quest-header {
        text-align: center;
        font-family: "Georgia", serif;
        font-size: 28px;
        color: white;
        margin-bottom: 15px;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.6);
      }

      .quest-modal .quest-label {
        padding: 6px 12px;
        background: #d4a373;
        color: #fff;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-radius: 4px;
        margin-bottom: 15px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .quest-modal .mission-item {
        background: #fff8e1;
        border: 1px solid #d4a373;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 10px;
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .quest-modal .mission-item:last-child {
        margin-bottom: 0;
      }

      .quest-modal .mission-icon {
        width: 50px;
        height: 50px;
        object-fit: contain;
      }

      .quest-modal .mission-details {
        flex: 1;
      }

      .quest-modal .mission-title {
        font-family: "Georgia", serif;
        font-size: 20px;
        color: #5c3a21;
        margin: 0 0 5px 0;
        border-bottom: 1px solid #d4a373;
        padding-bottom: 5px;
      }

      .quest-modal .mission-progress {
        width: 100%;
        height: 12px;
        background: #e0cfc3;
        border-radius: 6px;
        overflow: hidden;
        margin-top: 5px;
      }

      .quest-modal .mission-progress-bar {
        height: 100%;
        width: 0;
        background: #9e735f;
        transition: width 0.5s ease-in-out;
      }

      /* Optional: Sembunyikan partikel quest jika tidak diinginkan */
      .quest-modal .quest-particle {
        display: none;
      }

      /* ----------------------------------------- */
      /* Tambahan styling untuk tampilan quest UI  */
      /* ----------------------------------------- */
      @keyframes questPopupEntrance {
        0% {
          transform: scale(0.8);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* Ubah tampilan quest label agar tampak seperti banner informasi quest objective */
      .quest-modal .quest-label {
        padding: 5px 10px;
        background: #754e1a;
        display: inline-block;
        border-radius: 5px;
        font-weight: bold;
        letter-spacing: 1px;
      }

      /* Ubah tampilan judul misi agar lebih tegas dan modern */
      .quest-modal .mission-title {
        margin: 0;
        font-size: 15px;
        color: #000; /* Warna terang untuk judul misi */
        border-bottom: 1px solid #4e5d6c;
        padding-bottom: 5px;
        margin-bottom: 10px;
      }

      /* -------------------------- */
      /* Anime Style Guide Modal */
      /* -------------------------- */
      .guide-modal .modal-container {
        background: linear-gradient(155deg, #209902 0%, #00ff22 100%);
        border: 2px solid #011c80;
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(77, 208, 225, 0.5),
          0 5px 15px rgba(0, 0, 0, 0.1);
        /* Menghapus rotasi untuk menghindari bug animasi */
        overflow: hidden;
        position: relative;
      }

      /* Neon Border Animation */
      @keyframes border-glow {
        0% {
          border-color: #4dd0e1;
          box-shadow: 0 0 15px rgba(77, 208, 225, 0.4);
        }
        50% {
          border-color: #81d4fa;
          box-shadow: 0 0 20px rgba(129, 212, 250, 0.5);
        }
        100% {
          border-color: #4dd0e1;
          box-shadow: 0 0 15px rgba(77, 208, 225, 0.4);
        }
      }

      .guide-modal .modal-container {
        animation: border-glow 4s infinite;
      }

      /* Header Style */
      .guide-modal .modal-container h2 {
        color: #264653;
        font-family: "Helvetica", sans-serif;
        font-size: 35px;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        margin-bottom: 20px;
        position: relative;
        display: inline-block;
        top: 20px;
        padding: 0 15px;
      }

      .guide-modal .modal-container h2::after {
        content: "";
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 60%;
        height: 2px;
        background: linear-gradient(90deg, transparent, #4dd0e1, transparent);
      }

      /* Content (Slide) Styling */
      .guide-modal .slide {
        padding: 20px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 10px;
        margin: 15px 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .guide-modal .slide p {
        color: #333;
        font-size: 16px;
        line-height: 1.6;
        padding: 15px;
        margin: 0;
        background: transparent;
      }

      .guide-modal .slide p strong {
        color: #4dd0e1;
        font-weight: bold;
      }

      /* Image Styling */
      .guide-modal .slide img {
        border-radius: 8px;
        border: 1px solid #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        max-height: 35vh;
        width: auto;
        margin: 0 auto;
        object-fit: cover;
        transition: transform 0.3s ease;
      }

      .guide-modal .slide img:hover {
        transform: scale(1.03);
      }

      /* Navigation Arrows */
      .guide-modal .nav-arrow {
        background: rgba(77, 208, 225, 0.8);
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .guide-modal .nav-arrow:hover {
        transform: scale(1.1);
        box-shadow: 0 0 12px rgba(0, 0, 0, 0.3);
      }

      /* Particle Effects & Entrance Animation */
      .guide-modal .modal-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 20% 20%,
            rgba(77, 208, 225, 0.05) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 80%,
            rgba(129, 212, 250, 0.05) 0%,
            transparent 50%
          );
        pointer-events: none;
        animation: particle-float 30s infinite linear;
      }

      @keyframes particle-float {
        0% {
          transform: translate(0, 0);
        }
        100% {
          transform: translate(10px, 5px);
        }
      }

      .guide-modal.active .modal-container {
        animation: modal-entrance 0.5s ease-out;
      }

      @keyframes modal-entrance {
        0% {
          transform: translateY(30px) scale(0.9);
          opacity: 0;
        }
        100% {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
      }

      /* Layout Horizontal */
      .guide-modal .modal-container {
        max-width: 90vw;
        width: 800px;
        height: 80vh;
        display: flex;
        flex-direction: column;
      }

      .guide-modal .slides {
        flex-grow: 1;
        display: flex;
        overflow: hidden;
      }

      .guide-modal .slide-track {
        flex-direction: row;
        height: 100%;
        transition: transform 0.5s ease-in-out;
        display: flex;
      }

      .guide-modal .slide {
        min-width: 100%;
        min-height: 100%;
        padding: 15px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      /* Inventory Tas Baru: Letak dipindah ke pojok kiri bawah dan ukurannya diperbesar */
      #inventoryButton {
        position: fixed;
        left: 20px;
        bottom: 20px;
        width: 100px;
        height: 100px;
        z-index: 100;
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        padding: 10px;
        cursor: pointer;
      }

      /* Updated Inventory Styles */
      .inventory-modal .modal-container {
        background: #2d1b0f
          url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQIW2NkQAKrVq36zwjjgzhhYWGMYAEYB8RmROaABADeOQ8CXl/xfgAAAABJRU5ErkJggg==");
        border: 4px solid #5a432e;
        border-radius: 12px;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.5),
          inset 0 0 10px rgba(255, 255, 255, 0.1);
        max-width: 600px;
        padding: 25px;
        font-family: "Courier New", monospace;
      }

      .inventory-modal h2 {
        color: #f5e7d6;
        text-shadow: 2px 2px #3a2a1a;
        font-size: 28px;
        text-align: center;
        margin-bottom: 25px;
        letter-spacing: 2px;
      }

      .inventory-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 15px;
        padding: 15px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
      }

      .inventory-slot {
        position: relative;
        background: rgba(90, 67, 46, 0.8);
        border: 2px solid #3a2a1a;
        border-radius: 8px;
        padding: 12px;
        aspect-ratio: 1;
        transition: all 0.2s ease;
        cursor: pointer;
      }

      .inventory-slot:hover {
        background: #5a432e;
        transform: scale(1.05);
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      }

      .inventory-slot img {
        width: 80%;
        height: auto;
        filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.5));
      }

      .item-name {
        position: absolute;
        bottom: 5px;
        left: 0;
        right: 0;
        color: #f5e7d6;
        font-size: 12px;
        text-align: center;
        text-shadow: 1px 1px #3a2a1a;
        padding: 2px;
        background: rgba(58, 42, 26, 0.8);
        border-radius: 4px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .item-count {
        position: absolute;
        top: 5px;
        right: 5px;
        background: #3a2a1a;
        color: #f5e7d6;
        padding: 3px 8px;
        border-radius: 10px;
        font-size: 14px;
        font-weight: bold;
        min-width: 25px;
        text-align: center;
        border: 1px solid #5a432e;
      }

      .use-button {
        position: absolute;
        bottom: 35px; /* Pindahkan 10px lebih bawah */
        left: 50%;
        transform: translateX(-50%);
        padding: 8px 20px;
        background: #4a7023;
        color: #f5e7d6;
        border: none;
        border-radius: 15px;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.3s ease, transform 0.2s ease;
        white-space: nowrap;
        font-size: 13px;
        width: auto;
        max-width: 90%;
        box-sizing: border-box;
      }

      .use-button:hover {
        background: #5a8833;
        transform: translateX(-50%) scale(1.05);
        box-shadow: 0 0 10px rgba(74, 112, 35, 0.6);
      }

      /* Guide Modal Styling */
      .guide-modal .modal-container {
        background: linear-gradient(145deg, #1a4d1a, #0d3d0d);
        border: 3px solid #4caf50;
        max-width: 800px;
        width: 90%;
        padding: 30px;
        box-shadow: 0 0 30px rgba(76, 175, 80, 0.3);
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative; /* Tambahkan ini */
      }

      .guide-modal h2 {
        color: #fff;
        font-size: 28px; /* Ukuran font dikecilkan */
        text-align: center;
        margin: 0 0 30px 0; /* Sesuaikan margin */
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        width: 100%; /* Tambahkan ini */
        padding: 0 40px; /* Tambahkan padding agar tidak tertutup tombol close */
        box-sizing: border-box; /* Tambahkan ini */
      }

      .slide-title {
        color: #4caf50;
        font-size: 22px; /* Ukuran font dikecilkan */
        margin: 0 0 20px 0;
        text-align: center;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        width: 100%; /* Tambahkan ini */
        padding: 0 10px; /* Tambahkan padding */
        box-sizing: border-box; /* Tambahkan ini */
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .guide-modal h2 {
          font-size: 24px; /* Ukuran font lebih kecil untuk mobile */
          padding: 0 35px;
        }

        .slide-title {
          font-size: 18px; /* Ukuran font lebih kecil untuk mobile */
        }
      }

      @media (max-width: 480px) {
        .guide-modal h2 {
          font-size: 20px; /* Ukuran font lebih kecil lagi untuk device sangat kecil */
          padding: 0 30px;
        }

        .slide-title {
          font-size: 16px; /* Ukuran font lebih kecil lagi untuk device sangat kecil */
        }
      }

      .slides {
        width: 100%;
        overflow: hidden;
        /* Tambahkan display flex untuk mengatur konten vertikal */
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .slide-track {
        display: flex;
        transition: transform 0.5s ease-in-out;
        width: 100%;
      }

      .slide {
        background: linear-gradient(
          145deg,
          rgba(255, 255, 255, 0.95),
          rgba(240, 240, 240, 0.95)
        );
        border-radius: 20px;
        padding: 30px;
        margin: 15px 0;
        min-width: 100%;
        /* Tambahkan display flex untuk mengatur konten vertikal */
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(76, 175, 80, 0.3);
        position: relative;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        height: auto; /* Tambahkan ini */
        min-height: 500px; /* Tambahkan minimum height */
      }

      .slide:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      }

      .slide img {
        border-radius: 15px;
        border: 3px solid #4caf50;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        max-height: 250px;
        width: auto;
        margin: 20px auto;
        display: block;
        transition: transform 0.3s ease;
        position: relative;
      }

      .slide img:hover {
        transform: scale(1.02);
      }

      .slide-title {
        color: #2e7d32;
        font-size: 24px;
        font-weight: bold;
        margin: 0 0 20px 0;
        padding: 10px 15px;
        position: relative;
        display: block; /* Ubah dari inline-block ke block */
        width: 100%;
        box-sizing: border-box;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 10px;
        z-index: 2; /* Pastikan judul selalu di atas */
      }

      .slide-title::after {
        content: "";
        position: absolute;
        bottom: -4px;
        left: 50%;
        transform: translateX(-50%);
        width: 60%;
        height: 3px;
        background: linear-gradient(90deg, transparent, #4caf50, transparent);
        border-radius: 2px;
      }

      .slide-content {
        background: rgba(255, 255, 255, 0.9);
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        width: 90%;
        max-width: 500px;
        margin: 15px auto;
        border: 1px solid rgba(76, 175, 80, 0.2);
        position: relative;
        backdrop-filter: blur(5px);
        flex-grow: 1; /* Memungkinkan konten mengisi ruang yang tersisa */
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .slide-content p {
        color: #333;
        font-size: 16px;
        line-height: 1.8;
        margin: 0;
        text-align: center;
      }

      .key-control {
        background: linear-gradient(145deg, #4caf50, #45a049);
        color: white;
        padding: 6px 14px;
        border-radius: 8px;
        font-weight: bold;
        margin: 5px 10px;
        display: inline-block;
        min-width: 35px;
        text-align: center;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .key-control:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
      }

      .action-text {
        color: #2e7d32;
        font-weight: bold;
        font-size: 18px;
        display: block;
        margin: 15px 0 10px;
        padding-bottom: 5px;
        border-bottom: 2px dashed rgba(76, 175, 80, 0.3);
      }

      .slide-content ul {
        list-style: none;
        padding: 0;
        margin: 10px 0;
      }

      .slide-content li {
        position: relative;
        padding-left: 25px;
        margin: 10px 0;
        text-align: left;
      }

      .slide-content li::before {
        content: "â€¢";
        color: #4caf50;
        font-size: 20px;
        position: absolute;
        left: 8px;
        top: 50%;
        transform: translateY(-50%);
      }

      @media (max-width: 768px) {
        .slide {
          padding: 20px;
          min-height: 400px; /* Sesuaikan untuk layar kecil */
        }

        .slide-title {
          font-size: 20px;
          padding: 8px 12px;
        }

        .slide img {
          max-height: 180px;
        }

        .slide-content {
          padding: 15px;
          margin: 10px auto;
        }

        .key-control {
          padding: 4px 10px;
          margin: 3px 6px;
          font-size: 14px;
        }

        .action-text {
          font-size: 16px;
        }
      }

      .slide-content p span,
      .slide-content p strong {
        transition: color 0.3s ease;
      }

      .slide-content p span:hover,
      .slide-content p strong:hover {
        color: #4caf50;
      }

      /* Perbaikan untuk tombol navigasi */
      .nav-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        z-index: 10;
      }

      .nav-prev {
        left: 20px;
      }

      .nav-next {
        right: 20px;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .slide-content {
          width: 95%;
          padding: 15px;
        }

        .slide img {
          max-height: 200px;
        }

        .nav-arrow {
          width: 35px;
          height: 35px;
          font-size: 18px;
        }

        .nav-prev {
          left: 10px;
        }

        .nav-next {
          right: 10px;
        }
      }

      .key-control {
        background: #4caf50;
        color: white;
        padding: 4px 12px;
        border-radius: 6px;
        font-weight: bold;
        margin-right: 10px;
        display: inline-block;
        min-width: 30px;
        text-align: center;
      }

      .action-text {
        color: #4caf50;
        font-weight: bold;
        font-size: 18px;
        display: block;
        margin-bottom: 8px;
      }

      /* Navigation Arrows */
      .nav-arrow {
        background: #4caf50;
        color: white;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: none;
        font-size: 24px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }

      .nav-arrow:hover {
        background: #45a049;
        transform: scale(1.1);
      }

      /* Modal Close Button */
      .modal-close {
        background: #4caf50;
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 24px;
        position: absolute;
        right: 15px;
        top: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .modal-close:hover {
        background: #45a049;
        transform: rotate(90deg);
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .guide-modal .modal-container {
          width: 95%;
          padding: 20px;
        }

        .slide-title {
          font-size: 20px;
        }

        .slide img {
          max-height: 200px;
        }

        .slide-content p {
          font-size: 14px;
        }
      }

      /* Perbaikan struktur slide */
      .slide {
        background: linear-gradient(
          145deg,
          rgba(255, 255, 255, 0.95),
          rgba(240, 240, 240, 0.95)
        );
        border-radius: 20px;
        padding: 30px;
        margin: 15px 0;
        min-width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(76, 175, 80, 0.3);
        position: relative;
        height: 600px; /* Tetapkan tinggi tetap */
        overflow: hidden; /* Penting untuk scroll content */
      }

      /* Perbaikan judul slide - selalu di atas */
      .slide-title {
        color: #2e7d32;
        font-size: 24px;
        font-weight: bold;
        margin: 0;
        padding: 15px;
        position: sticky;
        top: 0;
        width: 100%;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 10px;
        z-index: 5;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      /* Container untuk konten yang bisa di-scroll */
      .slide-scrollable-content {
        flex: 1;
        width: 100%;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        /* Styling scrollbar */
        scrollbar-width: thin;
        scrollbar-color: #4caf50 rgba(0, 0, 0, 0.1);
      }

      /* Styling untuk scrollbar pada webkit browsers */
      .slide-scrollable-content::-webkit-scrollbar {
        width: 8px;
      }

      .slide-scrollable-content::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 4px;
      }

      .slide-scrollable-content::-webkit-scrollbar-thumb {
        background: #4caf50;
        border-radius: 4px;
      }

      /* Perbaikan container gambar */
      .slide-image-container {
        width: 100%;
        margin: 15px 0;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-shrink: 0;
      }

      .slide img {
        border-radius: 15px;
        border: 3px solid #4caf50;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        max-height: 250px;
        width: auto;
        object-fit: contain;
      }

      /* Perbaikan konten slide */
      .slide-content {
        background: rgba(255, 255, 255, 0.9);
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        width: 90%;
        max-width: 500px;
        margin: 15px auto;
        border: 1px solid rgba(76, 175, 80, 0.2);
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .slide {
          height: 500px; /* Lebih pendek untuk mobile */
          padding: 20px;
        }

        .slide-title {
          font-size: 20px;
          padding: 10px;
        }

        .slide img {
          max-height: 180px;
        }

        .slide-content {
          padding: 15px;
          margin: 10px auto;
        }
      }

      /* Styling untuk slide content yang lebih nyaman dibaca */
      .slide-content {
        background: linear-gradient(to bottom, #f4e4bc, #e6d5ac);
        padding: 30px;
        border-radius: 20px;
        width: 90%;
        max-width: 550px;
        margin: 15px auto;
        border: 4px solid #5c4a38;
        position: relative;
        box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1),
          0 5px 15px rgba(0, 0, 0, 0.2);
      }

      /* Dekorasi sudut untuk memberikan kesan perkamen/scroll */
      .slide-content::before,
      .slide-content::after {
        content: "";
        position: absolute;
        width: 30px;
        height: 30px;
        background: #5c4a38;
        border-radius: 50%;
      }

      .slide-content::before {
        top: -15px;
        left: -15px;
      }

      .slide-content::after {
        bottom: -15px;
        right: -15px;
      }

      /* Styling untuk teks konten */
      .slide-content p {
        color: #3a2c1f;
        font-size: 18px;
        line-height: 1.8;
        margin: 0;
        text-align: left;
        font-family: "Helvetica", sans-serif;
        text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.5);
      }

      /* Styling untuk tombol kontrol yang lebih menarik */
      .key-control {
        background: #5c4a38;
        color: #f4e4bc;
        padding: 8px 16px;
        border-radius: 8px;
        font-weight: bold;
        margin: 5px 8px;
        display: inline-block;
        min-width: 35px;
        text-align: center;
        box-shadow: inset 0 -4px 0 rgba(0, 0, 0, 0.2),
          0 2px 4px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
        font-size: 16px;
        text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
      }

      .key-control:hover {
        transform: translateY(-2px);
        box-shadow: inset 0 -4px 0 rgba(0, 0, 0, 0.2),
          0 4px 8px rgba(0, 0, 0, 0.3);
        background: #6d5a48;
      }

      /* Styling untuk teks aksi yang lebih menonjol */
      .action-text {
        color: #8b4513;
        font-weight: bold;
        font-size: 20px;
        display: block;
        margin: 20px 0 10px;
        padding-bottom: 8px;
        border-bottom: 2px solid rgba(92, 74, 56, 0.3);
        text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.5);
      }

      /* List styling yang lebih menarik */
      .slide-content ul {
        list-style: none;
        padding: 0;
        margin: 15px 0;
      }

      .slide-content li {
        position: relative;
        padding-left: 30px;
        margin: 12px 0;
        color: #3a2c1f;
      }

      .slide-content li::before {
        content: "âœ¦";
        color: #8b4513;
        position: absolute;
        left: 0;
        font-size: 18px;
      }

      /* Container scrollable yang lebih nyaman */
      .slide-scrollable-content {
        flex: 1;
        width: 100%;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        scrollbar-width: thin;
        scrollbar-color: #8b4513 rgba(244, 228, 188, 0.5);
      }

      /* Custom scrollbar styling */
      .slide-scrollable-content::-webkit-scrollbar {
        width: 10px;
      }

      .slide-scrollable-content::-webkit-scrollbar-track {
        background: rgba(244, 228, 188, 0.5);
        border-radius: 5px;
      }

      .slide-scrollable-content::-webkit-scrollbar-thumb {
        background: #8b4513;
        border-radius: 5px;
        border: 2px solid rgba(244, 228, 188, 0.5);
      }

      /* Styling untuk gambar yang lebih menarik */
      .slide-image-container {
        width: 100%;
        margin: 20px 0;
        padding: 10px;
        background: #fff;
        border: 4px solid #5c4a38;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .slide img {
        border-radius: 8px;
        border: none;
        width: 100%;
        height: auto;
        object-fit: cover;
        transition: transform 0.3s ease;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .slide-content {
          padding: 20px;
          width: 95%;
        }

        .slide-content p {
          font-size: 16px;
        }

        .key-control {
          padding: 6px 12px;
          font-size: 14px;
        }

        .action-text {
          font-size: 18px;
        }
      }

      #soundControl {
        width: 50px;
        height: 48px;
        cursor: pointer;
        transition: transform 0.3s ease, opacity 0.3s ease;
      }

      #soundControl:hover {
        transform: scale(0.9);
      }

      #soundControl:active {
        transform: scale(0.8);
      }

      #soundControl.muted {
        opacity: 0.5;
      }
    </style>
  </head>
  <body>
    <!-- Tambahkan setelah tag <body> -->
    <audio id="backgroundMusic" loop autoplay>
      <source src="./assets/audio/backsoundInGame.mp3" type="audio/mpeg" />
    </audio>

    <!-- Tambahkan audio untuk click sound -->
    <audio id="clickSound">
      <source src="./assets/audio/click.wav" type="audio/wav" />
    </audio>
    <audio id="tebangSound">
      <source src="./assets/audio/tebang.mp3" type="audio/mpeg" />
    </audio>
    <audio id="tanamSound">
      <source src="./assets/audio/tanam.mp3" type="audio/mpeg" />
    </audio>
    <audio id="konversiSound">
      <source src="./assets/audio/konversiAir.mp3" type="audio/mpeg" />
    </audio>

    <!-- Loading Screen -->
    <div id="loadingScreen">Loading...</div>
    <!-- Game Canvas -->
    <canvas id="gameCanvas"></canvas>
    <!-- Blok Rintangan (Road Blocks) -->
    <div class="roadBlock" id="blockTop"></div>
    <div class="roadBlock" id="blockBottom"></div>
    <div class="roadBlock" id="blockLeft"></div>
    <div class="roadBlock" id="blockRight"></div>
    <div class="roadBlock" id="blockHome"></div>
    <div class="roadBlock" id="blockLaboratorium"></div>
    <div class="roadBlock" id="blockTree"></div>
    <div class="roadBlock" id="blockTree2"></div>
    <div class="roadBlock" id="blockGrass"></div>
    <div class="roadBlock" id="blockGrass2"></div>
    <div class="roadBlock" id="tempatAlatKonversi"></div>
    <div class="roadBlock" id="tempatAlatPenghisap"></div>
    <div class="roadBlock" id="blokirKetikaAlatPenghisapMuncul"></div>
    <!-- Updated Markup untuk Status Bars UI -->
    <div class="status-container">
      <div class="status-column">
        <!-- Nature Status Bar (atas kiri) -->
        <div class="status-bar nature">
          <div class="status-icon">
            <svg
              width="49"
              height="49"
              viewBox="0 0 49 49"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle
                cx="24.5"
                cy="24.5"
                r="22.5"
                fill="#B5FF78"
                stroke="black"
                stroke-width="4"
              />
              <path
                d="M36.677 13.3218C36.6618 13.0619 36.5517 12.8166 36.3676 12.6324C36.1835 12.4483 35.9382 12.3382 35.6782 12.323C25.5672 11.7294 17.4683 14.7734 14.0152 20.4844C12.8183 22.438 12.2285 24.703 12.3205 26.9922C12.3806 28.4561 12.6784 29.9005 13.2024 31.2688C13.2332 31.353 13.2847 31.428 13.3524 31.4869C13.42 31.5458 13.5014 31.5866 13.589 31.6056C13.6766 31.6245 13.7676 31.621 13.8535 31.5953C13.9394 31.5696 14.0174 31.5226 14.0803 31.4587L25.3693 19.997C25.468 19.8982 25.5852 19.8199 25.7142 19.7665C25.8432 19.7131 25.9814 19.6856 26.121 19.6856C26.2606 19.6856 26.3989 19.7131 26.5279 19.7665C26.6568 19.8199 26.774 19.8982 26.8728 19.997C26.9715 20.0957 27.0498 20.2129 27.1032 20.3418C27.1566 20.4708 27.1841 20.6091 27.1841 20.7487C27.1841 20.8883 27.1566 21.0265 27.1032 21.1555C27.0498 21.2845 26.9715 21.4017 26.8728 21.5004L14.5358 34.0233L12.6512 35.9079C12.4552 36.0987 12.3382 36.3563 12.3234 36.6294C12.3087 36.9026 12.3972 37.1713 12.5715 37.3821C12.667 37.4926 12.7842 37.5823 12.9158 37.6455C13.0475 37.7087 13.1907 37.7441 13.3367 37.7495C13.4826 37.7548 13.6281 37.73 13.764 37.6767C13.9 37.6233 14.0234 37.5425 14.1267 37.4392L16.3567 35.2093C18.2346 36.1177 20.1299 36.6131 22.0092 36.6795C22.157 36.6848 22.3045 36.6875 22.4514 36.6875C24.5916 36.693 26.6911 36.1035 28.5156 34.9848C34.2266 31.5317 37.272 23.4341 36.677 13.3218Z"
                fill="#1CBF21"
              />
            </svg>
          </div>
          <div class="status-bar-fill"></div>
        </div>
        <!-- Air (Water) Status Bar (bawah kiri) -->
        <div class="status-bar water">
          <div class="status-icon">
            <svg
              width="49"
              height="49"
              viewBox="0 0 49 49"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle
                cx="24.5"
                cy="24.5"
                r="22.5"
                fill="#B8DEFF"
                stroke="black"
                stroke-width="4"
              />
              <path
                d="M24.935 11.655C24.3966 11.1875 23.5891 11.1875 23.0508 11.655C16.1375 17.7467 12.6666 23.045 12.6666 27.55C12.6666 34.605 18.05 39.1667 24 39.1667C29.95 39.1667 35.3333 34.605 35.3333 27.55C35.3333 23.045 31.8625 17.7467 24.935 11.655ZM18.0925 27.8333C18.6166 27.8333 19.0416 28.2017 19.1408 28.7117C19.7216 31.8567 22.3708 32.9333 24.2975 32.7775C24.9066 32.7492 25.4166 33.2308 25.4166 33.84C25.4166 34.4067 24.9633 34.8742 24.3966 34.9025C21.3791 35.0867 17.8516 33.3583 17.0441 29.0658C17.0195 28.914 17.0282 28.7585 17.0695 28.6103C17.1109 28.4621 17.1839 28.3247 17.2836 28.2074C17.3833 28.0902 17.5073 27.9961 17.6469 27.9315C17.7866 27.8669 17.9386 27.8334 18.0925 27.8333Z"
                fill="#26AAF0"
              />
            </svg>
          </div>
          <div class="status-bar-fill"></div>
        </div>
      </div>
      <div class="status-column">
        <!-- Energy Status Bar (atas kanan) -->
        <div class="status-bar energy">
          <div class="status-icon">
            <svg
              width="49"
              height="49"
              viewBox="0 0 49 49"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle
                cx="24.5"
                cy="24.5"
                r="22.5"
                fill="#FFEB00"
                stroke="black"
                stroke-width="4"
              />
              <path
                d="M23.5833 29.25H16.5L26.4167 9.41666V20.75H33.5L23.5833 40.5833V29.25Z"
                fill="#FFB41E"
              />
            </svg>
          </div>
          <div class="status-bar-fill"></div>
        </div>
        <!-- Toxic Status Bar (bawah kanan) -->
        <div class="status-bar toxic">
          <div class="status-icon">
            <svg
              width="49"
              height="49"
              viewBox="0 0 49 49"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle
                cx="24.5"
                cy="24.5"
                r="22.5"
                fill="#D3D1D1"
                stroke="black"
                stroke-width="4"
              />
              <path
                d="M39.8524 29.1942C39.7114 27.3182 38.9122 25.5523 37.5958 24.2083C36.2795 22.8642 34.5306 22.0284 32.658 21.8484C32.5379 21.5942 32.4049 21.3464 32.2595 21.1059C33.1019 19.2524 33.2021 17.1467 32.5396 15.2216C31.877 13.2965 30.5021 11.6984 28.6975 10.7559L28.6789 10.7452C28.6302 10.7201 28.5796 10.6988 28.5275 10.6815C28.274 10.5975 27.9981 10.6121 27.7549 10.7223C27.5116 10.8326 27.3188 11.0304 27.2148 11.2764C27.1108 11.5224 27.1033 11.7985 27.1937 12.0498C27.2841 12.3011 27.4659 12.5091 27.7027 12.6325H27.712C27.8688 12.7241 30.3125 14.0735 30.3125 17.0312C30.3131 17.5966 30.2234 18.1583 30.0469 18.6954C28.5867 17.6134 26.8174 17.0294 25 17.0294C23.1826 17.0294 21.4134 17.6134 19.9531 18.6954C19.7766 18.1583 19.6869 17.5966 19.6875 17.0312C19.6875 14.0629 22.1485 12.7135 22.2973 12.6351C22.5432 12.5035 22.7274 12.2804 22.8103 12.0141C22.8931 11.7478 22.8679 11.4596 22.7402 11.2117C22.6124 10.9637 22.3922 10.776 22.1272 10.689C21.8622 10.602 21.5736 10.6227 21.3238 10.7466L21.3038 10.7572C19.4976 11.7006 18.1214 13.3 17.4582 15.2268C16.7949 17.1536 16.895 19.2613 17.7378 21.1166C17.5917 21.3556 17.4563 21.6026 17.3394 21.8563C15.4672 22.0375 13.7191 22.8739 12.4033 24.2181C11.0876 25.5623 10.2887 27.3279 10.1476 29.2035C10.1268 29.4184 10.1206 29.6345 10.129 29.8503C10.152 30.1216 10.2782 30.3737 10.4816 30.5546C10.6851 30.7356 10.9502 30.8315 11.2223 30.8226C11.4944 30.8138 11.7527 30.7008 11.944 30.507C12.1352 30.3132 12.2447 30.0534 12.25 29.7812C12.25 29.6006 12.2593 29.4213 12.2752 29.25C12.3722 28.4199 12.8145 26.7159 14.7509 25.599C15.2976 25.282 15.8968 25.0656 16.5199 24.9601C16.5067 25.1501 16.4987 25.3426 16.4987 25.5366C16.5004 27.2048 16.9922 28.8357 17.9131 30.2267C18.834 31.6177 20.1433 32.7075 21.6784 33.3605C21.2454 33.9465 20.6961 34.4367 20.0647 34.8002C17.532 36.2612 15.1666 34.848 14.966 34.7232L14.9501 34.7126C14.7138 34.5633 14.4281 34.5132 14.1551 34.5731C13.8821 34.633 13.6437 34.798 13.4915 35.0325C13.3394 35.2669 13.2857 35.5519 13.3422 35.8256C13.3987 36.0994 13.5607 36.3398 13.7933 36.4949L13.8252 36.5148C14.7103 37.0768 15.6978 37.4583 16.7308 37.6376C17.7638 37.8169 18.8221 37.7904 19.8448 37.5597C20.8676 37.3289 21.8347 36.8984 22.6907 36.2929C23.5466 35.6874 24.2745 34.9188 24.8327 34.0312H25.1674C25.7262 34.9182 26.4546 35.6862 27.3107 36.2912C28.1669 36.8962 29.134 37.3263 30.1567 37.5569C31.1793 37.7875 32.2374 37.814 33.2704 37.635C34.3033 37.4559 35.2908 37.0748 36.1762 36.5135L36.2067 36.4936C36.4393 36.3385 36.6014 36.0981 36.6578 35.8243C36.7143 35.5506 36.6607 35.2656 36.5085 35.0312C36.3563 34.7967 36.1179 34.6317 35.8449 34.5718C35.5719 34.5119 35.2863 34.562 35.0499 34.7112L35.034 34.7219C34.8335 34.8467 32.4681 36.2612 29.9353 34.7989C29.303 34.4339 28.7531 33.9419 28.3203 33.3539C29.8552 32.7009 31.1644 31.6114 32.0852 30.2206C33.0061 28.8299 33.4981 27.1992 33.5 25.5312C33.5 25.3373 33.4907 25.1461 33.4788 24.9562C34.1023 25.0611 34.7019 25.277 35.2492 25.5937C37.1709 26.7026 37.6212 28.3907 37.7235 29.2221C37.7407 29.4067 37.75 29.5926 37.75 29.7812C37.746 29.9208 37.7695 30.0597 37.8192 30.1902C37.8689 30.3206 37.9438 30.44 38.0396 30.5415C38.1354 30.643 38.2503 30.7246 38.3777 30.7817C38.5051 30.8388 38.6424 30.8703 38.782 30.8743C38.9215 30.8783 39.0604 30.8548 39.1909 30.8051C39.3213 30.7554 39.4407 30.6805 39.5422 30.5847C39.6437 30.4889 39.7253 30.374 39.7824 30.2466C39.8395 30.1192 39.871 29.9819 39.875 29.8423C39.8822 29.626 39.8746 29.4095 39.8524 29.1942Z"
                fill="black"
              />
            </svg>
          </div>
          <div class="status-bar-fill"></div>
        </div>
      </div>
    </div>

    <!-- Game Icons -->
    <div id="icons">
      <img
        src="./assets/img/guideButton.svg"
        alt="Guide Button"
        class="icon"
        id="guideButton"
      />
      <img src="./assets/img/questButton.svg" alt="Quest Button" class="icon" />
      <img
        src="./assets/img/tas.png"
        alt="Inventory"
        class="icon"
        id="inventoryButton"
      />
      <img
        src="./assets/img/unmuteLogo.svg"
        alt="Sound Control"
        class="icon"
        id="soundControl"
      />
    </div>

    <!-- Popup Modal (Guide) -->
    <div class="modal-overlay guide-modal" id="modalOverlay">
      <div class="modal-container">
        <button class="modal-close" id="modalClose">&times;</button>
        <h2 style="text-align: center; color: white">Cara Bermain</h2>
        <div class="slides">
          <div class="slide-track" id="slideTrack">
            <!-- Slide 1 -->
            <div class="slide">
              <h3 class="slide-title">Navigasi Karakter</h3>
              <div class="slide-scrollable-content">
                <div class="slide-image-container">
                  <img
                    src="./assets/gif/tutorialBerjalan.gif"
                    alt="Tutorial Berjalan"
                  />
                </div>
                <div class="slide-content">
                  <p>
                    Gunakan tombol berikut untuk menggerakkan karakter:<br /><br />
                    <span class="key-control">W</span> Bergerak ke atas<br />
                    <span class="key-control">S</span> Bergerak ke bawah<br />
                    <span class="key-control">A</span> Bergerak ke kiri<br />
                    <span class="key-control">D</span> Bergerak ke kanan
                  </p>
                </div>
              </div>
            </div>
            <!-- Slide 2 -->
            <div class="slide">
              <h3 class="slide-title">Menebang & Menanam Pohon</h3>
              <div class="slide-scrollable-content">
                <div class="slide-image-container">
                  <img
                    src="./assets/gif/tutorialTebangTanam.gif"
                    alt="Tutorial Tebang Tanam"
                  />
                </div>
                <div class="slide-content">
                  <p>
                    <span class="action-text">Menebang Pohon:</span>
                    Status pohon berkurang, tapi kamu mendapat kayu secara acak
                    di inventory.<br /><br />
                    <span class="action-text">Menanam Pohon:</span>
                    Status pohon bertambah, tapi status air berkurang.
                  </p>
                </div>
              </div>
            </div>
            <!-- Slide 3 -->
            <div class="slide">
              <h3 class="slide-title">Inventory</h3>
              <div class="slide-scrollable-content">
                <div class="slide-image-container">
                  <img
                    src="./assets/gif/tutorialInventory.gif"
                    alt="Tutorial Inventory"
                  />
                </div>
                <div class="slide-content">
                  <p>
                    Inventory berada di pojok kiri bawah.<br />
                    Digunakan untuk menyimpan item-item yang kamu dapatkan
                    selama bermain.
                  </p>
                </div>
              </div>
            </div>
            <!-- Slide 4 -->
            <div class="slide">
              <h3 class="slide-title">Rumah</h3>
              <div class="slide-scrollable-content">
                <div class="slide-image-container">
                  <img
                    src="./assets/gif/tutorialRumah.gif"
                    alt="Tutorial Rumah"
                  />
                </div>
                <div class="slide-content">
                  <p>
                    Mendekati rumah untuk memasukinya.<br />
                    Di dalam rumah kamu bisa memakan makanan untuk menambah
                    energi,<br />
                    namun akan menghasilkan limbah sebagai efek sampingnya.
                  </p>
                </div>
              </div>
            </div>
            <!-- Slide 5 -->
            <div class="slide">
              <h3 class="slide-title">Laboratorium</h3>
              <div class="slide-scrollable-content">
                <div class="slide-image-container">
                  <img
                    src="./assets/gif/tutorialLaboratorium.gif"
                    alt="Tutorial Laboratorium"
                  />
                </div>
                <div class="slide-content">
                  <p>
                    <span class="action-text">Di Laboratorium kamu bisa:</span
                    ><br />
                    â€¢ Membuat alat-alat canggih yang bermanfaat<br />
                    â€¢ Mendaur ulang limbah dari aktivitas makan
                  </p>
                </div>
              </div>
            </div>
            <!-- Slide 6 -->
            <div class="slide">
              <h3 class="slide-title">Alat Konversi Air</h3>
              <div class="slide-scrollable-content">
                <div class="slide-image-container">
                  <img
                    src="./assets/gif/tutorialKonversiAir.gif"
                    alt="Tutorial Alat Konversi Air"
                  />
                </div>
                <div class="slide-content">
                  <p>
                    <span class="action-text">Di alat ini kamu bisa:</span
                    ><br />
                    â€¢ Kamu bisa mendapatkan air bersih dengan cara konversi
                    air.<br />
                    â€¢ Konversi air kotor dari sungai menjadi air bersih dengan
                    alat Hydro Converter 3000.<br />
                    â€¢ Menggunakan Hydro Converter 3000 akan menambah status air
                    bersih kamu tetapi akan mengurangiÂ energiÂ kamu
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <button class="nav-arrow nav-prev" id="prevBtn">&#10094;</button>
        <button class="nav-arrow nav-next" id="nextBtn">&#10095;</button>
      </div>
    </div>

    <!-- Popup Modal (Quest) -->
    <div class="modal-overlay quest-modal" id="questModalOverlay">
      <div class="modal-container">
        <button class="modal-close" id="questModalClose">&times;</button>
        <!-- Ubah header dan tambahkan class quest-header -->
        <h2 class="quest-header">Missions</h2>
        <div class="mission-content">
          <!-- Hapus style inline dan update label -->
          <div class="quest-label">Today's Tasks</div>
          <!-- Misi: Buat Alat Konversi Air -->
          <div class="mission-item">
            <img
              src="./assets/img/alatKonversi.png"
              alt="Air Converter Icon"
              class="mission-icon"
            />
            <div class="mission-details">
              <h3 class="mission-title">Buat Alat Konversi Air</h3>
              <div class="mission-progress">
                <div
                  class="mission-progress-bar"
                  id="converterQuestProgress"
                ></div>
              </div>
            </div>
          </div>
          <!-- Misi: Buat Alat Penghilang Polusi -->
          <div class="mission-item">
            <img
              src="./assets/img/alatPenghilangPolusi.png"
              alt="Pollution Removal Icon"
              class="mission-icon"
            />
            <div class="mission-details">
              <h3 class="mission-title">Buat Alat Penghilang Polusi</h3>
              <div class="mission-progress">
                <div
                  class="mission-progress-bar"
                  id="pollutionQuestProgress"
                ></div>
              </div>
            </div>
          </div>
        </div>
        <!-- Jika tidak diperlukan efek partikel, Anda bisa menyembunyikannya secara default -->
        <div class="quest-particle"></div>
      </div>
    </div>

    <!-- Interactive Buttons -->
    <button class="interactive-button home" id="homeButton">Rumah</button>
    <button class="interactive-button lab" id="labButton">Laboratorium</button>
    <!-- Tombol interaksi untuk pohon -->
    <button class="interactive-button cut" id="cutButton">Tebang</button>
    <button class="interactive-button plant" id="plantButton">Tanam</button>
    <!-- Tombol interaksi untuk alat Konversi Air -->
    <button class="interactive-button konversi" id="konversiButton">
      Konversi Air
    </button>
    <!-- Tombol interaksi untuk alat penghilang polusi -->
    <button class="interactive-button polusi" id="polusiButton">
      Nyalakan Mesin
    </button>

    <!-- Page Transition Overlay -->
    <div class="page-transition" id="pageTransition"></div>

    <!-- Tambahkan div untuk alat penghilang polusi di bawah canvas -->
    <div id="alatPolusi" class="alat-dom-element" style="display: none"></div>

    <!-- Tambahkan div untuk alat konversi air -->
    <div id="alatKonversi" class="alat-dom-element" style="display: none"></div>

    <!-- Popup Inventory -->
    <div class="modal-overlay inventory-modal" id="inventoryModal">
      <div class="modal-container">
        <button class="modal-close" id="inventoryClose">&times;</button>
        <h2>INVENTORY</h2>
        <div class="inventory-grid">
          <!-- Slot Item -->
          <div class="inventory-slot" data-item="wood">
            <img src="./assets/img/kayu.svg" alt="Kayu" />
            <span class="item-count">0</span>
            <span class="item-name">Kayu</span>
          </div>
          <div class="inventory-slot" data-item="plastic">
            <img src="./assets/img/plastic.svg" alt="Plastik" />
            <span class="item-count">0</span>
            <span class="item-name">Plastik</span>
          </div>
          <div class="inventory-slot tool-slot" data-item="converter">
            <img src="./assets/img/alatKonversi.png" alt="Alat Konversi" />
            <span class="item-name">Hydro Converter 3000</span>
            <button class="use-button">USE</button>
          </div>
          <div class="inventory-slot tool-slot" data-item="pollution">
            <img
              src="./assets/img/alatPenghilangPolusi.png"
              alt="Alat Polusi"
            />
            <span class="item-name">Polusi Buster 2.0</span>
            <button class="use-button">USE</button>
          </div>
          <!-- Tambahkan slot kosong untuk tampilan grid -->
          <div class="inventory-slot empty-slot"></div>
          <div class="inventory-slot empty-slot"></div>
        </div>
      </div>
    </div>

    <!-- Placement Area -->
    <div id="placementArea" class="placement-guide"></div>

    <!-- Tambahkan div untuk area pasang alat -->
    <div id="placementHint" class="placement-hint">
      <div class="placement-area"></div>
      <button id="confirmPlacement" class="pasang-button">Pasang</button>
    </div>

    <script>
      /***********************
       * Game Code
       ***********************/
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      const loadingScreen = document.getElementById("loadingScreen");

      // Sesuaikan ukuran canvas dengan ukuran window
      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      // Status input keyboard
      const keys = { w: false, s: false, a: false, d: false };

      // Objek game
      const game = {
        player: {
          x: canvas.width / 2,
          y: canvas.height / 2,
          speed: 3,
          maxSpeed: 4,
          acceleration: 0.2,
          friction: 0.15,
          width: 40, // Ukuran normal lebar karakter
          height: 70, // Ukuran normal tinggi karakter
          chopWidth: 65, // Lebar khusus untuk animasi nebang
          chopHeight: 90, // Tinggi khusus untuk animasi nebang
          currentFrame: 0,
          frameInterval: 200,
          lastFrameTime: 0,
          direction: "down",
          velocityX: 0,
          velocityY: 0,
          isMoving: false,
          isChopping: false, // Flag untuk animasi penebangan pada karakter
          chopAnimationStartTime: 0, // Waktu mulai animasi chop
        },
        assets: {
          jiraStay: new Image(),
          leftFrames: [new Image(), new Image(), new Image()],
          rightFrames: [new Image(), new Image(), new Image()],
          downLeftFrame: new Image(),
          downRightFrame: new Image(),
          upLeftFrame: new Image(),
          upRightFrame: new Image(),
          upFrames: [new Image(), new Image()],
          background: new Image(),
          tree: new Image(), // Gambar pohon normal
          treeCut: new Image(), // Gambar pohon gundul (untuk animasi penebangan)
          chopFrames: [new Image(), new Image()], // Frame animasi karakter ketika menebang (nebang1.png dan nebang2.png)
          alatKonversi: new Image(), // Asset untuk alat konversi
          alatPenghilangPolusi: new Image(), // Asset untuk alat penghilang polusi
          downFrames: [new Image(), new Image()], // Tambahkan array frame jalan bawah
        },
        tree: {
          x: 580, // Posisi X pohon normal
          y: 120, // Posisi Y pohon normal
          width: 240, // Lebar pohon normal
          height: 280, // Tinggi pohon normal

          // Properti untuk kondisi pohon gundul
          cutX: 660, // Ubah nilai ini untuk mengatur posisi X pohon gundul
          cutY: 270, // Ubah nilai ini untuk mengatur posisi Y pohon gundul
          cutWidth: 50, // Lebar pohon gundul
          cutHeight: 50, // Tinggi pohon gundul

          isCut: false, // false = pohon normal, true = pohon sudah ditebang/gundul
        },
        currentTreeImage: null, // Akan di-set setelah asset termuat, misalnya game.assets.tree
        loaded: 0,
        required: 22, // Pastikan jumlah ini sudah mencakup asset treeCut juga
      };

      // Definisikan objek baru untuk posisi dan ukuran alat
      game.tools = {
        alatKonversi: { x: 270, y: 600, width: 130, height: 130 },
        // Tambahan: Definisikan juga alat penghilang polusi
        alatPolusi: { x: 580, y: 300, width: 250, height: 250 },
        // Properti untuk animasi shaking pada alat konversi
        konversiShaking: false,
        shakeStartTime: 0,
      };

      // Fungsi untuk memuat asset gambar
      function loadAssets() {
        game.assets.downLeftFrame.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.downLeftFrame.src = "./assets/img/jalanBawahKiri.png";

        game.assets.downRightFrame.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.downRightFrame.src = "./assets/img/jalanBawahKanan.png";

        game.assets.upLeftFrame.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.upLeftFrame.src = "./assets/img/jalanAtasKiri.png";

        game.assets.upRightFrame.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.upRightFrame.src = "./assets/img/jalanAtasKanan.png";

        game.assets.leftFrames.forEach((frame, index) => {
          frame.onload = () => {
            game.loaded++;
            checkLoading();
          };
          frame.src = `./assets/img/jalanKiri${index + 1}.png`;
        });

        game.assets.rightFrames.forEach((frame, index) => {
          frame.onload = () => {
            game.loaded++;
            checkLoading();
          };
          frame.src = `./assets/img/jalanKanan${index + 1}.png`;
        });

        game.assets.upFrames.forEach((frame, index) => {
          frame.onload = () => {
            game.loaded++;
            checkLoading();
          };
          frame.src = `./assets/img/jalanAtas${index + 1}.png`;
        });

        game.assets.jiraStay.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.jiraStay.src = "./assets/img/jiraStay.png";

        game.assets.background.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.background.src = "./assets/img/gameBg.png";

        // Memuat aset pohon (pohon.png)
        game.assets.tree.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.tree.src = "./assets/img/pohon.png";

        // Memuat aset pohon gundul (pohonGundul.png)
        game.assets.treeCut.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.treeCut.src = "./assets/img/pohonGundul.png";

        // Memuat frame animasi untuk karakter (nebang1.png dan nebang2.png)
        game.assets.chopFrames.forEach((frame, index) => {
          frame.onload = () => {
            game.loaded++;
            checkLoading();
          };
          frame.src = `./assets/img/nebang${index + 1}.png`;
        });

        // ==== Pemuatan asset baru ====
        game.assets.alatKonversi.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.alatKonversi.src = "./assets/img/alatKonversi.png";

        game.assets.alatPenghilangPolusi.onload = () => {
          game.loaded++;
          checkLoading();
        };
        game.assets.alatPenghilangPolusi.src =
          "./assets/img/alatPenghilangPolusi.png";

        // Memuat frame jalan bawah
        game.assets.downFrames.forEach((frame, index) => {
          frame.onload = () => {
            game.loaded++;
            checkLoading();
          };
          frame.src = `./assets/img/jalanBawah${index + 1}.png`;
        });

        function checkLoading() {
          if (game.loaded === game.required) {
            loadingScreen.style.display = "none";

            // Ambil status pohon dari localStorage
            const storedTreeState = localStorage.getItem("treeIsCut");
            game.tree.isCut = storedTreeState === "true";
            game.currentTreeImage = game.tree.isCut
              ? game.assets.treeCut
              : game.assets.tree;

            setSpawnPosition();
            updateToolButtons(); // <-- Memperbarui status tombol berdasarkan data di localStorage
            requestAnimationFrame(gameLoop);
            initializeButtons(); // Tambah ini
          }
        }
      }

      // Event listener untuk keyboard
      window.addEventListener("keydown", (e) => {
        if (e.key.toLowerCase() in keys) keys[e.key.toLowerCase()] = true;
      });
      window.addEventListener("keyup", (e) => {
        if (e.key.toLowerCase() in keys) keys[e.key.toLowerCase()] = false;
      });

      // Tombol interaksi dan transisi halaman
      const homeButton = document.getElementById("homeButton");
      const labButton = document.getElementById("labButton");
      const pageTransition = document.getElementById("pageTransition");
      const INTERACTION_DISTANCE = 150;

      // Fungsi navigasi dengan transisi
      function navigateWithTransition(url) {
        pageTransition.classList.add("active");
        setTimeout(() => {
          window.location.href = url;
        }, 500);
      }

      // Fungsi untuk mengatur posisi spawn player dari data spawn tersimpan
      function setSpawnPosition() {
        const spawnX = sessionStorage.getItem("spawnX");
        const spawnY = sessionStorage.getItem("spawnY");
        if (spawnX !== null && spawnY !== null) {
          game.player.x = parseFloat(spawnX) - game.player.width / 2;
          game.player.y = parseFloat(spawnY) - game.player.height / 2;
          sessionStorage.removeItem("spawnX");
          sessionStorage.removeItem("spawnY");
          sessionStorage.removeItem("spawnType");
          return;
        }
        const spawnTarget = sessionStorage.getItem("spawnLocation");
        if (!spawnTarget) return;
        let targetBlock;
        if (spawnTarget === "home") {
          targetBlock = document.getElementById("blockHome");
        } else if (spawnTarget === "lab") {
          targetBlock = document.getElementById("blockLaboratorium");
        }
        if (targetBlock) {
          const rect = targetBlock.getBoundingClientRect();
          game.player.x = rect.left + rect.width / 2 - game.player.width / 2;
          game.player.y = rect.top + rect.height / 2 - game.player.height / 2;
        }
        sessionStorage.removeItem("spawnLocation");
      }

      // Fungsi untuk update posisi player dan mengecek jarak interaksi
      function updatePlayer() {
        const now = Date.now();
        const prevX = game.player.x;
        const prevY = game.player.y;
        game.player.isMoving = false;

        if (keys.w)
          game.player.velocityY = Math.max(
            game.player.velocityY - game.player.acceleration,
            -game.player.maxSpeed
          );
        if (keys.s)
          game.player.velocityY = Math.min(
            game.player.velocityY + game.player.acceleration,
            game.player.maxSpeed
          );
        if (keys.a)
          game.player.velocityX = Math.max(
            game.player.velocityX - game.player.acceleration,
            -game.player.maxSpeed
          );
        if (keys.d)
          game.player.velocityX = Math.min(
            game.player.velocityX + game.player.acceleration,
            game.player.maxSpeed
          );

        if (!keys.w && !keys.s) {
          game.player.velocityY *= 1 - game.player.friction;
          if (Math.abs(game.player.velocityY) < 0.1) game.player.velocityY = 0;
        }
        if (!keys.a && !keys.d) {
          game.player.velocityX *= 1 - game.player.friction;
          if (Math.abs(game.player.velocityX) < 0.1) game.player.velocityX = 0;
        }

        game.player.x += game.player.velocityX;
        game.player.y += game.player.velocityY;

        game.player.x = Math.max(
          0,
          Math.min(game.player.x, canvas.width - game.player.width)
        );
        game.player.y = Math.max(
          0,
          Math.min(game.player.y, canvas.height - game.player.height)
        );

        const canvasRect = canvas.getBoundingClientRect();
        const playerCenter = {
          x: game.player.x + game.player.width / 2 + canvasRect.left,
          y: game.player.y + game.player.height / 2 + canvasRect.top,
        };

        // Tombol Home dan Laboratorium
        const homeBlock = document.getElementById("blockHome");
        const labBlock = document.getElementById("blockLaboratorium");
        const homeRect = homeBlock.getBoundingClientRect();
        const labRect = labBlock.getBoundingClientRect();
        const homeCenter = {
          x: homeRect.left + homeRect.width / 2,
          y: homeRect.top + homeRect.height / 2,
        };
        const labCenter = {
          x: labRect.left + labRect.width / 2,
          y: labRect.top + labRect.height / 2,
        };

        const distanceToHome = Math.hypot(
          playerCenter.x - homeCenter.x,
          playerCenter.y - homeCenter.y
        );
        const distanceToLab = Math.hypot(
          playerCenter.x - labCenter.x,
          playerCenter.y - labCenter.y
        );

        homeButton.classList.toggle(
          "visible",
          distanceToHome < INTERACTION_DISTANCE
        );
        labButton.classList.toggle(
          "visible",
          distanceToLab < INTERACTION_DISTANCE
        );

        if (distanceToHome < INTERACTION_DISTANCE) {
          const buttonWidth = homeButton.offsetWidth;
          homeButton.style.left = `${homeCenter.x - buttonWidth / 2}px`;
          homeButton.style.top = `${homeRect.bottom + 20}px`;
        }

        if (distanceToLab < INTERACTION_DISTANCE) {
          const buttonWidth = labButton.offsetWidth;
          labButton.style.left = `${labCenter.x - buttonWidth / 2}px`;
          labButton.style.top = `${labRect.bottom + 20}px`;
        }

        // Tombol interaksi pohon (Tebang & Tanam)
        const treeRect = {
          left: canvasRect.left + game.tree.x,
          top: canvasRect.top + game.tree.y,
          width: game.tree.width,
          height: game.tree.height,
        };
        const treeCenter = {
          x: treeRect.left + treeRect.width / 2,
          y: treeRect.top + treeRect.height / 2,
        };
        const distanceToTree = Math.hypot(
          playerCenter.x - treeCenter.x,
          playerCenter.y - treeCenter.y
        );

        const cutButton = document.getElementById("cutButton");
        const plantButton = document.getElementById("plantButton");

        if (distanceToTree < INTERACTION_DISTANCE) {
          cutButton.classList.add("visible");
          plantButton.classList.add("visible");
          const buttonMargin = 10;
          // Posisi tombol ditempatkan di bawah pohon
          cutButton.style.left = `${
            treeCenter.x - cutButton.offsetWidth - buttonMargin
          }px`;
          plantButton.style.left = `${treeCenter.x + buttonMargin}px`;
          // Perubahan: tombol akan lebih dekat ke pohon (offset vertikal dari +10 menjadi +10)
          cutButton.style.top = plantButton.style.top = `${
            treeRect.top + treeRect.height - 70
          }px`;
        } else {
          cutButton.classList.remove("visible");
          plantButton.classList.remove("visible");
        }

        // Update visibility alat konversi
        const converterActive =
          localStorage.getItem("converterPlaced") === "true";
        let alatKonversiElement = document.getElementById("alatKonversi");
        if (converterActive) {
          if (!alatKonversiElement) {
            alatKonversiElement = document.createElement("img");
            alatKonversiElement.id = "alatKonversi";
            alatKonversiElement.className = "alat-installed";
            alatKonversiElement.src = "./assets/img/alatKonversi.png";
            alatKonversiElement.style.pointerEvents = "none";
            const pos = game.tools.alatKonversi;
            alatKonversiElement.style.position = "fixed";
            alatKonversiElement.style.left = `${pos.x}px`;
            alatKonversiElement.style.top = `${pos.y}px`;
            alatKonversiElement.style.width = `${pos.width}px`;
            alatKonversiElement.style.height = `${pos.height}px`;
            document.body.appendChild(alatKonversiElement);
          }
          alatKonversiElement.style.display = "block";

          // Hitung jarak ke alat konversi
          const konversiRect = alatKonversiElement.getBoundingClientRect();
          const konversiCenter = {
            x: konversiRect.left + konversiRect.width / 2,
            y: konversiRect.top + konversiRect.height / 2,
          };

          const distanceToKonversi = Math.hypot(
            playerCenter.x - konversiCenter.x,
            playerCenter.y - konversiCenter.y
          );

          if (distanceToKonversi < INTERACTION_DISTANCE) {
            konversiButton.classList.add("visible");
            const buttonWidth = konversiButton.offsetWidth;
            konversiButton.style.left = `${
              konversiCenter.x - buttonWidth / 2
            }px`;
            konversiButton.style.top = `${konversiRect.bottom + 20}px`;
          } else {
            konversiButton.classList.remove("visible");
          }
        } else if (alatKonversiElement) {
          alatKonversiElement.style.display = "none";
          konversiButton.classList.remove("visible");
        }

        // Update visibility untuk Polusion Buster 2.0
        const pollutionActive =
          localStorage.getItem("pollutionPlaced") === "true";
        let alatPolusiElement = document.getElementById("alatPolusi");
        if (pollutionActive) {
          if (!alatPolusiElement) {
            alatPolusiElement = document.createElement("img");
            alatPolusiElement.id = "alatPolusi";
            alatPolusiElement.className = "alat-installed";
            alatPolusiElement.src = "./assets/img/alatPenghilangPolusi.png";
            const pos = game.tools.alatPolusi;
            alatPolusiElement.style.position = "fixed";
            alatPolusiElement.style.left = `${pos.x}px`;
            alatPolusiElement.style.top = `${pos.y}px`;
            alatPolusiElement.style.width = `${pos.width}px`;
            alatPolusiElement.style.height = `${pos.height}px`;
            document.body.appendChild(alatPolusiElement);
          }
          alatPolusiElement.style.display = "block";

          // Hitung jarak ke alat polusi
          const polusiRect = alatPolusiElement.getBoundingClientRect();
          const polusiCenter = {
            x: polusiRect.left + polusiRect.width / 2,
            y: polusiRect.top + polusiRect.height / 2,
          };

          const distanceToPolusi = Math.hypot(
            playerCenter.x - polusiCenter.x,
            playerCenter.y - polusiCenter.y
          );

          if (distanceToPolusi < INTERACTION_DISTANCE) {
            polusiButton.classList.add("visible");
            const buttonWidth = polusiButton.offsetWidth;
            polusiButton.style.left = `${polusiCenter.x - buttonWidth / 2}px`;
            polusiButton.style.top = `${polusiRect.bottom - 20}px`;
          } else {
            polusiButton.classList.remove("visible");
          }
        } else if (alatPolusiElement) {
          alatPolusiElement.style.display = "none";
          polusiButton.classList.remove("visible");
        }

        // --- End Modified ---

        // Collision detection (blok rintangan)
        let collisionDetected = false;
        const playerRect = {
          x: game.player.x,
          y: game.player.y,
          width: game.player.width,
          height: game.player.height,
        };
        const blocks = document.querySelectorAll(".roadBlock");
        blocks.forEach((blockElem) => {
          const blockRect = blockElem.getBoundingClientRect();
          if (
            playerRect.x < blockRect.left + blockRect.width &&
            playerRect.x + playerRect.width > blockRect.left &&
            playerRect.y < blockRect.top + blockRect.height &&
            playerRect.y + playerRect.height > blockRect.top
          ) {
            collisionDetected = true;
          }
        });
        if (collisionDetected) {
          game.player.x = prevX;
          game.player.y = prevY;
          game.player.velocityX = 0;
          game.player.velocityY = 0;
        }

        if (game.player.velocityX !== 0 || game.player.velocityY !== 0) {
          game.player.isMoving = true;
          if (game.player.velocityY < 0) {
            if (game.player.velocityX > 0) game.player.direction = "up-right";
            else if (game.player.velocityX < 0)
              game.player.direction = "up-left";
            else game.player.direction = "up";
          } else if (game.player.velocityY > 0) {
            if (game.player.velocityX > 0) game.player.direction = "down-right";
            else if (game.player.velocityX < 0)
              game.player.direction = "down-left";
            else game.player.direction = "down";
          } else {
            game.player.direction =
              game.player.velocityX > 0 ? "right" : "left";
          }
        } else {
          game.player.isMoving = false;
          game.player.currentFrame = 0;
        }

        if (
          game.player.isMoving &&
          Date.now() - game.player.lastFrameTime > game.player.frameInterval
        ) {
          if (game.player.direction === "up") {
            game.player.currentFrame = (game.player.currentFrame + 1) % 2;
          } else if (
            game.player.direction === "left" ||
            game.player.direction === "right"
          ) {
            game.player.currentFrame = (game.player.currentFrame + 1) % 3;
          } else if (game.player.direction === "down") {
            game.player.currentFrame = (game.player.currentFrame + 1) % 2; // Gunakan modulo 2 untuk 2 frame
          }
          game.player.lastFrameTime = Date.now();
        }

        updateInteractiveButtons();
      }

      // Menggambar background
      function drawBackground() {
        const img = game.assets.background;
        const canvasRatio = canvas.width / canvas.height;
        const imgRatio = img.width / img.height;
        let drawWidth, drawHeight, xOffset, yOffset;
        if (canvasRatio > imgRatio) {
          drawWidth = canvas.width;
          drawHeight = (canvas.width / img.width) * img.height;
          xOffset = 0;
          yOffset = (canvas.height - drawHeight) / 2;
        } else {
          drawHeight = canvas.height;
          drawWidth = (canvas.height / img.height) * img.width;
          xOffset = (canvas.width - drawWidth) / 2;
          yOffset = 0;
        }
        ctx.drawImage(img, xOffset, yOffset, drawWidth, drawHeight);
      }

      // Menggambar player (override dengan animasi chop jika sedang menebang)
      function drawPlayer() {
        // Gambar bayangan backlight (bayangan di belakang karakter)
        ctx.save();
        ctx.beginPath();
        // Tentukan posisi pusat bayangan: di atas (membelakangi) karakter
        const shadowCenterX = game.player.x + game.player.width / 2;
        // Posisi Y dikurangi (lebih tinggi dari tengah karakter)
        const shadowCenterY = game.player.y + game.player.height / 1; // ubah nilai -30 jika perlu
        // Atur dimensi bayangan agar lebih lebar dan tipis
        const shadowRadiusX = game.player.width * 0.6;
        const shadowRadiusY = game.player.height * 0.2;

        ctx.ellipse(
          shadowCenterX,
          shadowCenterY,
          shadowRadiusX,
          shadowRadiusY,
          0,
          0,
          2 * Math.PI
        );
        // Gunakan opacity tinggi agar bayangan lebih terlihat
        ctx.fillStyle = "rgba(0, 0, 0, 0.3)";
        // Aktifkan properti bayangan di context
        ctx.shadowColor = "rgba(0, 0, 0, 0.6)";
        ctx.shadowBlur = 15;
        ctx.fill();
        ctx.restore();

        // Gambar sprite karakter seperti semula
        let currentFrame;
        if (game.player.isChopping) {
          const elapsed = Date.now() - game.player.chopAnimationStartTime;
          const frameIndex =
            Math.floor(elapsed / 200) % game.assets.chopFrames.length;
          currentFrame = game.assets.chopFrames[frameIndex];
        } else if (!game.player.isMoving) {
          currentFrame = game.assets.jiraStay;
        } else {
          switch (game.player.direction) {
            case "up":
              // Pastikan frame "up" tersedia sebelum menggunakannya
              currentFrame =
                game.assets.upFrames[
                  game.player.currentFrame % game.assets.upFrames.length
                ] || game.assets.jiraStay;
              break;
            case "down":
              currentFrame =
                game.assets.downFrames[game.player.currentFrame % 2] ||
                game.assets.jiraStay;
              break;
            case "left":
              currentFrame =
                game.assets.leftFrames[game.player.currentFrame % 3] ||
                game.assets.jiraStay;
              break;
            case "right":
              currentFrame =
                game.assets.rightFrames[game.player.currentFrame % 3] ||
                game.assets.jiraStay;
              break;
            case "down-left":
              currentFrame = game.assets.downLeftFrame;
              break;
            case "down-right":
              currentFrame = game.assets.downRightFrame;
              break;
            case "up-left":
              currentFrame = game.assets.upLeftFrame;
              break;
            case "up-right":
              currentFrame = game.assets.upRightFrame;
              break;
            default:
              currentFrame = game.assets.jiraStay;
          }
        }

        // Tambahkan pengecekan frame sebelum menggambar
        if (
          !currentFrame ||
          !currentFrame.complete ||
          currentFrame.naturalHeight === 0
        ) {
          // Jika frame tidak tersedia, gunakan frame default (jiraStay)
          currentFrame = game.assets.jiraStay;
        }

        const drawWidth = game.player.isChopping
          ? game.player.chopWidth
          : game.player.width;
        const drawHeight = game.player.isChopping
          ? game.player.chopHeight
          : game.player.height;
        ctx.drawImage(
          currentFrame,
          game.player.x,
          game.player.y,
          drawWidth,
          drawHeight
        );
      }

      // Menggambar pohon menggunakan game.currentTreeImage
      function drawTree() {
        // Cek apakah gambar pohon yang sedang digunakan adalah aset pohon gundul (treeCut)
        const isCutState = game.currentTreeImage === game.assets.treeCut;

        // Tentukan ukuran gambar yang akan digunakan (sesuai state)
        const drawWidth =
          isCutState && game.tree.cutWidth
            ? game.tree.cutWidth
            : game.tree.width;
        const drawHeight =
          isCutState && game.tree.cutHeight
            ? game.tree.cutHeight
            : game.tree.height;

        // Jika dalam state gundul dan properti cutX/cutY telah didefinisikan, gunakan posisi tersebut
        const posX =
          isCutState && typeof game.tree.cutX !== "undefined"
            ? game.tree.cutX
            : game.tree.x;
        const posY =
          isCutState && typeof game.tree.cutY !== "undefined"
            ? game.tree.cutY
            : game.tree.y;

        ctx.drawImage(game.currentTreeImage, posX, posY, drawWidth, drawHeight);
      }

      // Game loop utama
      function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBackground();
        drawTree();
        updatePlayer();
        drawPlayer();
        requestAnimationFrame(gameLoop);
      }

      loadAssets();

      /***********************
       * Guide Popup & Slider Code
       ***********************/
      const guideButton = document.getElementById("guideButton");
      const modalOverlay = document.getElementById("modalOverlay");
      const modalClose = document.getElementById("modalClose");
      const slideTrack = document.getElementById("slideTrack");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      let currentSlide = 0;

      // Fungsi untuk mengupdate visibilitas tombol navigasi
      function updateNavigationButtons() {
        // Sembunyikan tombol prev jika di slide pertama
        if (currentSlide === 0) {
          prevBtn.style.visibility = "hidden"; // Ganti dari display ke visibility
        } else {
          prevBtn.style.visibility = "visible";
        }
        
        // Sembunyikan tombol next jika di slide terakhir
        if (currentSlide === slideTrack.children.length - 1) {
          nextBtn.style.visibility = "hidden"; // Ganti dari display ke visibility
        } else {
          nextBtn.style.visibility = "visible";
        }
      }

      function updateSlide() {
        slideTrack.style.transform = `translateX(-${currentSlide * 100}%)`;
        updateNavigationButtons(); // Pastikan ini dipanggil
      }

      guideButton.addEventListener("click", () => {
        modalOverlay.classList.add("active");
        currentSlide = 0;
        updateSlide(); // Ini akan memanggil updateNavigationButtons()
      });

      nextBtn.addEventListener("click", () => {
        if (currentSlide < slideTrack.children.length - 1) {
          currentSlide++;
          updateSlide();
        }
      });

      prevBtn.addEventListener("click", () => {
        if (currentSlide > 0) {
          currentSlide--;
          updateSlide();
        }
      });

      modalClose.addEventListener("click", () => {
        modalOverlay.classList.remove("active");
      });

      window.addEventListener("click", (e) => {
        if (e.target === modalOverlay) modalOverlay.classList.remove("active");
      });

      // Fungsi untuk mengupdate status bar
      function updateStatusBar(barClass, percentage) {
        const barFill = document.querySelector(`.${barClass} .status-bar-fill`);
        if (barFill) {
          percentage = Math.max(0, Math.min(percentage, 100));
          barFill.style.width = `${percentage}%`;
        }
      }
      updateStatusBar("nature", 100);
      updateStatusBar("water", 100);
      updateStatusBar("energy", 100);
      updateStatusBar("toxic", 100);

      // Quest Popup Code
      const questButton = document.querySelector('.icon[alt="Quest Button"]');
      const questModalOverlay = document.getElementById("questModalOverlay");
      const questModalClose = document.getElementById("questModalClose");
      questButton.addEventListener("click", () => {
        questModalOverlay.classList.add("active");
      });
      questModalClose.addEventListener("click", () => {
        questModalOverlay.classList.remove("active");
      });
      window.addEventListener("click", (e) => {
        if (e.target === questModalOverlay)
          questModalOverlay.classList.remove("active");
      });
      function updateMissionProgress(percentage) {
        const progressBar = document.querySelector(".mission-progress-bar");
        if (progressBar) {
          percentage = Math.max(0, Math.min(percentage, 100));
          progressBar.style.width = `${percentage}%`;
        }
      }
      updateMissionProgress(50);

      // Tombol Home
      homeButton.addEventListener("click", () => {
        const buttonRect = homeButton.getBoundingClientRect();
        const canvasRect = canvas.getBoundingClientRect();
        const spawnX = buttonRect.left - canvasRect.left + buttonRect.width / 2;
        const spawnY = buttonRect.top - canvasRect.top + buttonRect.height / 2;
        sessionStorage.setItem("spawnX", spawnX);
        sessionStorage.setItem("spawnY", spawnY);
        sessionStorage.setItem("spawnType", "home");
        navigateWithTransition("home.html");
      });

      // Tombol Laboratorium
      labButton.addEventListener("click", () => {
        const buttonRect = labButton.getBoundingClientRect();
        const canvasRect = canvas.getBoundingClientRect();
        const spawnX = buttonRect.left - canvasRect.left + buttonRect.width / 2;
        const spawnY = buttonRect.top - canvasRect.top + buttonRect.height / 2;
        sessionStorage.setItem("spawnX", spawnX);
        sessionStorage.setItem("spawnY", spawnY);
        sessionStorage.setItem("spawnType", "lab");
        navigateWithTransition("laboratorium.html");
      });

      // Fungsi animasi untuk aksi tebangan pohon & animasi karakter menebang
      function animateTreeCut() {
        if (game.tree.isCut) return;

        // Ubah status pohon ke gundul secara permanen
        game.tree.isCut = true;
        game.currentTreeImage = game.assets.treeCut;
        localStorage.setItem("treeIsCut", "true");
      }

      function animatePlayerChop() {
        if (game.player.isChopping) return;
        game.player.isChopping = true;
        game.player.chopAnimationStartTime = Date.now();
        setTimeout(() => {
          game.player.isChopping = false;
        }, 800);
      }

      // --- Aksi Tebang (Cut) ---
      const cutButton = document.getElementById("cutButton");
      cutButton.addEventListener("click", () => {
        // Cek apakah pohon bisa ditebang
        if (
          game.tree.isCut ||
          status.nature < 10 ||
          status.energy < 5 ||
          game.player.isChopping
        )
          return;

        // Mainkan sound effect tebang
        const tebangSound = document.getElementById("tebangSound");
        tebangSound.currentTime = 0;
        tebangSound
          .play()
          .catch((error) => console.log("Tebang sound failed to play:", error));

        game.player.isChopping = true;
        animatePlayerChop();
        animateTreeCut();

        // Update status: Nature -10%, Energy -5%
        status.nature = Math.max(0, status.nature - 10);
        status.energy = Math.max(0, status.energy - 5);

        // Tambahkan kayu secara acak antara 1 hingga 10
        const randomWood = Math.floor(Math.random() * 10) + 1;
        resources.wood += randomWood;

        updateStatusBarUI();
        saveStatus();
        localStorage.setItem("wood", resources.wood);

        // Ubah state tombol
        cutButton.disabled = true;
        plantButton.disabled = false;

        showActionPopup(
          `Pohon berhasil ditebang! Pohon berkurang sebanyak -10% dan Energy berkurang sebanyak -5% \n Kayu didapatkan sebanyak +${randomWood}.`
        );

        // Update progress quest
        updateQuestProgress();

        // Reset flag chopping setelah animasi selesai (misalnya 1 detik)
        setTimeout(() => {
          game.player.isChopping = false;
        }, 1000);
      });

      // --- Aksi Tanam (Plant) ---
      const plantButton = document.getElementById("plantButton");
      plantButton.addEventListener("click", () => {
        // Mainkan sound effect tanam
        const tanamSound = document.getElementById("tanamSound");
        tanamSound.currentTime = 0;
        tanamSound
          .play()
          .catch((error) => console.log("Tanam sound failed to play:", error));

        game.tree.isCut = false;
        game.currentTreeImage = game.assets.tree;
        localStorage.setItem("treeIsCut", "false");

        // Update status: Nature +7%, Water -10%
        status.nature = Math.min(100, status.nature + 7);
        status.water = Math.max(0, status.water - 10);

        updateStatusBarUI();
        saveStatus();

        // Ubah state tombol
        cutButton.disabled = false;
        plantButton.disabled = true;

        showActionPopup(
          "Pohon ditanam! Pohon meningkat sebanyak +7% dan Air berkurang sebanyak -10%."
        );

        updateQuestProgress();
      });

      // --- Aksi Konversi Air ---
      const konversiButton = document.getElementById("konversiButton");
      function triggerShakeAnimation() {
        const isConverterPlaced =
          localStorage.getItem("converterPlaced") === "true";
        if (!isConverterPlaced) {
          showActionPopup("Alat Konversi Air belum dipasang!");
          return;
        }

        const alatKonversi = document.getElementById("alatKonversi");
        // Reset animasi terlebih dahulu
        alatKonversi.style.animation = "none";
        void alatKonversi.offsetWidth; // Memicu reflow
        // Jalankan animasi shake
        alatKonversi.style.animation = "shake 0.5s ease-in-out";
        setTimeout(() => {
          alatKonversi.style.animation = "";
        }, 500);
      }

      konversiButton.addEventListener("click", function () {
        const isConverterPlaced =
          localStorage.getItem("converterPlaced") === "true";
        if (!isConverterPlaced) {
          showActionPopup("Alat Konversi Air belum dipasang!");
          return;
        }

        // Mainkan sound effect konversi air
        const konversiSound = document.getElementById("konversiSound");
        konversiSound.currentTime = 0;
        konversiSound
          .play()
          .catch((error) =>
            console.log("Konversi sound failed to play:", error)
          );

        // Update status: Water +8%, Energy -8%
        status.water = Math.min(100, status.water + 8);
        status.energy = Math.max(0, status.energy - 8);

        updateStatusBarUI();
        localStorage.setItem("waterStatus", status.water);
        localStorage.setItem("energyStatus", status.energy);

        showActionPopup(
          "Konversi air berhasil! Air meningkat sebanyak 8% dan Energy berkurang sebanyak 7%"
        );

        triggerShakeAnimation();
        updateQuestProgress();
      });

      /***********************
       * Resource & Status Management
       ***********************/

      // Inisialisasi resource dari localStorage atau default
      const resources = {
        wood: parseInt(localStorage.getItem("wood")) || 0,
        plastic: parseInt(localStorage.getItem("plastic")) || 0,
      };

      // Inisialisasi status (dalam persen) untuk pohon (nature), energi, dan limbah (toxic)
      const status = {
        nature: parseFloat(localStorage.getItem("natureStatus")) || 100,
        energy: parseFloat(localStorage.getItem("energyStatus")) || 100,
        water: parseFloat(localStorage.getItem("waterStatus")) || 100, // Tambah properti water
        toxic: parseFloat(localStorage.getItem("toxicStatus")) || 0,
      };

      // Fungsi untuk mengupdate tampilan status bar
      function updateStatusBarUI() {
        updateStatusBar("nature", status.nature);
        updateStatusBar("energy", status.energy);
        updateStatusBar("water", status.water); // Tambah update untuk water
        updateStatusBar("toxic", status.toxic);
      }

      // Fungsi pembantu untuk mengubah lebar bar berdasarkan persen
      function updateStatusBar(barClass, value) {
        const barFill = document.querySelector(`.${barClass} .status-bar-fill`);
        if (barFill) {
          barFill.style.width = Math.max(0, Math.min(value, 100)) + "%";
        }
      }

      // Fungsi untuk menyimpan status ke localStorage
      function saveStatus() {
        localStorage.setItem("natureStatus", status.nature);
        localStorage.setItem("energyStatus", status.energy);
        localStorage.setItem("waterStatus", status.water); // Simpan status water
        localStorage.setItem("toxicStatus", status.toxic);
      }

      // Update UI awal
      updateStatusBarUI();

      function updateToolButtons() {
        const konversiButton = document.getElementById("konversiButton");
        const konversiImg = konversiButton.querySelector("img");

        const isConverterPlaced =
          localStorage.getItem("converterPlaced") === "true";

        if (!isConverterPlaced) {
          konversiButton.style.filter = "grayscale(100%) brightness(50%)";
          konversiButton.style.cursor = "not-allowed";
          if (konversiImg) {
            konversiImg.style.filter = "grayscale(100%) brightness(50%)";
            konversiImg.style.cursor = "not-allowed";
          }
          konversiButton.disabled = true;
        } else {
          konversiButton.style.filter = "";
          konversiButton.style.cursor = "pointer";
          if (konversiImg) {
            konversiImg.style.filter = "";
            konversiImg.style.cursor = "pointer";
          }
          konversiButton.disabled = false;
        }

        // Update untuk alat penghilang polusi
        const isPollutionPlaced =
          localStorage.getItem("pollutionPlaced") === "true";
        const polusiButton = document.getElementById("polusiButton");
        polusiButton.style.display = isPollutionPlaced ? "block" : "none";
        updateInteractiveButtons(); // Panggil update tambahan
      }

      // Mengupdate kursor ketika mouse bergerak di dalam canvas
      canvas.addEventListener("mousemove", function (e) {
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;

        // Reset kursor ke default
        canvas.style.cursor = "default";

        // Cek apakah mouse berada di area alat yang sudah dipasang
        const isConverterPlaced =
          localStorage.getItem("converterPlaced") === "true";
        const konversiTool = game.tools.alatKonversi;

        if (
          isConverterPlaced &&
          mouseX >= konversiTool.x &&
          mouseX <= konversiTool.x + konversiTool.width &&
          mouseY >= konversiTool.y &&
          mouseY <= konversiTool.y + konversiTool.height
        ) {
          canvas.style.cursor = "pointer";
        }

        const isPollutionPlaced =
          localStorage.getItem("pollutionPlaced") === "true";
        const polusiTool = game.tools.alatPolusi;

        if (
          isPollutionPlaced &&
          mouseX >= polusiTool.x &&
          mouseX <= polusiTool.x + polusiTool.width &&
          mouseY >= polusiTool.y &&
          mouseY <= polusiTool.y + polusiTool.height
        ) {
          canvas.style.cursor = "pointer";
        }
      });

      // Menangani klik pada canvas untuk alat Konversi Air
      canvas.addEventListener("click", function (e) {
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;

        // Cek klik pada alat konversi yang sudah dipasang
        const isConverterPlaced =
          localStorage.getItem("converterPlaced") === "true";
        const konversiTool = game.tools.alatKonversi;

        if (
          isConverterPlaced &&
          mouseX >= konversiTool.x &&
          mouseX <= konversiTool.x + konversiTool.width &&
          mouseY >= konversiTool.y &&
          mouseY <= konversiTool.y + konversiTool.height
        ) {
          triggerShakeAnimation();
        }

        // Cek klik pada alat polusi yang sudah dipasang
        const isPollutionPlaced =
          localStorage.getItem("pollutionPlaced") === "true";
        const polusiTool = game.tools.alatPolusi;

        if (
          isPollutionPlaced &&
          mouseX >= polusiTool.x &&
          mouseX <= polusiTool.x + polusiTool.width &&
          mouseY >= polusiTool.y &&
          mouseY <= polusiTool.y + polusiTool.height
        ) {
          // Trigger fungsi polusi
        }
      });

      // Fungsi untuk memulai animasi shake pada alat konversi
      function triggerShakeAnimation() {
        const isConverterPlaced =
          localStorage.getItem("converterPlaced") === "true";
        if (!isConverterPlaced) {
          showActionPopup("Alat Konversi Air belum dipasang!");
          return;
        }

        const alatKonversi = document.getElementById("alatKonversi");
        // Reset animasi terlebih dahulu
        alatKonversi.style.animation = "none";
        void alatKonversi.offsetWidth; // Memicu reflow
        // Jalankan animasi shake
        alatKonversi.style.animation = "shake 0.5s ease-in-out";
        setTimeout(() => {
          alatKonversi.style.animation = "";
        }, 500);
      }

      // Inisialisasi status tombol saat pertama load
      function initializeButtons() {
        cutButton.disabled = game.tree.isCut;
        plantButton.disabled = !game.tree.isCut;
      }

      let winNotified = false; // Flag agar pesan kemenangan hanya muncul sekali

      function updateQuestProgress() {
        // Quest 1: Buat Alat Konversi Air
        const converterBought =
          localStorage.getItem("converterBought") === "true";
        const converterProgressBar = document.getElementById(
          "converterQuestProgress"
        );
        if (converterProgressBar) {
          converterProgressBar.style.width = converterBought ? "100%" : "0%";
        }

        // Quest 2: Buat Alat Penghilang Polusi
        const pollutionBought =
          localStorage.getItem("pollutionBought") === "true";
        const pollutionProgressBar = document.getElementById(
          "pollutionQuestProgress"
        );
        if (pollutionProgressBar) {
          pollutionProgressBar.style.width = pollutionBought ? "100%" : "0%";
        }

        // Jika kedua alat sudah dibuat dan belum pernah diberitahukan, tampilkan pesan kemenangan
        if (converterBought && pollutionBought && !winNotified) {
          showActionPopup(
            "Selamat! Kamu telah menciptakan kedua alat canggih dan memenangkan game ini! Cek Inventory untuk memasang alat Polusion Buster 2.0!"
          );
          winNotified = true;
        }
      }

      // Panggil updateQuestProgress secara berkala, misalnya setiap 1 detik
      setInterval(updateQuestProgress, 1000);

      // Tambahkan event listener untuk tombol "Nyalakan Mesin" (polusiButton)
      // Ketika tombol ini diklik, panggil fungsi navigateWithTransition untuk menuju ke ending.html
      const polusiButton = document.getElementById("polusiButton");
      polusiButton.addEventListener("click", () => {
        navigateWithTransition("ending.html");
      });

      // Fungsi untuk mengecek kondisi game over (bad ending)
      let gameOverTriggered = false; // Flag agar proses game over hanya terjadi sekali

      function checkGameOver() {
        if (gameOverTriggered) return; // Cegah pemanggilan berulang

        if (status.nature <= 0) {
          gameOverTriggered = true;
          localStorage.setItem("endingType", "badTree");
          window.location.href = "ending.html";
          return;
        }

        if (status.water <= 0) {
          gameOverTriggered = true;
          localStorage.setItem("endingType", "badWater");
          window.location.href = "ending.html";
          return;
        }

        if (status.energy <= 0) {
          gameOverTriggered = true;
          localStorage.setItem("endingType", "badEnergy");
          window.location.href = "ending.html";
          return;
        }

        if (status.toxic >= 100) {
          gameOverTriggered = true;
          localStorage.setItem("endingType", "badToxic");
          window.location.href = "ending.html";
          return;
        }
      }

      // Panggil fungsi checkGameOver secara periodik setiap 500ms
      setInterval(checkGameOver, 500);

      // Di dalam DOMContentLoaded atau initialization function
      const alatKonversi = document.getElementById("alatKonversi");
      const alatPolusi = document.getElementById("alatPolusi");

      // Cek apakah alat sudah dipasang berdasarkan localStorage
      if (localStorage.getItem("converterPlaced") === "true") {
        alatKonversi.style.display = "block";
        // Posisi alat dapat disesuaikan ulang jika diperlukan
      }

      if (localStorage.getItem("pollutionPlaced") === "true") {
        alatPolusi.style.display = "block";
        // Posisi alat dapat disesuaikan ulang jika diperlukan
      }

      // Inisialisasi posisi alat saat game dimuat
      document.addEventListener("DOMContentLoaded", () => {
        ["converter", "pollution"].forEach((tool) => {
          const position = JSON.parse(localStorage.getItem(`${tool}Position`));
          const toolElement = document.getElementById(
            `alat${tool === "converter" ? "Konversi" : "Polusi"}`
          );

          if (
            localStorage.getItem(`${tool}Placed`) === "true" &&
            position &&
            toolElement
          ) {
            toolElement.style.display = "block";
            toolElement.style.left = `${position.x}px`;
            toolElement.style.top = `${position.y}px`;
            toolElement.style.width = `${position.width}px`;
            toolElement.style.height = `${position.height}px`;
          }
        });

        // Update tombol interaksi saat halaman dimuat
        updateInteractiveButtons();
        updateToolButtons();
      });

      // Fungsi untuk mengupdate tombol interaksi
      function updateInteractiveButtons() {
        const konversiButton = document.getElementById("konversiButton");
        const polusiButton = document.getElementById("polusiButton");

        // Tampilkan tombol hanya jika alat sudah dipasang
        const isConverterPlaced =
          localStorage.getItem("converterPlaced") === "true";
        const isPollutionPlaced =
          localStorage.getItem("pollutionPlaced") === "true";

        konversiButton.style.display = isConverterPlaced ? "block" : "none";
        polusiButton.style.display = isPollutionPlaced ? "block" : "none";

        // Update posisi tombol jika alat terpasang
        if (isConverterPlaced) {
          const alatKonversi = document.getElementById("alatKonversi");
          if (alatKonversi) {
            const rect = alatKonversi.getBoundingClientRect();
            const buttonWidth = konversiButton.offsetWidth;
            konversiButton.style.left = `${
              rect.left + rect.width / 2 - buttonWidth / 2
            }px`;
            konversiButton.style.top = `${rect.bottom + 20}px`;
          }
        }

        if (isPollutionPlaced) {
          const alatPolusi = document.getElementById("alatPolusi");
          if (alatPolusi) {
            const rect = alatPolusi.getBoundingClientRect();
            const buttonWidth = polusiButton.offsetWidth;
            polusiButton.style.left = `${
              rect.left + rect.width / 2 - buttonWidth / 2
            }px`;
            polusiButton.style.top = `${rect.bottom - 30}px`;
          }
        }

        // --------------------------
        // Kode Baru: Tampilkan atau sembunyikan div blokirKetikaAlatPenghisapMuncul
        const blokirElement = document.getElementById(
          "blokirKetikaAlatPenghisapMuncul"
        );
        if (isPollutionPlaced) {
          blokirElement.style.display = "block";
        } else {
          blokirElement.style.display = "none";
        }
        // --------------------------
      }

      // Satu listener confirmPlacement yang final (duplikasi telah dihapus)
      confirmPlacement.addEventListener("click", () => {
        if (!currentTool || !targetArea) return;

        // Jika alat yang dipasang adalah polusi, gunakan ukuran dari game.tools.alatPolusi
        // Jika bukan, ambil ukuran dari targetArea secara default
        let rect;
        if (currentTool === "pollution") {
          rect = {
            left: game.tools.alatPolusi.x,
            top: game.tools.alatPolusi.y,
            width: game.tools.alatPolusi.width,
            height: game.tools.alatPolusi.height,
          };
        } else {
          rect = targetArea.getBoundingClientRect();
        }

        const toolName =
          currentTool === "converter" ? "Konversi" : "PenghilangPolusi";
        const toolId =
          currentTool === "converter" ? "alatKonversi" : "alatPolusi";
        let toolElement = document.getElementById(toolId);

        if (toolElement) {
          // Jika elemen sudah ada, perbarui atribut dan styling-nya
          // (asumsi elemen sudah memiliki id dan sudah dimuat sebelumnya)
          toolElement.src = `./assets/img/alat${toolName}.png`;
          toolElement.style.position = "fixed";
          toolElement.style.left = `${rect.left}px`;
          toolElement.style.top = `${rect.top}px`;
          toolElement.style.width = `${rect.width}px`;
          toolElement.style.height = `${rect.height}px`;
          toolElement.style.pointerEvents = "none";
          toolElement.style.zIndex = "999";
        } else {
          // Jika elemen belum ada, buat elemen baru dan pastikan diberi id untuk mencegah duplikasi
          toolElement = new Image();
          toolElement.id = toolId;
          toolElement.className = "alat-installed";
          toolElement.src = `./assets/img/alat${toolName}.png`;
          toolElement.style.position = "fixed";
          toolElement.style.left = `${rect.left}px`;
          toolElement.style.top = `${rect.top}px`;
          toolElement.style.width = `${rect.width}px`;
          toolElement.style.height = `${rect.height}px`;
          toolElement.style.pointerEvents = "none";
          toolElement.style.zIndex = "999";
          document.body.appendChild(toolElement);
        }

        // Simpan posisi alat dan update status
        localStorage.setItem(
          `${currentTool}Position`,
          JSON.stringify({
            x: rect.left,
            y: rect.top,
            width: rect.width,
            height: rect.height,
          })
        );
        localStorage.setItem(`${currentTool}Placed`, "true");
        updateInventory();
        updateInteractiveButtons();
        updateToolButtons(); // <-- Baris baru untuk memperbarui tombol secara langsung
        showActionPopup("Alat berhasil dipasang!");

        // Reset UI placement
        placementHint.style.display = "none";
        targetArea.classList.remove("show-placement");
        currentTool = null;
        targetArea = null;
      });
    </script>
    <script>
      function showActionPopup(message) {
        const popup = document.getElementById("actionPopup");
        if (!popup) return;
        popup.textContent = message;
        popup.classList.add("active");
        // Popup akan hilang setelah 3 detik
        setTimeout(() => {
          popup.classList.remove("active");
        }, 3000);
      }
    </script>
    <div id="actionPopup"></div>

    <script>
      // Inventory System
      const inventoryButton = document.getElementById("inventoryButton");
      const inventoryModal = document.getElementById("inventoryModal");
      const placementArea = document.getElementById("placementArea");
      let placingTool = null;

      // Tampilkan inventory
      inventoryButton.addEventListener("click", () => {
        updateInventory();
        inventoryModal.classList.add("active");
      });

      // Update tampilan inventory
      function updateInventory() {
        // Update resource counts
        document
          .querySelectorAll('[data-item="wood"] .item-count')
          .forEach((el) => {
            el.textContent = localStorage.getItem("wood") || 0;
          });
        document
          .querySelectorAll('[data-item="plastic"] .item-count')
          .forEach((el) => {
            el.textContent = localStorage.getItem("plastic") || 0;
          });

        // Tampilkan item alat hanya jika alat masih dimiliki (bought === 'true')
        // dan belum dipasang (placed !== 'true')
        document.querySelector('[data-item="converter"]').style.display =
          localStorage.getItem("converterBought") === "true" &&
          localStorage.getItem("converterPlaced") !== "true"
            ? "flex"
            : "none";
        document.querySelector('[data-item="pollution"]').style.display =
          localStorage.getItem("pollutionBought") === "true" &&
          localStorage.getItem("pollutionPlaced") !== "true"
            ? "flex"
            : "none";
      }

      // Handle tool placement
      document.querySelectorAll(".use-button").forEach((button) => {
        button.addEventListener("click", (e) => {
          const toolType = e.target.closest(".inventory-slot").dataset.item;
          startPlacingTool(toolType);
          inventoryModal.classList.remove("active");
        });
      });

      function startPlacingTool(toolType) {
        // Gunakan mekanisme baru: alat tidak langsung diposisikan dengan mouse,
        // tapi ditempatkan menggunakan overlay placementHint pada area target.
        currentTool = toolType;
        targetArea = document.getElementById(
          toolType === "converter"
            ? "tempatAlatKonversi"
            : "tempatAlatPenghisap"
        );
        if (!targetArea) {
          showActionPopup("Tempat pemasangan tidak ditemukan!");
          return;
        }
        // Tampilkan area target dengan efek blinking melalui class .show-placement
        targetArea.classList.add("show-placement");
        // Posisi overlay placementHint sama persis dengan targetArea
        const rect = targetArea.getBoundingClientRect();
        placementHint.style.display = "flex";
        placementHint.style.position = "fixed";
        placementHint.style.left = `${rect.left}px`;
        placementHint.style.top = `${rect.top}px`;
        placementHint.style.width = `${rect.width}px`;
        placementHint.style.height = `${rect.height}px`;
      }

      // Tutup inventory
      document
        .getElementById("inventoryClose")
        .addEventListener("click", () => {
          inventoryModal.classList.remove("active");
        });

      confirmPlacement.addEventListener("click", () => {
        if (!currentTool || !targetArea) return;

        // Dapatkan posisi dan ukuran targetArea terlebih dahulu
        const rect = targetArea.getBoundingClientRect();
        const toolName =
          currentTool === "converter" ? "Konversi" : "PenghilangPolusi";
        const toolId =
          currentTool === "converter" ? "alatKonversi" : "alatPolusi";
        let toolElement = document.getElementById(toolId);

        if (toolElement) {
          // Jika elemen sudah ada, perbarui atribut dan styling-nya
          // (asumsi elemen sudah memiliki id dan sudah dimuat sebelumnya)
          toolElement.src = `./assets/img/alat${toolName}.png`;
          toolElement.style.position = "fixed";
          toolElement.style.left = `${rect.left}px`;
          toolElement.style.top = `${rect.top}px`;
          toolElement.style.width = `${rect.width}px`;
          toolElement.style.height = `${rect.height}px`;
          toolElement.style.pointerEvents = "none";
          toolElement.style.zIndex = "999";
        } else {
          // Jika elemen belum ada, buat elemen baru dan pastikan diberi id untuk mencegah duplikasi
          toolElement = new Image();
          toolElement.id = toolId;
          toolElement.className = "alat-installed";
          toolElement.src = `./assets/img/alat${toolName}.png`;
          toolElement.style.position = "fixed";
          toolElement.style.left = `${rect.left}px`;
          toolElement.style.top = `${rect.top}px`;
          toolElement.style.width = `${rect.width}px`;
          toolElement.style.height = `${rect.height}px`;
          toolElement.style.pointerEvents = "none";
          toolElement.style.zIndex = "999";
          document.body.appendChild(toolElement);
        }

        // Simpan posisi alat dan update status
        localStorage.setItem(
          `${currentTool}Position`,
          JSON.stringify({
            x: rect.left,
            y: rect.top,
            width: rect.width,
            height: rect.height,
          })
        );
        localStorage.setItem(`${currentTool}Placed`, "true");
        updateInventory();
        updateInteractiveButtons();
        updateToolButtons(); // <-- Baris baru untuk memperbarui tombol secara langsung
        showActionPopup("Alat berhasil dipasang!");

        // Reset UI placement
        placementHint.style.display = "none";
        targetArea.classList.remove("show-placement");
        currentTool = null;
        targetArea = null;
      });
    </script>
    <script>
      window.addEventListener("load", function () {
        const guideModal = document.getElementById("modalOverlay");
        const guideCloseBtn = document.getElementById("modalClose");
        const guideButton = document.getElementById("guideButton");

        // Tampilkan popup guide untuk pemain baru secara otomatis
        if (!localStorage.getItem("guideSeen")) {
          guideModal.style.display = "flex"; // Gunakan flex seperti modal lainnya
          guideModal.classList.add("active");
        }

        // Event listener untuk menutup popup guide
        guideCloseBtn.addEventListener("click", function () {
          guideModal.classList.remove("active");
          setTimeout(() => {
            guideModal.style.display = "none";
          }, 300);
          localStorage.setItem("guideSeen", "true");
        });

        // Event listener untuk membuka kembali popup guide ketika tombol guide ditekan
        guideButton.addEventListener("click", function () {
          guideModal.style.display = "flex"; // Gunakan flex seperti modal lainnya
          guideModal.classList.add("active");
        });
      });
    </script>
    <script>
      // Audio Control System
      const backgroundMusic = document.getElementById("backgroundMusic");
      const soundControl = document.getElementById("soundControl");
      let isMuted = localStorage.getItem("isMuted") === "true";
      let musicTime = parseFloat(localStorage.getItem("musicTime")) || 0;

      // Set volume awal
      backgroundMusic.volume = 0.5;

      // Coba autoplay dengan promise
      async function tryAutoplay() {
        try {
          await backgroundMusic.play();
        } catch (error) {
          console.log("Autoplay failed, waiting for user interaction:", error);
          // Fallback ke click event jika autoplay gagal
          document.addEventListener("click", function startAudio() {
            backgroundMusic.play().catch(function (error) {
              console.log("Audio play failed:", error);
            });
            document.removeEventListener("click", startAudio);
          });
        }
      }

      // Fungsi untuk memulai musik
      function initializeAudio() {
        if (isMuted) {
          backgroundMusic.muted = true;
          soundControl.classList.add("muted");
          soundControl.src = "./assets/img/muteLogo.svg";
        } else {
          backgroundMusic.muted = false;
          soundControl.classList.remove("muted");
          soundControl.src = "./assets/img/unmuteLogo.svg";
        }

        // Set waktu pemutaran dari localStorage
        backgroundMusic.currentTime = musicTime;
        // Coba autoplay
        tryAutoplay();
      }

      // Event listener untuk tombol sound
      soundControl.addEventListener("click", () => {
        isMuted = !isMuted;
        backgroundMusic.muted = isMuted;

        if (isMuted) {
          soundControl.classList.add("muted");
          soundControl.src = "./assets/img/muteLogo.svg";
        } else {
          soundControl.classList.remove("muted");
          soundControl.src = "./assets/img/unmuteLogo.svg";
        }

        localStorage.setItem("isMuted", isMuted);
      });

      // Simpan posisi waktu pemutaran setiap 1 detik
      setInterval(() => {
        if (!backgroundMusic.paused) {
          localStorage.setItem("musicTime", backgroundMusic.currentTime);
        }
      }, 1000);

      // Mulai musik ketika user berinteraksi dengan halaman
      document.addEventListener("click", function startAudio() {
        backgroundMusic.play().catch(function (error) {
          console.log("Audio play failed:", error);
        });
        document.removeEventListener("click", startAudio);
      });

      // Initialize audio saat halaman dimuat
      window.addEventListener("load", initializeAudio);

      // Tambahkan event listener untuk memastikan musik tetap bermain saat tab tidak aktif
      document.addEventListener("visibilitychange", function () {
        if (!document.hidden && !isMuted) {
          backgroundMusic.play().catch(function (error) {
            console.log("Audio play failed:", error);
          });
        }
      });

      // Tambahkan event listener sebelum unload untuk menyimpan waktu terakhir
      window.addEventListener("beforeunload", () => {
        localStorage.setItem("musicTime", backgroundMusic.currentTime);
      });
    </script>

    <!-- Fungsi untuk mencegah spam klik pada seluruh tombol -->
    <script>
      function preventButtonSpam() {
        const spamDelay = 500; // Delay 500 milidetik
        // Ambil semua elemen <button> dalam halaman
        const buttons = document.querySelectorAll("button");
        buttons.forEach((button) => {
          button.addEventListener("click", function () {
            // Jika tombol belum dinonaktifkan, nonaktifkan sementara
            if (!button.disabled) {
              button.disabled = true;
              setTimeout(() => {
                button.disabled = false;
              }, spamDelay);
            }
          });
        });
      }
      // Panggil fungsi preventButtonSpam untuk mengaktifkan proteksi pada tombol
      preventButtonSpam();
    </script>

    <script>
      // Tambahkan fungsi untuk memainkan sound effect
      function playClickSound() {
        const clickSound = document.getElementById("clickSound");
        clickSound.currentTime = 0; // Reset audio ke awal
        clickSound
          .play()
          .catch((error) => console.log("Click sound failed to play:", error));
      }

      // Tambahkan event listener untuk semua button
      function addClickSoundToButtons() {
        const buttons = document.querySelectorAll("button");
        buttons.forEach((button) => {
          button.addEventListener("click", playClickSound);
        });

        // Tambahkan juga ke elemen dengan class icon (untuk button-button gambar)
        const iconButtons = document.querySelectorAll(".icon");
        iconButtons.forEach((icon) => {
          icon.addEventListener("click", playClickSound);
        });
      }

      // Panggil fungsi saat dokumen dimuat
      document.addEventListener("DOMContentLoaded", addClickSoundToButtons);

      // Tambahkan ke fungsi preventButtonSpam yang sudah ada
      function preventButtonSpam() {
        const spamDelay = 500;
        const buttons = document.querySelectorAll("button");
        buttons.forEach((button) => {
          button.addEventListener("click", function () {
            if (!button.disabled) {
              button.disabled = true;
              playClickSound(); // Tambahkan sound effect di sini juga
              setTimeout(() => {
                button.disabled = false;
              }, spamDelay);
            }
          });
        });
      }

      // ... existing code ...
    </script>
  </body>
</html>
