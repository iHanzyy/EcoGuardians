<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="./assets/img/logoEcoG.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game - ECOGUARDIANS</title>
    <style>
      /* -------------------------- */
      /* Global & Game Styles       */
      /* -------------------------- */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Arial Rounded MT Bold', sans-serif;
      }

      canvas {
        display: block;
      }

      #loadingScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        z-index: 10;
      }

      /* -------------------------- */
      /* Status Bars UI             */
      /* -------------------------- */
      .status-container {
        position: fixed;
        top: 10px;
        left: 10px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-gap: 20px;
        z-index: 50;
      }

      .status-bar {
        position: relative;
        width: 222px;
        height: 36px;
        background-color: #ddd;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      }

      @keyframes glow {
        0% { box-shadow: 0 0 10px rgba(0, 255, 0, 0.7); }
        100% { box-shadow: 0 0 20px rgba(0, 255, 0, 1); }
      }
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-3px); }
        50% { transform: translateX(3px); }
        75% { transform: translateX(-3px); }
      }
      @keyframes pulse {
        0% { background: rgba(0, 255, 0, 0.4); }
        100% { background: rgba(0, 255, 0, 0); }
      }
      @keyframes blink {
        0% { background: rgba(255, 0, 0, 0.7); }
        100% { background: rgba(255, 0, 0, 0); }
      }

      .status-bar-fill {
        height: 100%;
        background: linear-gradient(to right, #2a8e2a, #50d850);
        width: 0;
        transition: width 0.8s ease-in-out;
      }

      .status-icon {
        position: absolute;
        left: 5px;
        top: 50%;
        transform: translateY(-50%);
        width: 30px;
        height: 30px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        z-index: 1;
      }

      /* Status Bar Warna & Styling */
      /* Nature */
      .nature .status-bar-fill {
        background: linear-gradient(to right, #2a8e2a, #50d850);
      }
      .nature .status-icon {
        border-color: #1cbf21;
      }
      /* Energy */
      .energy .status-bar-fill {
        background: linear-gradient(to right, #cc9a00, #ffe600);
      }
      .energy .status-icon {
        border-color: #ffb41e;
      }
      /* Water */
      .water .status-bar-fill {
        background: linear-gradient(to right, #1e8ac0, #26aaf0);
      }
      .water .status-icon {
        border-color: #b8deff;
      }
      /* Toxic */
      .toxic .status-bar-fill {
        background: linear-gradient(to right, #3a3a3a, #484740);
      }
      .toxic .status-icon {
        border-color: #000000;
      }
      .status-bar-fill.full {
        border-radius: 15px;
      }

      /* -------------------------- */
      /* Container Ikon Game        */
      /* -------------------------- */
      #icons {
        position: fixed;
        top: 10px;
        right: 10px;
        display: flex;
        gap: 10px;
        z-index: 20;
      }

      .icon {
        width: 50px;
        height: 48px;
        cursor: pointer;
        transition: transform 0.3s ease, filter 0.3s ease;
      }

      .icon:hover {
        transform: scale(1.1);
        filter: drop-shadow(0px 4px 8px rgba(0, 0, 0, 0.3));
      }

      /* -------------------------- */
      /* Popup Guide Modal Styles   */
      /* -------------------------- */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease;
        z-index: 999;
      }
      .modal-overlay.active {
        opacity: 1;
        visibility: visible;
      }
      .modal-container {
        background: #222;
        border-radius: 10px;
        padding: 20px 30px;
        max-width: 600px;
        width: 90%;
        position: relative;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
      }
      .modal-close {
        position: absolute;
        top: 10px;
        right: 10px;
        background: transparent;
        border: none;
        font-size: 28px;
        color: #fff;
        cursor: pointer;
        outline: none;
      }
      .slides {
        overflow: hidden;
        position: relative;
        margin-top: 20px;
      }
      .slide-track {
        display: flex;
        transition: transform 0.5s ease-in-out;
      }
      .slide {
        min-width: 100%;
        box-sizing: border-box;
        padding: 10px;
        text-align: center;
      }
      .slide img {
        max-width: 100%;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      }
      .slide p {
        margin-top: 15px;
        font-size: 16px;
        line-height: 1.5;
        color: #ddd;
      }
      .nav-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.5);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        cursor: pointer;
        outline: none;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        color: #fff;
        transition: background 0.3s ease;
      }
      .nav-arrow:hover {
        background: rgba(0, 0, 0, 0.7);
      }
      .nav-prev {
        left: 10px;
      }
      .nav-next {
        right: 10px;
      }

      /* -------------------------- */
      /* Popup Quest Modal Styles   */
      /* -------------------------- */
      .mission-content {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-top: 20px;
      }

      .mission-item {
        display: flex;
        align-items: flex-start;
        gap: 15px;
      }

      .mission-details {
        flex-grow: 1;
      }

      .mission-icon {
        width: 40px;
        height: 40px;
      }

      .mission-progress {
        flex-grow: 1;
        height: 20px;
        background-color: #ddd;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      }

      .mission-progress-bar {
        height: 100%;
        width: 0;
        background: linear-gradient(to right, #4caf50, #8bc34a);
        transition: width 0.5s ease-in-out;
      }

      .mission-title {
        font-size: 18px;
        color: #fff;
        margin-bottom: 5px;
      }

      /* -------------------------- */
      /* Blok Rintangan (Road Blocks) */
      /* -------------------------- */
      /* Gunakan class "roadBlock" untuk setiap blok rintangan.
         Kamu dapat mengubah posisi dan ukuran masing-masing blok melalui ID-nya. */
      .roadBlock {
        position: absolute;
        z-index: 3;
        pointer-events: none;
      }
      /* Blok di bagian atas */
      #blockTop {
        top: 0;
        width: 100%;
        height: 16rem;
      }
      /* Blok di bagian bawah */
      #blockBottom {
        bottom: 0;
        width: 100%;
        height: 10rem;
      }
      /* Blok di bagian kiri */
      #blockLeft {
        top: 30%;
        left: 0;
        width: 14rem;
        height: 38%;
      }
      /* Blok di bagian kanan */
      #blockRight {
        top: 30%;
        right: 0;
        width: 20rem;
        height: 51%;
      }
      /* Blok di bagian home */
      #blockHome {
        top: 30%;
        left: 21%;
        width: 14rem;
        height: 21%;
      }      
      /* Blok di bagian laboratorium */
      #blockLaboratorium {
        top: 30%;
        right: 21%;
        width: 20rem;
        height: 15%;
      }
      /* Blok di bagian pohon */
      #blockTree {
        top: 30%;
        right: 42%;
        width: 6rem;
        height: 11%;
      }
      /* Blok di bagian pohon 2 */
      #blockTree2 {
        top: 51%;
        right: 21%;
        width: 4rem;
        height: 7%;
      }
      /* Blok di bagian grass */
      #blockGrass {
        top: 60%;
        right: 28%;
        width: 11rem;
        height: 21%;
      }
      /* Blok di bagian grass 2 */
      #blockGrass2 {
        top: 67%;
        right: 21%;
        width: 7rem;
        height: 14%;
      }

      /* Interactive Buttons Styles */
      .interactive-button {
        position: fixed;
        padding: 12px 24px;
        border: none;
        border-radius: 25px;
        font-family: 'Arial', sans-serif;
        font-weight: bold;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        text-transform: uppercase;
        letter-spacing: 1px;
        z-index: 100;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.3s ease, transform 0.3s ease;
      }

      .interactive-button.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .interactive-button.home {
        background: linear-gradient(45deg, #00c853, #64dd17);
        color: white;
      }

      .interactive-button.lab {
        background: linear-gradient(45deg, #00bcd4, #00e5ff);
        color: white;
      }

      /* -- Tombol interaksi untuk pohon -- */
      .interactive-button.cut {
        background: linear-gradient(45deg, #d32f2f, #f44336);
        color: white;
      }
      .interactive-button.plant {
        background: linear-gradient(45deg, #388e3c, #4caf50);
        color: white;
      }

      /* Tombol interaksi untuk alat penghilang polusi */
      .interactive-button.polusi {
        background: linear-gradient(45deg, #34495e, #2c3e50);
        color: white;
      }

      .interactive-button:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
      }

      .interactive-button:active {
        transform: scale(0.95);
      }

      /* Transisi halaman */
      .page-transition {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        opacity: 0;
        pointer-events: none;
        z-index: 1000;
        transition: opacity 0.5s ease;
      }

      .page-transition.active {
        opacity: 1;
      }

      /* Resource Bar Styles - Wood & Plastic yang sudah disesuaikan dengan linear gradient hijau */
      .resource-bar {
          width: 220px;
          height: 40px;
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 12px;
          background: linear-gradient(45deg, #2a8e2a, #50d850); /* Linear gradient hijau */
          border-radius: 10px;
          box-shadow: 0px 3px 8px rgba(0, 0, 0, 0.2);
          padding: 5px;
          border: 5px solid black;
      }

      .resource-icon-container {
          position: relative;
          display: flex;
          align-items: center;
          
      }

      .resource-icon {
          width: 30px;
          height: 40px;
          filter: drop-shadow(1px 1px 3px rgba(0, 0, 0, 0.3));
      }

      .resource-text {
          color: black;
          font-size: 20px;
          font-family: 'Poppins', sans-serif;
          font-weight: 600;
          text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
          margin-left: 5px;
      }

      .alat-dom-element {
        position: fixed;
        width: 280px;
        height: 280px;
        pointer-events: none;
        background-image: url('./assets/img/alatPenghilangPolusi.png');
        background-size: contain;
        background-repeat: no-repeat;
        display: none; /* Default hidden */
      }
      
      #alatPolusi {
        /* Sesuaikan dengan posisi yang diinginkan */
        left: 580px;
        top: 300px;
      }

      /* CSS untuk alat konversi */
      #alatKonversi {
        left: 270px;
        top: 600px;
        width: 130px;
        height: 130px;
        background-image: url('./assets/img/alatKonversi.png');
        transform: translate(0, 0); /* Pastikan posisi default */
      }

      /* Pastikan animasi hanya berlaku untuk alat */
      #alatKonversi {
        animation: none; /* Reset default */
      }
      
      @keyframes shake {
        0% { transform: translate(0, 0); }
        20% { transform: translate(-3px, 2px); }
        40% { transform: translate(3px, -2px); }
        60% { transform: translate(-3px, 1px); }
        80% { transform: translate(2px, -1px); }
        100% { transform: translate(0, 0); }
      }
      #actionPopup {
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.85);
        color: #fff;
        padding: 20px 30px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        font-size: 16px;
        text-align: center;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.5s ease, visibility 0.5s ease;
        z-index: 999;
      }
      #actionPopup.active {
        opacity: 1;
        visibility: visible;
      }
    </style>
  </head>
  <body>
    <!-- Loading Screen -->
    <div id="loadingScreen">Loading...</div>
    <!-- Game Canvas -->
    <canvas id="gameCanvas"></canvas>
    <!-- Blok Rintangan (Road Blocks) -->
    <div class="roadBlock" id="blockTop"></div>
    <div class="roadBlock" id="blockBottom"></div>
    <div class="roadBlock" id="blockLeft"></div>
    <div class="roadBlock" id="blockRight"></div>
    <div class="roadBlock" id="blockHome"></div>
    <div class="roadBlock" id="blockLaboratorium"></div>
    <div class="roadBlock" id="blockTree"></div>
    <div class="roadBlock" id="blockTree2"></div>
    <div class="roadBlock" id="blockGrass"></div>
    <div class="roadBlock" id="blockGrass2"></div>
    <!-- Status Bars UI -->
    <div class="status-container">
      <!-- Nature Status Bar -->
      <div class="status-bar nature">
        <div class="status-icon">
          <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24.5" cy="24.5" r="22.5" fill="#B5FF78" stroke="black" stroke-width="4"/>
            <path d="M36.677 13.3218C36.6618 13.0619 36.5517 12.8166 36.3676 12.6324C36.1835 12.4483 35.9382 12.3382 35.6782 12.323C25.5672 11.7294 17.4683 14.7734 14.0152 20.4844C12.8183 22.438 12.2285 24.703 12.3205 26.9922C12.3806 28.4561 12.6784 29.9005 13.2024 31.2688C13.2332 31.353 13.2847 31.428 13.3524 31.4869C13.42 31.5458 13.5014 31.5866 13.589 31.6056C13.6766 31.6245 13.7676 31.621 13.8535 31.5953C13.9394 31.5696 14.0174 31.5226 14.0803 31.4587L25.3693 19.997C25.468 19.8982 25.5852 19.8199 25.7142 19.7665C25.8432 19.7131 25.9814 19.6856 26.121 19.6856C26.2606 19.6856 26.3989 19.7131 26.5279 19.7665C26.6568 19.8199 26.774 19.8982 26.8728 19.997C26.9715 20.0957 27.0498 20.2129 27.1032 20.3418C27.1566 20.4708 27.1841 20.6091 27.1841 20.7487C27.1841 20.8883 27.1566 21.0265 27.1032 21.1555C27.0498 21.2845 26.9715 21.4017 26.8728 21.5004L14.5358 34.0233L12.6512 35.9079C12.4552 36.0987 12.3382 36.3563 12.3234 36.6294C12.3087 36.9026 12.3972 37.1713 12.5715 37.3821C12.667 37.4926 12.7842 37.5823 12.9158 37.6455C13.0475 37.7087 13.1907 37.7441 13.3367 37.7495C13.4826 37.7548 13.6281 37.73 13.764 37.6767C13.9 37.6233 14.0234 37.5425 14.1267 37.4392L16.3567 35.2093C18.2346 36.1177 20.1299 36.6131 22.0092 36.6795C22.157 36.6848 22.3045 36.6875 22.4514 36.6875C24.5916 36.693 26.6911 36.1035 28.5156 34.9848C34.2266 31.5317 37.272 23.4341 36.677 13.3218Z" fill="#1CBF21"/>
          </svg>
        </div>
        <div class="status-bar-fill"></div>
      </div>
      <!-- Water Status Bar -->
      <div class="status-bar water">
        <div class="status-icon">
          <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24.5" cy="24.5" r="22.5" fill="#B8DEFF" stroke="black" stroke-width="4"/>
            <path d="M24.935 11.655C24.3966 11.1875 23.5891 11.1875 23.0508 11.655C16.1375 17.7467 12.6666 23.045 12.6666 27.55C12.6666 34.605 18.05 39.1667 24 39.1667C29.95 39.1667 35.3333 34.605 35.3333 27.55C35.3333 23.045 31.8625 17.7467 24.935 11.655ZM18.0925 27.8333C18.6166 27.8333 19.0416 28.2017 19.1408 28.7117C19.7216 31.8567 22.3708 32.9333 24.2975 32.7775C24.9066 32.7492 25.4166 33.2308 25.4166 33.84C25.4166 34.4067 24.9633 34.8742 24.3966 34.9025C21.3791 35.0867 17.8516 33.3583 17.0441 29.0658C17.0195 28.914 17.0282 28.7585 17.0695 28.6103C17.1109 28.4621 17.1839 28.3247 17.2836 28.2074C17.3833 28.0902 17.5073 27.9961 17.6469 27.9315C17.7866 27.8669 17.9386 27.8334 18.0925 27.8333Z" fill="#26AAF0"/>
          </svg>
        </div>
        <div class="status-bar-fill"></div>
      </div>
      <!-- Energy Status Bar -->
      <div class="status-bar energy">
        <div class="status-icon">
          <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24.5" cy="24.5" r="22.5" fill="#FFEB00" stroke="black" stroke-width="4"/>
            <path d="M23.5833 29.25H16.5L26.4167 9.41666V20.75H33.5L23.5833 40.5833V29.25Z" fill="#FFB41E"/>
          </svg>
        </div>
        <div class="status-bar-fill"></div>
      </div>
      <!-- Toxic Status Bar -->
      <div class="status-bar toxic">
        <div class="status-icon">
          <svg width="49" height="49" viewBox="0 0 49 49" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24.5" cy="24.5" r="22.5" fill="#D3D1D1" stroke="black" stroke-width="4"/>
            <path d="M39.8524 29.1942C39.7114 27.3182 38.9122 25.5523 37.5958 24.2083C36.2795 22.8642 34.5306 22.0284 32.658 21.8484C32.5379 21.5942 32.4049 21.3464 32.2595 21.1059C33.1019 19.2524 33.2021 17.1467 32.5396 15.2216C31.877 13.2965 30.5021 11.6984 28.6975 10.7559L28.6789 10.7452C28.6302 10.7201 28.5796 10.6988 28.5275 10.6815C28.274 10.5975 27.9981 10.6121 27.7549 10.7223C27.5116 10.8326 27.3188 11.0304 27.2148 11.2764C27.1108 11.5224 27.1033 11.7985 27.1937 12.0498C27.2841 12.3011 27.4659 12.5091 27.7027 12.6325H27.712C27.8688 12.7241 30.3125 14.0735 30.3125 17.0312C30.3131 17.5966 30.2234 18.1583 30.0469 18.6954C28.5867 17.6134 26.8174 17.0294 25 17.0294C23.1826 17.0294 21.4134 17.6134 19.9531 18.6954C19.7766 18.1583 19.6869 17.5966 19.6875 17.0312C19.6875 14.0629 22.1485 12.7135 22.2973 12.6351C22.5432 12.5035 22.7274 12.2804 22.8103 12.0141C22.8931 11.7478 22.8679 11.4596 22.7402 11.2117C22.6124 10.9637 22.3922 10.776 22.1272 10.689C21.8622 10.602 21.5736 10.6227 21.3238 10.7466L21.3038 10.7572C19.4976 11.7006 18.1214 13.3 17.4582 15.2268C16.7949 17.1536 16.895 19.2613 17.7378 21.1166C17.5917 21.3556 17.4563 21.6026 17.3394 21.8563C15.4672 22.0375 13.7191 22.8739 12.4033 24.2181C11.0876 25.5623 10.2887 27.3279 10.1476 29.2035C10.1268 29.4184 10.1206 29.6345 10.129 29.8503C10.152 30.1216 10.2782 30.3737 10.4816 30.5546C10.6851 30.7356 10.9502 30.8315 11.2223 30.8226C11.4944 30.8138 11.7527 30.7008 11.944 30.507C12.1352 30.3132 12.2447 30.0534 12.25 29.7812C12.25 29.6006 12.2593 29.4213 12.2752 29.25C12.3722 28.4199 12.8145 26.7159 14.7509 25.599C15.2976 25.282 15.8968 25.0656 16.5199 24.9601C16.5067 25.1501 16.4987 25.3426 16.4987 25.5366C16.5004 27.2048 16.9922 28.8357 17.9131 30.2267C18.834 31.6177 20.1433 32.7075 21.6784 33.3605C21.2454 33.9465 20.6961 34.4367 20.0647 34.8002C17.532 36.2612 15.1666 34.848 14.966 34.7232L14.9501 34.7126C14.7138 34.5633 14.4281 34.5132 14.1551 34.5731C13.8821 34.633 13.6437 34.798 13.4915 35.0325C13.3394 35.2669 13.2857 35.5519 13.3422 35.8256C13.3987 36.0994 13.5607 36.3398 13.7933 36.4949L13.8252 36.5148C14.7103 37.0768 15.6978 37.4583 16.7308 37.6376C17.7638 37.8169 18.8221 37.7904 19.8448 37.5597C20.8676 37.3289 21.8347 36.8984 22.6907 36.2929C23.5466 35.6874 24.2745 34.9188 24.8327 34.0312H25.1674C25.7262 34.9182 26.4546 35.6862 27.3107 36.2912C28.1669 36.8962 29.134 37.3263 30.1567 37.5569C31.1793 37.7875 32.2374 37.814 33.2704 37.635C34.3033 37.4559 35.2908 37.0748 36.1762 36.5135L36.2067 36.4936C36.4393 36.3385 36.6014 36.0981 36.6578 35.8243C36.7143 35.5506 36.6607 35.2656 36.5085 35.0312C36.3563 34.7967 36.1179 34.6317 35.8449 34.5718C35.5719 34.5119 35.2863 34.562 35.0499 34.7112L35.034 34.7219C34.8335 34.8467 32.4681 36.2612 29.9353 34.7989C29.303 34.4339 28.7531 33.9419 28.3203 33.3539C29.8552 32.7009 31.1644 31.6114 32.0852 30.2206C33.0061 28.8299 33.4981 27.1992 33.5 25.5312C33.5 25.3373 33.4907 25.1461 33.4788 24.9562C34.1023 25.0611 34.7019 25.277 35.2492 25.5937C37.1709 26.7026 37.6212 28.3907 37.7235 29.2221C37.7407 29.4067 37.75 29.5926 37.75 29.7812C37.746 29.9208 37.7695 30.0597 37.8192 30.1902C37.8689 30.3206 37.9438 30.44 38.0396 30.5415C38.1354 30.643 38.2503 30.7246 38.3777 30.7817C38.5051 30.8388 38.6424 30.8703 38.782 30.8743C38.9215 30.8783 39.0604 30.8548 39.1909 30.8051C39.3213 30.7554 39.4407 30.6805 39.5422 30.5847C39.6437 30.4889 39.7253 30.374 39.7824 30.2466C39.8395 30.1192 39.871 29.9819 39.875 29.8423C39.8822 29.626 39.8746 29.4095 39.8524 29.1942Z" fill="black"/>
          </svg>
        </div>
        <div class="status-bar-fill"></div>
      </div>
    </div>

    <!-- Game Icons -->
    <div id="icons">
      <!-- Resource Bar: Wood & Plastic -->
      <div class="resource-bar">
          <!-- Bagian Plastik -->
          <div class="resource-icon-container">
              <img class="resource-icon" src="./assets/img/plastic.svg" alt="Plastic Icon" />
              <div class="resource-text" id="plasticCount">X 0</div>
          </div>
          <!-- Bagian Kayu -->
          <div class="resource-icon-container">
              <img class="resource-icon" src="./assets/img/kayu.svg" alt="Wood Icon" />
              <div class="resource-text" id="woodCount">X 0</div>
          </div>
      </div>

      <img src="./assets/img/guideButton.svg" alt="Guide Button" class="icon" id="guideButton" />
      <img src="./assets/img/questButton.svg" alt="Quest Button" class="icon" />
    </div>

    <!-- Popup Modal (Guide) -->
    <div class="modal-overlay" id="modalOverlay">
      <div class="modal-container">
        <button class="modal-close" id="modalClose">&times;</button>
        <h2 style="text-align: center; color: #fff">Cara Bermain</h2>
        <div class="slides">
          <div class="slide-track" id="slideTrack">
            <!-- Slide 1 -->
            <div class="slide">
              <img src="./assets/gif/testing.gif" alt="Slide 1" />
              <p>
                Selamat datang di game kami! Gunakan tombol panah untuk bergerak dan hindari rintangan.
              </p>
            </div>
            <!-- Slide 2 -->
            <div class="slide">
              <img src="./assets/gif/testing.gif" alt="Slide 2" />
              <p>
                Kumpulkan koin untuk meningkatkan skor dan buka kemampuan khusus.
              </p>
            </div>
            <!-- Slide 3 -->
            <div class="slide">
              <img src="./assets/gif/testing.gif" alt="Slide 3" />
              <p>
                Hindari musuh dan rintangan. Jadilah yang terbaik dan raih kemenangan!
              </p>
            </div>
          </div>
        </div>
        <button class="nav-arrow nav-prev" id="prevBtn">&#10094;</button>
        <button class="nav-arrow nav-next" id="nextBtn">&#10095;</button>
      </div>
    </div>

    <!-- Popup Modal (Quest) -->
    <div class="modal-overlay" id="questModalOverlay">
      <div class="modal-container">
        <button class="modal-close" id="questModalClose">&times;</button>
        <h2 style="text-align: center; color: #fff">Misi</h2>
        <div class="mission-content">
          <div class="mission-item">
            <img src="./assets/img/itemIcon.svg" alt="Item Icon" class="mission-icon" />
            <div class="mission-details">
              <h3 class="mission-title">Kumpulkan 10 batang pohon</h3>
              <div class="mission-progress">
                <div class="mission-progress-bar"></div>
              </div>
            </div>
          </div>
          <div class="mission-item">
            <img src="./assets/img/itemIcon.svg" alt="Item Icon" class="mission-icon" />
            <div class="mission-details">
              <h3 class="mission-title">Kumpulkan 10 batang pohon</h3>
              <div class="mission-progress">
                <div class="mission-progress-bar"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Interactive Buttons -->
    <button class="interactive-button home" id="homeButton">Rumah</button>
    <button class="interactive-button lab" id="labButton">Laboratorium</button>
    <!-- Tombol interaksi untuk pohon -->
    <button class="interactive-button cut" id="cutButton">Tebang</button>
    <button class="interactive-button plant" id="plantButton">Tanam</button>
    <!-- Tombol interaksi untuk alat Konversi Air -->
    <button class="interactive-button konversi" id="konversiButton">Konversi Air</button>
    <!-- Tombol interaksi untuk alat penghilang polusi -->
    <button class="interactive-button polusi" id="polusiButton">Nyalakan Mesin</button>

    <!-- Page Transition Overlay -->
    <div class="page-transition" id="pageTransition"></div>

    <!-- Tambahkan div untuk alat penghilang polusi di bawah canvas -->
    <div id="alatPolusi" class="alat-dom-element"></div>

    <!-- Tambahkan div untuk alat konversi air -->
    <div id="alatKonversi" class="alat-dom-element"></div>

    <script>
      /***********************
       * Game Code
       ***********************/
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      const loadingScreen = document.getElementById("loadingScreen");

      // Sesuaikan ukuran canvas dengan ukuran window
      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      // Status input keyboard
      const keys = { w: false, s: false, a: false, d: false };

      // Objek game
      const game = {
        player: {
          x: canvas.width / 2,
          y: canvas.height / 2,
          speed: 3,
          maxSpeed: 4,
          acceleration: 0.2,
          friction: 0.15,
          width: 40,       // Ukuran normal lebar karakter
          height: 70,      // Ukuran normal tinggi karakter
          chopWidth: 65,   // Lebar khusus untuk animasi nebang
          chopHeight: 90,  // Tinggi khusus untuk animasi nebang
          currentFrame: 0,
          frameInterval: 200,
          lastFrameTime: 0,
          direction: 'down',
          velocityX: 0,
          velocityY: 0,
          isMoving: false,
          isChopping: false,          // Flag untuk animasi penebangan pada karakter
          chopAnimationStartTime: 0   // Waktu mulai animasi chop
        },
        assets: {
          jiraStay: new Image(),
          leftFrames: [new Image(), new Image(), new Image()],
          rightFrames: [new Image(), new Image(), new Image()],
          downLeftFrame: new Image(),
          downRightFrame: new Image(),
          upLeftFrame: new Image(),
          upRightFrame: new Image(),
          upFrames: [new Image(), new Image()],
          background: new Image(),
          tree: new Image(),      // Gambar pohon normal
          treeCut: new Image(),   // Gambar pohon gundul (untuk animasi penebangan)
          chopFrames: [new Image(), new Image()],  // Frame animasi karakter ketika menebang (nebang1.png dan nebang2.png)
          alatKonversi: new Image(),            // Asset untuk alat konversi
          alatPenghilangPolusi: new Image()     // Asset untuk alat penghilang polusi
        },
        tree: {
          x: 620,      // Posisi X pohon normal
          y: 70,       // Posisi Y pohon normal
          width: 150,  // Lebar pohon normal
          height: 250, // Tinggi pohon normal

          // Properti untuk kondisi pohon gundul
          cutX: 670,   // Ubah nilai ini untuk mengatur posisi X pohon gundul
          cutY: 250,   // Ubah nilai ini untuk mengatur posisi Y pohon gundul
          cutWidth: 60,   // Lebar pohon gundul
          cutHeight: 70,  // Tinggi pohon gundul

          isCut: false  // false = pohon normal, true = pohon sudah ditebang/gundul
        },
        currentTreeImage: null, // Akan di-set setelah asset termuat, misalnya game.assets.tree
        loaded: 0,
        required: 20 // Pastikan jumlah ini sudah mencakup asset treeCut juga
      };

      // Definisikan objek baru untuk posisi dan ukuran alat
      game.tools = {
        alatKonversi: { x: 270, y: 600, width: 130, height: 130 },
        // Properti untuk animasi shaking pada alat konversi
        konversiShaking: false,
        shakeStartTime: 0

      };

      // Fungsi untuk memuat asset gambar
      function loadAssets() {
        game.assets.downLeftFrame.onload = () => { game.loaded++; checkLoading(); };
        game.assets.downLeftFrame.src = "./assets/img/jalanBawahKiri.png";

        game.assets.downRightFrame.onload = () => { game.loaded++; checkLoading(); };
        game.assets.downRightFrame.src = "./assets/img/jalanBawahKanan.png";

        game.assets.upLeftFrame.onload = () => { game.loaded++; checkLoading(); };
        game.assets.upLeftFrame.src = "./assets/img/jalanAtasKiri.png";

        game.assets.upRightFrame.onload = () => { game.loaded++; checkLoading(); };
        game.assets.upRightFrame.src = "./assets/img/jalanAtasKanan.png";

        game.assets.leftFrames.forEach((frame, index) => {
          frame.onload = () => { game.loaded++; checkLoading(); };
          frame.src = `./assets/img/jalanKiri${index + 1}.png`;
        });

        game.assets.rightFrames.forEach((frame, index) => {
          frame.onload = () => { game.loaded++; checkLoading(); };
          frame.src = `./assets/img/jalanKanan${index + 1}.png`;
        });

        game.assets.upFrames.forEach((frame, index) => {
          frame.onload = () => { game.loaded++; checkLoading(); };
          frame.src = `./assets/img/jalanAtas${index + 1}.png`;
        });

        game.assets.jiraStay.onload = () => { game.loaded++; checkLoading(); };
        game.assets.jiraStay.src = "./assets/img/jiraStay.png";

        game.assets.background.onload = () => { game.loaded++; checkLoading(); };
        game.assets.background.src = "./assets/img/gameBg.png";

        // Memuat aset pohon (pohon.png)
        game.assets.tree.onload = () => { game.loaded++; checkLoading(); };
        game.assets.tree.src = "./assets/img/pohon.png";

        // Memuat aset pohon gundul (pohonGundul.png)
        game.assets.treeCut.onload = () => { game.loaded++; checkLoading(); };
        game.assets.treeCut.src = "./assets/img/pohonGundul.png";

        // Memuat frame animasi untuk karakter (nebang1.png dan nebang2.png)
        game.assets.chopFrames.forEach((frame, index) => {
          frame.onload = () => { game.loaded++; checkLoading(); };
          frame.src = `./assets/img/nebang${index + 1}.png`;
        });

        // ==== Pemuatan asset baru ====
        game.assets.alatKonversi.onload = () => { game.loaded++; checkLoading(); };
        game.assets.alatKonversi.src = "./assets/img/alatKonversi.png";

        game.assets.alatPenghilangPolusi.onload = () => { game.loaded++; checkLoading(); };
        game.assets.alatPenghilangPolusi.src = "./assets/img/alatPenghilangPolusi.png";

        function checkLoading() {
          if (game.loaded === game.required) {
            loadingScreen.style.display = "none";
            
            // Ambil status pohon dari localStorage
            const storedTreeState = localStorage.getItem("treeIsCut");
            game.tree.isCut = storedTreeState === "true";
            game.currentTreeImage = game.tree.isCut ? game.assets.treeCut : game.assets.tree;
            
            setSpawnPosition();
            updateToolButtons(); // <-- Memperbarui status tombol berdasarkan data di localStorage
            requestAnimationFrame(gameLoop);
            initializeButtons(); // Tambah ini
          }
        }
      }

      // Event listener untuk keyboard
      window.addEventListener("keydown", (e) => {
        if (e.key.toLowerCase() in keys) keys[e.key.toLowerCase()] = true;
      });
      window.addEventListener("keyup", (e) => {
        if (e.key.toLowerCase() in keys) keys[e.key.toLowerCase()] = false;
      });

      // Tombol interaksi dan transisi halaman
      const homeButton = document.getElementById('homeButton');
      const labButton = document.getElementById('labButton');
      const pageTransition = document.getElementById('pageTransition');
      const INTERACTION_DISTANCE = 150;

      // Fungsi navigasi dengan transisi
      function navigateWithTransition(url) {
        pageTransition.classList.add('active');
        setTimeout(() => {
          window.location.href = url;
        }, 500);
      }

      // Fungsi untuk mengatur posisi spawn player dari data spawn tersimpan
      function setSpawnPosition() {
        const spawnX = sessionStorage.getItem('spawnX');
        const spawnY = sessionStorage.getItem('spawnY');
        if (spawnX !== null && spawnY !== null) {
          game.player.x = parseFloat(spawnX) - (game.player.width / 2);
          game.player.y = parseFloat(spawnY) - (game.player.height / 2);
          sessionStorage.removeItem('spawnX');
          sessionStorage.removeItem('spawnY');
          sessionStorage.removeItem('spawnType');
          return;
        }
        const spawnTarget = sessionStorage.getItem('spawnLocation');
        if (!spawnTarget) return;
        let targetBlock;
        if (spawnTarget === 'home') {
          targetBlock = document.getElementById('blockHome');
        } else if (spawnTarget === 'lab') {
          targetBlock = document.getElementById('blockLaboratorium');
        }
        if (targetBlock) {
          const rect = targetBlock.getBoundingClientRect();
          game.player.x = rect.left + (rect.width / 2) - (game.player.width / 2);
          game.player.y = rect.top + (rect.height / 2) - (game.player.height / 2);
        }
        sessionStorage.removeItem('spawnLocation');
      }

      // Fungsi untuk update posisi player dan mengecek jarak interaksi
      function updatePlayer() {
        const now = Date.now();
        const prevX = game.player.x;
        const prevY = game.player.y;
        game.player.isMoving = false;

        if (keys.w) game.player.velocityY = Math.max(game.player.velocityY - game.player.acceleration, -game.player.maxSpeed);
        if (keys.s) game.player.velocityY = Math.min(game.player.velocityY + game.player.acceleration, game.player.maxSpeed);
        if (keys.a) game.player.velocityX = Math.max(game.player.velocityX - game.player.acceleration, -game.player.maxSpeed);
        if (keys.d) game.player.velocityX = Math.min(game.player.velocityX + game.player.acceleration, game.player.maxSpeed);

        if (!keys.w && !keys.s) {
          game.player.velocityY *= (1 - game.player.friction);
          if (Math.abs(game.player.velocityY) < 0.1) game.player.velocityY = 0;
        }
        if (!keys.a && !keys.d) {
          game.player.velocityX *= (1 - game.player.friction);
          if (Math.abs(game.player.velocityX) < 0.1) game.player.velocityX = 0;
        }

        game.player.x += game.player.velocityX;
        game.player.y += game.player.velocityY;

        game.player.x = Math.max(0, Math.min(game.player.x, canvas.width - game.player.width));
        game.player.y = Math.max(0, Math.min(game.player.y, canvas.height - game.player.height));

        const canvasRect = canvas.getBoundingClientRect();
        const playerCenter = {
          x: game.player.x + game.player.width/2 + canvasRect.left,
          y: game.player.y + game.player.height/2 + canvasRect.top
        };

        // Tombol Home dan Laboratorium
        const homeBlock = document.getElementById('blockHome');
        const labBlock = document.getElementById('blockLaboratorium');
        const homeRect = homeBlock.getBoundingClientRect();
        const labRect = labBlock.getBoundingClientRect();
        const homeCenter = {
          x: homeRect.left + homeRect.width/2,
          y: homeRect.top + homeRect.height/2
        };
        const labCenter = {
          x: labRect.left + labRect.width/2,
          y: labRect.top + labRect.height/2
        };

        const distanceToHome = Math.hypot(playerCenter.x - homeCenter.x, playerCenter.y - homeCenter.y);
        const distanceToLab = Math.hypot(playerCenter.x - labCenter.x, playerCenter.y - labCenter.y);

        homeButton.classList.toggle('visible', distanceToHome < INTERACTION_DISTANCE);
        labButton.classList.toggle('visible', distanceToLab < INTERACTION_DISTANCE);

        if (distanceToHome < INTERACTION_DISTANCE) {
          const buttonWidth = homeButton.offsetWidth;
          homeButton.style.left = `${homeCenter.x - (buttonWidth/2)}px`;
          homeButton.style.top = `${homeRect.bottom + 20}px`;
        }

        if (distanceToLab < INTERACTION_DISTANCE) {
          const buttonWidth = labButton.offsetWidth;
          labButton.style.left = `${labCenter.x - (buttonWidth/2)}px`;
          labButton.style.top = `${labRect.bottom + 20}px`;
        }

        // Tombol interaksi pohon (Tebang & Tanam)
        const treeRect = {
          left: canvasRect.left + game.tree.x,
          top: canvasRect.top + game.tree.y,
          width: game.tree.width,
          height: game.tree.height
        };
        const treeCenter = {
          x: treeRect.left + treeRect.width/2,
          y: treeRect.top + treeRect.height/2
        };
        const distanceToTree = Math.hypot(playerCenter.x - treeCenter.x, playerCenter.y - treeCenter.y);

        const cutButton = document.getElementById('cutButton');
        const plantButton = document.getElementById('plantButton');

        if (distanceToTree < INTERACTION_DISTANCE) {
          cutButton.classList.add('visible');
          plantButton.classList.add('visible');
          const buttonMargin = 10;
          // Posisi tombol ditempatkan di bawah pohon
          cutButton.style.left = `${treeCenter.x - cutButton.offsetWidth - buttonMargin}px`;
          plantButton.style.left = `${treeCenter.x + buttonMargin}px`;
          cutButton.style.top = plantButton.style.top = `${treeRect.top + treeRect.height + 20}px`;
        } else {
          cutButton.classList.remove('visible');
          plantButton.classList.remove('visible');
        }

        // Update visibility alat konversi
        const alatKonversiElement = document.getElementById('alatKonversi');
        const converterBought = localStorage.getItem("converterBought") === "true";
        alatKonversiElement.style.display = converterBought ? 'block' : 'none';

        // Hitung jarak ke alat konversi
        if (converterBought) {
          // Gunakan posisi fixed dari CSS bukan getBoundingClientRect()
          const konversiX = 270; // Sesuai dengan CSS left
          const konversiY = 600; // Sesuai dengan CSS top
          const konversiWidth = 130;
          const konversiHeight = 130;
          
          const konversiCenter = {
            x: konversiX + konversiWidth/2,
            y: konversiY + konversiHeight/2
          };
          
          const distanceToKonversi = Math.hypot(
            playerCenter.x - (konversiCenter.x + canvasRect.left),
            playerCenter.y - (konversiCenter.y + canvasRect.top)
          );

          if (distanceToKonversi < INTERACTION_DISTANCE) {
            konversiButton.classList.add('visible');
            const buttonWidth = konversiButton.offsetWidth;
            konversiButton.style.left = `${konversiCenter.x - buttonWidth/2}px`;
            konversiButton.style.top = `${konversiY + konversiHeight + 20}px`;
          } else {
            konversiButton.classList.remove('visible');
          }
        }

        // --- Modified: Logika untuk alat penghilang polusi ---
        const alatPolusiElement = document.getElementById('alatPolusi');
        const pollutionBought = localStorage.getItem("pollutionBought") === "true";
        alatPolusiElement.style.display = pollutionBought ? 'block' : 'none';

        if (pollutionBought) {
          const polusiRect = alatPolusiElement.getBoundingClientRect();
          const polusiCenter = {
            x: polusiRect.left + polusiRect.width/2,
            y: polusiRect.top + polusiRect.height/2
          };
          
          const distanceToPolusi = Math.hypot(playerCenter.x - polusiCenter.x, playerCenter.y - polusiCenter.y);
          
          if (distanceToPolusi < INTERACTION_DISTANCE) {
            polusiButton.classList.add('visible');
            const buttonWidth = polusiButton.offsetWidth;
            polusiButton.style.left = `${polusiCenter.x - buttonWidth/2}px`;
            polusiButton.style.top = `${polusiRect.bottom + 20}px`;
          } else {
            polusiButton.classList.remove('visible');
          }
        }
        // --- End Modified ---

        // Collision detection (blok rintangan)
        let collisionDetected = false;
        const playerRect = {
          x: game.player.x,
          y: game.player.y,
          width: game.player.width,
          height: game.player.height
        };
        const blocks = document.querySelectorAll(".roadBlock");
        blocks.forEach(blockElem => {
          const blockRect = blockElem.getBoundingClientRect();
          if (
            playerRect.x < blockRect.left + blockRect.width &&
            playerRect.x + playerRect.width > blockRect.left &&
            playerRect.y < blockRect.top + blockRect.height &&
            playerRect.y + playerRect.height > blockRect.top
          ) {
            collisionDetected = true;
          }
        });
        if (collisionDetected) {
          game.player.x = prevX;
          game.player.y = prevY;
          game.player.velocityX = 0;
          game.player.velocityY = 0;
        }

        if (game.player.velocityX !== 0 || game.player.velocityY !== 0) {
          game.player.isMoving = true;
          if (game.player.velocityY < 0) {
            if (game.player.velocityX > 0) game.player.direction = 'up-right';
            else if (game.player.velocityX < 0) game.player.direction = 'up-left';
            else game.player.direction = 'up';
          } else if (game.player.velocityY > 0) {
            if (game.player.velocityX > 0) game.player.direction = 'down-right';
            else if (game.player.velocityX < 0) game.player.direction = 'down-left';
            else game.player.direction = 'down';
          } else {
            game.player.direction = game.player.velocityX > 0 ? 'right' : 'left';
          }
        } else {
          game.player.isMoving = false;
          game.player.currentFrame = 0;
        }

        if (game.player.isMoving && Date.now() - game.player.lastFrameTime > game.player.frameInterval) {
          if (game.player.direction === 'up') {
            game.player.currentFrame = (game.player.currentFrame + 1) % 2;
          } else if (game.player.direction === 'left' || game.player.direction === 'right') {
            game.player.currentFrame = (game.player.currentFrame + 1) % 3;
          }
          game.player.lastFrameTime = Date.now();
        }
      }

      // Menggambar background
      function drawBackground() {
        const img = game.assets.background;
        const canvasRatio = canvas.width / canvas.height;
        const imgRatio = img.width / img.height;
        let drawWidth, drawHeight, xOffset, yOffset;
        if (canvasRatio > imgRatio) {
          drawWidth = canvas.width;
          drawHeight = (canvas.width / img.width) * img.height;
          xOffset = 0;
          yOffset = (canvas.height - drawHeight) / 2;
        } else {
          drawHeight = canvas.height;
          drawWidth = (canvas.height / img.height) * img.width;
          xOffset = (canvas.width - drawWidth) / 2;
          yOffset = 0;
        }
        ctx.drawImage(img, xOffset, yOffset, drawWidth, drawHeight);
      }

      // Menggambar player (override dengan animasi chop jika sedang menebang)
      function drawPlayer() {
        let currentFrame;
        if (game.player.isChopping) {
          const elapsed = Date.now() - game.player.chopAnimationStartTime;
          const frameIndex = Math.floor(elapsed / 200) % game.assets.chopFrames.length;
          currentFrame = game.assets.chopFrames[frameIndex];
        } else {
          switch(game.player.direction) {
            case 'left':
              currentFrame = game.assets.leftFrames[game.player.currentFrame];
              break;
            case 'right':
              currentFrame = game.assets.rightFrames[game.player.currentFrame];
              break;
            case 'down-left':
              currentFrame = game.assets.downLeftFrame;
              break;
            case 'down-right':
              currentFrame = game.assets.downRightFrame;
              break;
            case 'up-left':
              currentFrame = game.assets.upLeftFrame;
              break;
            case 'up-right':
              currentFrame = game.assets.upRightFrame;
              break;
            case 'up':
              currentFrame = game.assets.upFrames[game.player.currentFrame];
              break;
            default:
              currentFrame = game.assets.jiraStay;
          }
        }
        if (!currentFrame || !currentFrame.complete || currentFrame.naturalHeight === 0) {
          console.error('Gambar tidak ditemukan untuk arah:', game.player.direction);
          return;
        }
        
        // Tentukan ukuran gambar berdasarkan status animasi
        const drawWidth = game.player.isChopping ? game.player.chopWidth : game.player.width;
        const drawHeight = game.player.isChopping ? game.player.chopHeight : game.player.height;
        
        ctx.drawImage(
          currentFrame,
          game.player.x,
          game.player.y,
          drawWidth,
          drawHeight
        );
      }

      // Menggambar pohon menggunakan game.currentTreeImage
      function drawTree() {
        // Cek apakah gambar pohon yang sedang digunakan adalah aset pohon gundul (treeCut)
        const isCutState = game.currentTreeImage === game.assets.treeCut;
        
        // Tentukan ukuran gambar yang akan digunakan (sesuai state)
        const drawWidth = isCutState && game.tree.cutWidth ? game.tree.cutWidth : game.tree.width;
        const drawHeight = isCutState && game.tree.cutHeight ? game.tree.cutHeight : game.tree.height;
        
        // Jika dalam state gundul dan properti cutX/cutY telah didefinisikan, gunakan posisi tersebut
        const posX = isCutState && typeof game.tree.cutX !== 'undefined' ? game.tree.cutX : game.tree.x;
        const posY = isCutState && typeof game.tree.cutY !== 'undefined' ? game.tree.cutY : game.tree.y;
        
        ctx.drawImage(
          game.currentTreeImage,
          posX,
          posY,
          drawWidth,
          drawHeight
        );
      }

      // Game loop utama
      function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBackground();
        drawTree();
        updatePlayer();
        drawPlayer();
        requestAnimationFrame(gameLoop);
      }

      loadAssets();

      /***********************
       * Guide Popup & Slider Code
       ***********************/
      const guideButton = document.getElementById("guideButton");
      const modalOverlay = document.getElementById("modalOverlay");
      const modalClose = document.getElementById("modalClose");
      const slideTrack = document.getElementById("slideTrack");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      let currentSlide = 0;
      guideButton.addEventListener("click", () => {
        modalOverlay.classList.add("active");
        currentSlide = 0;
        updateSlide();
      });
      modalClose.addEventListener("click", () => {
        modalOverlay.classList.remove("active");
      });
      function updateSlide() {
        slideTrack.style.transform = `translateX(-${currentSlide * 100}%)`;
      }
      nextBtn.addEventListener("click", () => {
        if (currentSlide < slideTrack.children.length - 1) {
          currentSlide++;
          updateSlide();
        }
      });
      prevBtn.addEventListener("click", () => {
        if (currentSlide > 0) {
          currentSlide--;
          updateSlide();
        }
      });
      window.addEventListener("click", (e) => {
        if (e.target === modalOverlay) modalOverlay.classList.remove("active");
      });

      // Fungsi untuk mengupdate status bar
      function updateStatusBar(barClass, percentage) {
        const barFill = document.querySelector(`.${barClass} .status-bar-fill`);
        if (barFill) {
          percentage = Math.max(0, Math.min(percentage, 100));
          barFill.style.width = `${percentage}%`;
        }
      }
      updateStatusBar('nature', 100);
      updateStatusBar('water', 100);
      updateStatusBar('energy', 100);
      updateStatusBar('toxic', 100);

      // Quest Popup Code
      const questButton = document.querySelector('.icon[alt="Quest Button"]');
      const questModalOverlay = document.getElementById("questModalOverlay");
      const questModalClose = document.getElementById("questModalClose");
      questButton.addEventListener("click", () => { questModalOverlay.classList.add("active"); });
      questModalClose.addEventListener("click", () => { questModalOverlay.classList.remove("active"); });
      window.addEventListener("click", (e) => {
        if (e.target === questModalOverlay) questModalOverlay.classList.remove("active");
      });
      function updateMissionProgress(percentage) {
        const progressBar = document.querySelector(".mission-progress-bar");
        if (progressBar) {
          percentage = Math.max(0, Math.min(percentage, 100));
          progressBar.style.width = `${percentage}%`;
        }
      }
      updateMissionProgress(50);

      // Tombol Home
      homeButton.addEventListener('click', () => {
        const buttonRect = homeButton.getBoundingClientRect();
        const canvasRect = canvas.getBoundingClientRect();
        const spawnX = (buttonRect.left - canvasRect.left) + (buttonRect.width / 2);
        const spawnY = (buttonRect.top - canvasRect.top) + (buttonRect.height / 2);
        sessionStorage.setItem('spawnX', spawnX);
        sessionStorage.setItem('spawnY', spawnY);
        sessionStorage.setItem('spawnType', 'home');
        navigateWithTransition('home.html');
      });
      
      // Tombol Laboratorium
      labButton.addEventListener('click', () => {
        const buttonRect = labButton.getBoundingClientRect();
        const canvasRect = canvas.getBoundingClientRect();
        const spawnX = (buttonRect.left - canvasRect.left) + (buttonRect.width / 2);
        const spawnY = (buttonRect.top - canvasRect.top) + (buttonRect.height / 2);
        sessionStorage.setItem('spawnX', spawnX);
        sessionStorage.setItem('spawnY', spawnY);
        sessionStorage.setItem('spawnType', 'lab');
        navigateWithTransition('laboratorium.html');
      });
      
      // Fungsi animasi untuk aksi tebangan pohon & animasi karakter menebang
      function animateTreeCut() {
        if (game.tree.isCut) return;
        
        // Ubah status pohon ke gundul secara permanen
        game.tree.isCut = true;
        game.currentTreeImage = game.assets.treeCut;
        localStorage.setItem("treeIsCut", "true");
      }
      
      function animatePlayerChop() {
        if (game.player.isChopping) return;
        game.player.isChopping = true;
        game.player.chopAnimationStartTime = Date.now();
        setTimeout(() => {
          game.player.isChopping = false;
        }, 800);
      }
      
      // Tombol interaksi pohon: Tebang
      const cutButton = document.getElementById('cutButton');
      cutButton.addEventListener('click', () => {
        // Cek kondisi sebelum menebang
        if (game.tree.isCut || 
            status.nature < 5 || 
            status.energy < 5 || 
            game.player.isChopping) return;

        // Mulai animasi
        animatePlayerChop();
        animateTreeCut();

        // Update status dan resource
        status.nature = Math.max(0, status.nature - 5);
        status.energy = Math.max(0, status.energy - 5);
        resources.wood += 1;
        
        // Update UI dan simpan
        updateResourceUI();
        updateStatusBarUI();
        saveStatus();
        localStorage.setItem("wood", resources.wood);

        // Update state tombol
        cutButton.disabled = true;
        plantButton.disabled = false;

        showActionPopup("Kamu telah menebang pohon, kayu bertambah!");
      });
      
      // Tombol interaksi pohon: Tanam
      const plantButton = document.getElementById('plantButton');
      plantButton.addEventListener('click', () => {
        if (!game.tree.isCut || status.water < 5) return;

        // Kembalikan status pohon
        game.tree.isCut = false;
        game.currentTreeImage = game.assets.tree;
        localStorage.setItem("treeIsCut", "false");

        // Update status
        status.nature = Math.min(100, status.nature + 5);
        status.water = Math.max(0, status.water - 5);
        
        // Update UI dan simpan
        updateStatusBarUI();
        saveStatus();

        // Update state tombol
        cutButton.disabled = false;
        plantButton.disabled = true;

        showActionPopup("Kamu telah menanam pohon baru, lingkungan menjadi lebih hijau!");
      });

      // Dapatkan elemen tombol Konversi Air
      const konversiButton = document.getElementById("konversiButton");

      function triggerShakeAnimation() {
        const alatKonversi = document.getElementById('alatKonversi');
        
        // Reset animasi
        alatKonversi.style.animation = 'none';
        void alatKonversi.offsetWidth; // Trigger reflow
        
        // Terapkan animasi hanya ke alat
        alatKonversi.style.animation = 'shake 0.5s ease-in-out';
        
        setTimeout(() => {
          alatKonversi.style.animation = '';
        }, 500);
      }

      // Modifikasi event listener tombol Konversi Air
      konversiButton.addEventListener('click', function() {
        if (localStorage.getItem("converterBought") !== "true") {
          showActionPopup("Alat Konversi Air belum dibuat di Laboratorium.");
          return;
        }
        
        // Misal, tambahkan air 5% dan kurangi energi 5%
        status.water = Math.min(100, status.water + 5);
        status.energy = Math.max(0, status.energy - 5);
        
        updateStatusBarUI();
        localStorage.setItem("waterStatus", status.water);
        localStorage.setItem("energyStatus", status.energy);
        
        showActionPopup("Kamu telah melakukan konversi air, sumber daya airmu bertambah sebanyak 5%!");
        
        triggerShakeAnimation();
      });

      // Tombol untuk alat penghilang polusi: Nyalakan Mesin
      const polusiButton = document.getElementById('polusiButton');
      polusiButton.addEventListener('click', () => {
        navigateWithTransition('ending.html');
      });

      /***********************
       * Resource & Status Management
       ***********************/
       
       // Inisialisasi resource dari localStorage atau default
       const resources = {
         wood: parseInt(localStorage.getItem("wood")) || 0,
         plastic: parseInt(localStorage.getItem("plastic")) || 0
       };

       // Inisialisasi status (dalam persen) untuk pohon (nature), energi, dan limbah (toxic)
       const status = {
         nature: parseFloat(localStorage.getItem("natureStatus")) || 100,
         energy: parseFloat(localStorage.getItem("energyStatus")) || 100,
         water: parseFloat(localStorage.getItem("waterStatus")) || 100, // Tambah properti water
         toxic: parseFloat(localStorage.getItem("toxicStatus")) || 0
       };

       // Fungsi untuk mengupdate tampilan angka resource
       function updateResourceUI() {
         document.getElementById('woodCount').textContent = 'X ' + resources.wood;
         document.getElementById('plasticCount').textContent = 'X ' + resources.plastic;
       }

       // Fungsi untuk mengupdate tampilan status bar
       function updateStatusBarUI() {
         updateStatusBar('nature', status.nature);
         updateStatusBar('energy', status.energy);
         updateStatusBar('water', status.water); // Tambah update untuk water
         updateStatusBar('toxic', status.toxic);
       }

       // Fungsi pembantu untuk mengubah lebar bar berdasarkan persen
       function updateStatusBar(barClass, value) {
         const barFill = document.querySelector(`.${barClass} .status-bar-fill`);
         if (barFill) {
           barFill.style.width = Math.max(0, Math.min(value, 100)) + '%';
         }
       }

       // Fungsi untuk menyimpan status ke localStorage
       function saveStatus() {
         localStorage.setItem("natureStatus", status.nature);
         localStorage.setItem("energyStatus", status.energy);
         localStorage.setItem("waterStatus", status.water); // Simpan status water
         localStorage.setItem("toxicStatus", status.toxic);
       }

       // Update UI awal
       updateResourceUI();
       updateStatusBarUI();

      function updateToolButtons() {
        // Update Tombol/Ikon Alat Konversi Air
        const converterBought = localStorage.getItem("converterBought") === "true";
        const konversiButton = document.getElementById("konversiButton");
        
        // Jika terdapat tag <img> di dalam tombol, targetkan juga elemen tersebut
        const konversiImg = konversiButton.querySelector("img");
        
        if (!converterBought) {
          // Terapkan filter dan kursor pada tombol dan gambar SVG di dalamnya
          konversiButton.style.filter = "grayscale(100%) brightness(50%)";
          konversiButton.style.cursor = "not-allowed";
          if (konversiImg) {
            konversiImg.style.filter = "grayscale(100%) brightness(50%)";
            konversiImg.style.cursor = "not-allowed";
          }
          konversiButton.disabled = true; // Opsional: nonaktifkan klik pada tombol
        } else {
          // Tampilkan secara normal ketika sudah dibuat
          konversiButton.style.filter = "";
          konversiButton.style.cursor = "pointer";
          if (konversiImg) {
            konversiImg.style.filter = "";
            konversiImg.style.cursor = "pointer";
          }
          konversiButton.disabled = false;
        }
        
        // Update Tombol Alat Penghilang Polusi
        const pollutionBought = localStorage.getItem("pollutionBought") === "true";
        const polusiButton = document.getElementById("polusiButton");
        polusiButton.style.display = pollutionBought ? "block" : "none";
      }

      // Mengupdate kursor ketika mouse bergerak di dalam canvas
      canvas.addEventListener("mousemove", function(e) {
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;
        
        // Cek apakah mouse berada di dalam region alat Konversi Air
        const convTool = game.tools.alatKonversi;
        if (mouseX >= convTool.x && mouseX <= convTool.x + convTool.width &&
            mouseY >= convTool.y && mouseY <= convTool.y + convTool.height) {
          const converterBought = localStorage.getItem("converterBought") === "true";
          canvas.style.cursor = converterBought ? "pointer" : "not-allowed";
          return;
        }
        
        // Kursor default jika mouse berada di luar region alat
        canvas.style.cursor = "default";
      });

      // Menangani klik pada canvas untuk alat Konversi Air
      canvas.addEventListener("click", function(e) {
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;
        
        // Cek apakah klik terjadi di dalam region alat Konversi Air
        const convTool = game.tools.alatKonversi;
        if (mouseX >= convTool.x && mouseX <= convTool.x + convTool.width &&
            mouseY >= convTool.y && mouseY <= convTool.y + convTool.height) {
          if (localStorage.getItem("converterBought") !== "true") {
            alert("Alat Konversi Air belum dibuat di Laboratorium.");
            return;
          }
          // Jika sudah dibeli, mulai aksi konversi (contoh: animasi shaking)
          triggerShakeAnimation();
        }
      });

      // Fungsi untuk memulai animasi shake pada alat konversi
      function triggerShakeAnimation() {
        const alatKonversi = document.getElementById('alatKonversi');
        
        // Reset animasi terlebih dahulu
        alatKonversi.style.animation = 'none';
        // Trigger reflow
        void alatKonversi.offsetWidth;
        
        // Jalankan animasi
        alatKonversi.style.animation = 'shake 0.5s ease-in-out';
        
        // Hapus animasi setelah selesai
        setTimeout(() => {
          alatKonversi.style.animation = '';
        }, 500);
      }

      // Inisialisasi status tombol saat pertama load
      function initializeButtons() {
        cutButton.disabled = game.tree.isCut;
        plantButton.disabled = !game.tree.isCut;
      }
    </script>
    <script>
      function showActionPopup(message) {
        const popup = document.getElementById('actionPopup');
        if (!popup) return;
        popup.textContent = message;
        popup.classList.add('active');
        // Popup akan hilang setelah 3 detik
        setTimeout(() => {
          popup.classList.remove('active');
        }, 3000);
      }
    </script>
    <div id="actionPopup"></div>
  </body>
</html>
